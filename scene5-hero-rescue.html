<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é•œå¤´5ï¼šè‹±é›„æ•‘ç¾é€‰æ‹© - ä»£å·qin</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(180deg, #2C1810 0%, #1A0F08 50%, #000000 100%);
            overflow: hidden;
            font-family: 'Microsoft YaHei', sans-serif;
            cursor: default;
        }
        
        #scene5-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        /* åœºæ™¯èƒŒæ™¯ */
        .scene-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(139, 69, 19, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(160, 82, 45, 0.2) 0%, transparent 50%);
            z-index: 1;
        }
        
        /* è§’è‰²å®¹å™¨ */
        .characters-container {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            z-index: 10;
        }
        
        /* æ¬ºå‡Œè€…ä»¬ */
        .bullies {
            position: absolute;
            left: 20%;
            bottom: 0;
            display: flex;
            gap: 20px;
        }
        
        .bully {
            width: 60px;
            height: 100px;
            background: linear-gradient(180deg, #8B4513 0%, #654321 50%, #3C2414 100%);
            border-radius: 30px 30px 15px 15px;
            position: relative;
            animation: bullyThreat 2s ease-in-out infinite;
        }
        
        .bully:nth-child(2) { animation-delay: 0.5s; }
        .bully:nth-child(3) { animation-delay: 1s; }
        
        @keyframes bullyThreat {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-5px) rotate(2deg); }
        }
        
        .bully::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: #D2691E;
            border-radius: 50%;
        }
        
        /* å°å¬´æ”¿ */
        .young-yingzheng {
            position: absolute;
            right: 40%;
            bottom: 0;
            width: 50px;
            height: 80px;
            background: linear-gradient(180deg, #708090 0%, #2F4F4F 50%, #1C1C1C 100%);
            border-radius: 25px 25px 12px 12px;
            animation: victimCower 3s ease-in-out infinite;
            transition: all 0.5s ease;
        }
        
        @keyframes victimCower {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(5px) scale(0.95); }
        }
        
        .young-yingzheng::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 16px;
            background: #F5DEB3;
            border-radius: 50%;
        }
        
        /* ç©å®¶è§’è‰² */
        .player-character {
            position: absolute;
            left: 80%;
            bottom: 0;
            width: 60px;
            height: 100px;
            background: linear-gradient(180deg, #4682B4 0%, #2F4F4F 50%, #191970 100%);
            border-radius: 30px 30px 15px 15px;
            opacity: 0;
            transform: translateX(100px);
            animation: playerEntrance 2s ease-out 1s forwards;
        }
        
        @keyframes playerEntrance {
            0% { opacity: 0; transform: translateX(100px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        
        .player-character::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: #F0E68C;
            border-radius: 50%;
        }
        
        /* åœºæ™¯æè¿°æ–‡å­— */
        .scene-description {
            position: absolute;
            top: 10%;
            left: 5%;
            right: 5%;
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            line-height: 1.8;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #FFD700;
            opacity: 0;
            animation: descriptionSlideIn 2s ease-out forwards;
        }
        
        @keyframes descriptionSlideIn {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        /* é€‰æ‹©é¢æ¿ */
        .choice-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 30px;
            border-radius: 15px;
            color: white;
            min-width: 500px;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
            transition: all 0.5s ease;
            z-index: 1000;
        }
        
        .choice-panel.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        /* å€’è®¡æ—¶å™¨ */
        .choice-timer {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .timer-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ff8844);
            width: 100%;
            transition: width 0.1s linear;
        }
        
        .timer-text {
            font-size: 18px;
            font-weight: bold;
            color: #ff4444;
        }
        
        /* é€‰æ‹©æŒ‰é’®å®¹å™¨ */
        .choices-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .choice-btn {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .choice-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: #4CAF50;
            transform: translateY(-2px);
        }
        
        .choice-btn.martial {
            border-color: #f44336;
        }
        
        .choice-btn.martial:hover {
            background: rgba(244, 67, 54, 0.2);
            border-color: #FFD700;
        }
        
        .choice-btn.cunning {
            border-color: #2196F3;
        }
        
        .choice-btn.cunning:hover {
            background: rgba(33, 150, 243, 0.2);
            border-color: #FFD700;
        }
        
        .choice-btn.virtue {
            border-color: #FF9800;
        }
        
        .choice-btn.virtue:hover {
            background: rgba(255, 152, 0, 0.2);
            border-color: #FFD700;
        }
        
        .choice-icon {
            font-size: 24px;
            margin-right: 15px;
        }
        
        .choice-text {
            flex: 1;
            font-weight: bold;
        }
        
        .choice-preview {
            font-size: 12px;
            opacity: 0.7;
        }
        
        /* æ—¶é—´å‡ç¼“æ•ˆæœ */
        .conflict-scene.slow-motion {
            filter: blur(1px) brightness(0.7);
        }
        
        .conflict-scene.slow-motion .characters-container {
            animation: slowMotion 0.5s ease-out forwards;
        }
        
        @keyframes slowMotion {
            0% { filter: none; }
            100% { filter: blur(0.5px) brightness(0.8); }
        }
        
        /* é€‰æ‹©ç»“æœåé¦ˆ */
        .choice-result {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #FFD700;
            text-align: center;
            z-index: 99999;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
            transition: all 0.5s ease;
        }
        
        .choice-result.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .result-title {
            font-size: 20px;
            color: #FFD700;
            margin-bottom: 15px;
        }
        
        .result-description {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .result-effects {
            font-size: 12px;
            color: #90EE90;
            margin-bottom: 20px;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 10000;
            min-width: 200px;
            border: 1px solid #333;
        }
        
        .control-button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: #333;
            color: white;
            border: 1px solid #666;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s;
        }
        
        .control-button:hover {
            background: #555;
        }
        
        .status {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #666;
            font-size: 10px;
            opacity: 0.8;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes charging {
            0% { transform: translateX(0); }
            100% { transform: translateX(-200px); }
        }
        
        @keyframes being-hit {
            0% { transform: translateX(0) rotate(0deg); }
            50% { transform: translateX(20px) rotate(10deg); }
            100% { transform: translateX(0) rotate(0deg); opacity: 0.5; }
        }
        
        @keyframes approaching {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100px); }
        }
        
        @keyframes confused {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
            100% { transform: rotate(0deg); }
        }
        
        @keyframes calling-help {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* å¯¹è¯æ°”æ³¡ */
        .dialogue-bubble {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 15px;
            border: 2px solid #FFD700;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            animation: bubbleFadeIn 0.5s ease-out forwards;
        }
        
        .dialogue-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #FFD700;
        }
        
        @keyframes bubbleFadeIn {
            0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
            100% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
    </style>
</head>
<body>
    <div id="scene5-container" class="conflict-scene">
        <!-- åœºæ™¯èƒŒæ™¯ -->
        <div class="scene-background"></div>
        
        <!-- åœºæ™¯æè¿° -->
        <div class="scene-description" id="scene-description">
            <p style="font-weight: bold; color: #FFD700;">è¿œå¤„ä¼ æ¥ä¸€é˜µæ‰“éª‚å£°...</p>
            <p>xå¾ªå£°èµ°å»ï¼Œçœ‹åˆ°å‡ ä¸ªè¡£ç€åè´µçš„å°‘å¹´æ­£å›´ç€ä¸€ä¸ªç˜¦å°çš„ç”·å­©æ‹³æ‰“è„šè¸¢ã€‚</p>
            <p style="color: #E74C3C;">"ç§¦ç‹—ï¼ä½ ä¹Ÿé…å’Œæˆ‘ä»¬ä¸€èµ·è¯»ä¹¦ï¼Ÿ"</p>
            <p style="color: #E74C3C;">"ä½ çˆ¹ä¸è¦ä½ äº†ï¼ŒæŠŠä½ æ‰”åœ¨è¿™å„¿ç­‰æ­»ï¼"</p>
            <p>è¢«æ®´æ‰“çš„ç”·å­©æ­»æ­»æŠ¤ä½å¤´éƒ¨ï¼Œä¸€å£°ä¸å­ã€‚å½“å…¶ä¸­ä¸€ä¸ªå°‘å¹´ä¸¾èµ·çŸ³å¤´è¦ç ¸ä»–æ—¶...</p>
        </div>
        
        <!-- è§’è‰²å®¹å™¨ -->
        <div class="characters-container">
            <!-- æ¬ºå‡Œè€…ä»¬ -->
            <div class="bullies" id="bullies">
                <div class="bully"></div>
                <div class="bully"></div>
                <div class="bully"></div>
            </div>
            
            <!-- å°å¬´æ”¿ -->
            <div class="young-yingzheng" id="young-yingzheng"></div>
            
            <!-- ç©å®¶è§’è‰² -->
            <div class="player-character" id="player-character"></div>
        </div>
        
        <!-- é€‰æ‹©é¢æ¿ -->
        <div class="choice-panel" id="choice-panel">
            <div class="choice-timer">
                <div class="timer-bar">
                    <div class="timer-fill" id="timer-fill"></div>
                </div>
                <span class="timer-text" id="timer-text">5</span>
            </div>
            
            <div class="choices-container">
                <button class="choice-btn martial" data-choice="fight">
                    <div class="choice-icon">âš”ï¸</div>
                    <div class="choice-text">ç›´æ¥å†²ä¸Šå»</div>
                    <div class="choice-preview">æ­¦å¾·+15ï¼Œå¯èƒ½å—ä¼¤</div>
                </button>
                
                <button class="choice-btn cunning" data-choice="persuade">
                    <div class="choice-icon">ğŸ’¬</div>
                    <div class="choice-text">æ™ºæ…§åŠè¯´</div>
                    <div class="choice-preview">å·§æ€+10ï¼Œå’Œå¹³è§£å†³</div>
                </button>
                
                <button class="choice-btn virtue" data-choice="help">
                    <div class="choice-icon">ğŸ¤</div>
                    <div class="choice-text">å¯»æ±‚å¸®åŠ©</div>
                    <div class="choice-preview">ä»å¾·+8ï¼Œè·å¾—ç›Ÿå‹</div>
                </button>
            </div>
        </div>
        
        <!-- é€‰æ‹©ç»“æœ -->
        <div class="choice-result" id="choice-result">
            <div class="result-title" id="result-title">é€‰æ‹©ç»“æœ</div>
            <div class="result-description" id="result-description">æè¿°å†…å®¹</div>
            <div class="result-effects" id="result-effects">å±æ€§å½±å“</div>
            <button onclick="continueStory()" 
                    style="padding: 10px 20px; background: #FFD700; color: #000; border: none; border-radius: 5px; cursor: pointer;">
                ç»§ç»­æ•…äº‹
            </button>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="controls">
            <h4 style="margin: 0 0 10px 0; color: #FFD700;">é•œå¤´5ï¼šè‹±é›„æ•‘ç¾é€‰æ‹©</h4>
            <button class="control-button" onclick="startScene()">å¼€å§‹åœºæ™¯</button>
            <button class="control-button" onclick="showAllChoices()">æ˜¾ç¤ºé€‰æ‹©é¢æ¿</button>
            <button class="control-button" onclick="autoChoice()">è‡ªåŠ¨é€‰æ‹©</button>
            <button class="control-button" onclick="nextScene()">ä¸‹ä¸€é•œå¤´</button>
            <button class="control-button" onclick="restartScene()">é‡æ–°å¼€å§‹</button>
            
            <div class="status">
                <div>çŠ¶æ€: <span id="scene-status">åœºæ™¯åˆå§‹åŒ–</span></div>
                <div>é€‰æ‹©: <span id="choice-made">æœªé€‰æ‹©</span></div>
                <div>å±æ€§å½±å“: <span id="attribute-effect">æ— </span></div>
            </div>
        </div>
    </div>

    <script>
        class Scene5Controller {
            constructor() {
                this.container = document.getElementById('scene5-container');
                this.sceneDescription = document.getElementById('scene-description');
                this.choicePanel = document.getElementById('choice-panel');
                this.choiceResult = document.getElementById('choice-result');
                this.status = document.getElementById('scene-status');
                this.choiceMade = document.getElementById('choice-made');
                this.attributeEffect = document.getElementById('attribute-effect');
                
                this.currentPhase = 1;
                this.selectedChoice = null;
                this.timerDuration = 5000; // 5ç§’é€‰æ‹©æ—¶é—´
                this.timerInterval = null;
                
                this.choices = {
                    fight: {
                        name: 'ç›´æ¥å†²ä¸Šå»',
                        attribute: 'martial',
                        value: 15,
                        animation: 'fight-sequence',
                        consequence: 'å¯èƒ½å—ä¼¤ä½†å±•ç°å‹‡æ°”'
                    },
                    persuade: {
                        name: 'æ™ºæ…§åŠè¯´',
                        attribute: 'cunning', 
                        value: 10,
                        animation: 'persuade-sequence',
                        consequence: 'å’Œå¹³è§£å†³è·å¾—å°Šé‡'
                    },
                    help: {
                        name: 'å¯»æ±‚å¸®åŠ©',
                        attribute: 'virtue',
                        value: 8,
                        animation: 'help-sequence',
                        consequence: 'è·å¾—ç›Ÿå‹æ”¯æŒ'
                    }
                };
                
                this.init();
            }
            
            init() {
                console.log('ğŸ¬ é•œå¤´5ï¼šè‹±é›„æ•‘ç¾é€‰æ‹©åˆå§‹åŒ–');
                this.updateStatus('åœºæ™¯å±•å¼€ä¸­...');
                this.startConflictScene();
                this.bindChoiceEvents();
            }
            
            // å¯åŠ¨å†²çªåœºæ™¯
            startConflictScene() {
                this.currentPhase = 1;
                
                // æ’­æ”¾å†²çªå»ºç«‹åŠ¨ç”»
                this.playConflictAnimation();
                
                // 6ç§’åæ˜¾ç¤ºé€‰æ‹©ç•Œé¢
                setTimeout(() => {
                    this.showChoicePanel();
                }, 6000);
            }
            
            // æ’­æ”¾å†²çªåŠ¨ç”»
            playConflictAnimation() {
                const bullies = document.querySelectorAll('.bully');
                const victim = document.querySelector('.young-yingzheng');
                
                // æ¶éœ¸æ”»å‡»åŠ¨ç”»
                bullies.forEach((bully, index) => {
                    setTimeout(() => {
                        bully.classList.add('attacking');
                    }, index * 500);
                });
                
                // å—å®³è€…å—ä¼¤åŠ¨ç”»
                setTimeout(() => {
                    victim.classList.add('being-hurt');
                }, 1000);
                
                // ä¸»è§’æ³¨æ„åˆ°å†²çª
                setTimeout(() => {
                    document.querySelector('.player-character').classList.add('alert');
                }, 3000);
            }
            
            // æ˜¾ç¤ºé€‰æ‹©é¢æ¿
            showChoicePanel() {
                this.currentPhase = 2;
                
                // æ—¶é—´å‡ç¼“æ•ˆæœ
                this.container.classList.add('slow-motion');
                
                // æ˜¾ç¤ºé€‰æ‹©é¢æ¿
                this.choicePanel.classList.add('show');
                
                // å¯åŠ¨å€’è®¡æ—¶
                this.startChoiceTimer();
                
                this.updateStatus('å…³é”®é€‰æ‹©æ—¶åˆ»');
            }
            
            // å¯åŠ¨é€‰æ‹©å€’è®¡æ—¶
            startChoiceTimer() {
                let timeLeft = this.timerDuration;
                const timerFill = document.getElementById('timer-fill');
                const timerText = document.getElementById('timer-text');
                
                this.timerInterval = setInterval(() => {
                    timeLeft -= 100;
                    const progress = (timeLeft / this.timerDuration) * 100;
                    
                    timerFill.style.width = progress + '%';
                    timerText.textContent = Math.ceil(timeLeft / 1000);
                    
                    if (timeLeft <= 0) {
                        // æ—¶é—´åˆ°ï¼Œè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªé€‰é¡¹
                        this.makeChoice('fight');
                    }
                }, 100);
            }
            
            // ç»‘å®šé€‰æ‹©äº‹ä»¶
            bindChoiceEvents() {
                const choiceBtns = document.querySelectorAll('.choice-btn');
                
                choiceBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const choice = btn.dataset.choice;
                        this.makeChoice(choice);
                    });
                });
            }
            
            // æ‰§è¡Œé€‰æ‹©
            makeChoice(choiceKey) {
                if (this.selectedChoice) return; // é˜²æ­¢é‡å¤é€‰æ‹©
                
                this.selectedChoice = choiceKey;
                this.currentPhase = 3;
                
                // æ¸…é™¤å€’è®¡æ—¶
                clearInterval(this.timerInterval);
                
                // éšè—é€‰æ‹©é¢æ¿
                this.choicePanel.classList.remove('show');
                
                // æ¢å¤æ­£å¸¸æ—¶é—´
                this.container.classList.remove('slow-motion');
                
                // æ’­æ”¾å¯¹åº”åŠ¨ç”»
                this.playActionSequence(choiceKey);
            }
            
            // æ’­æ”¾è¡ŒåŠ¨åºåˆ—
            playActionSequence(choiceKey) {
                const choice = this.choices[choiceKey];
                
                // æ ¹æ®é€‰æ‹©æ’­æ”¾ä¸åŒåŠ¨ç”»
                switch(choiceKey) {
                    case 'fight':
                        this.playFightSequence();
                        break;
                    case 'persuade':
                        this.playPersuadeSequence();
                        break;
                    case 'help':
                        this.playHelpSequence();
                        break;
                }
                
                // 3ç§’åæ˜¾ç¤ºç»“æœ
                setTimeout(() => {
                    this.showResult(choice);
                }, 3000);
            }
            
            // æˆ˜æ–—åºåˆ—åŠ¨ç”»
            playFightSequence() {
                const protagonist = document.querySelector('.player-character');
                const bullies = document.querySelectorAll('.bully');
                
                // ä¸»è§’å†²åˆº
                protagonist.style.animation = 'charging 1s ease-out forwards';
                
                // æˆ˜æ–—ç‰¹æ•ˆ
                setTimeout(() => {
                    bullies.forEach(bully => {
                        bully.style.animation = 'being-hit 0.5s ease-out forwards';
                    });
                }, 1000);
            }
            
            // åŠè¯´åºåˆ—åŠ¨ç”»
            playPersuadeSequence() {
                const protagonist = document.querySelector('.player-character');
                
                // ä¸»è§’èµ°å‘å‰
                protagonist.style.animation = 'approaching 1s ease-out forwards';
                
                // æ˜¾ç¤ºå¯¹è¯æ°”æ³¡
                setTimeout(() => {
                    this.showDialogue('ä½æ‰‹ï¼ä½ ä»¬è¿™æ ·åšæ˜¯ä¸å¯¹çš„ï¼');
                }, 1000);
                
                // æ¶éœ¸ä»¬åœæ­¢æ”»å‡»
                setTimeout(() => {
                    document.querySelectorAll('.bully').forEach(bully => {
                        bully.style.animation = 'confused 1s ease-out forwards';
                    });
                }, 2000);
            }
            
            // å¯»æ±‚å¸®åŠ©åºåˆ—
            playHelpSequence() {
                const protagonist = document.querySelector('.player-character');
                
                // ä¸»è§’å‘¼æ•‘
                protagonist.style.animation = 'calling-help 1s ease-out forwards';
                
                // æ˜¾ç¤ºå‘¼æ•‘å¯¹è¯
                setTimeout(() => {
                    this.showDialogue('æ¥äººå•Šï¼æœ‰äººåœ¨è¿™é‡Œæ¬ºè´Ÿäººï¼');
                }, 500);
            }
            
            // æ˜¾ç¤ºå¯¹è¯
            showDialogue(text) {
                const bubble = document.createElement('div');
                bubble.className = 'dialogue-bubble';
                bubble.textContent = text;
                bubble.style.top = '-80px';
                bubble.style.fontSize = '14px';
                bubble.style.borderColor = '#87CEEB';
                document.querySelector('.player-character').appendChild(bubble);
            }
            
            // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
            showResult(choice) {
                this.currentPhase = 4;
                
                let result = {};
                
                switch(choice.attribute) {
                    case 'martial':
                        result = {
                            title: 'ğŸ—¡ï¸ è‹±å‹‡æˆ˜æ–—',
                            description: 'xä¸çŸ¥å“ªæ¥çš„å‹‡æ°”å†²äº†å‡ºå»ã€‚"ä½æ‰‹ï¼"xçš„å£°éŸ³å¤§å¾—å“äººï¼Œè¿ä»–è‡ªå·±éƒ½åƒäº†ä¸€æƒŠã€‚æ›´æƒŠäººçš„æ˜¯ï¼Œxéšæ‰‹ä¸€æ¨ï¼Œé‚£ä¸ªæ¯”ä»–é«˜å¤§åŠå¤´çš„è´µæ—å°‘å¹´ç«Ÿç„¶é£å‡ºå»ä¸‰ç±³è¿œï¼',
                            effects: `æ­¦å¾· +${choice.value}ï¼Œè·å¾—æˆ˜æ–—ç»éªŒ`
                        };
                        break;
                    case 'cunning':
                        result = {
                            title: 'ğŸ’¬ æ™ºæ…§åŠè¯´',
                            description: 'xå†·é™åœ°åˆ†æå½¢åŠ¿ï¼Œç”¨æ™ºæ…§åŒ–è§£äº†å†²çªã€‚é€šè¿‡å·§å¦™çš„è¨€è¾å’Œç­–ç•¥ï¼ŒæˆåŠŸè®©æ¶éœ¸ä»¬åœæ­¢äº†æš´è¡Œï¼Œå±•ç°äº†è¿‡äººçš„æœºæ™ºã€‚',
                            effects: `å·§æ€ +${choice.value}ï¼Œè·å¾—ç­–ç•¥ç»éªŒ`
                        };
                        break;
                    case 'virtue':
                        result = {
                            title: 'ğŸ¤ å¯»æ±‚å¸®åŠ©',
                            description: 'xæ˜æ™ºåœ°é€‰æ‹©å¯»æ±‚å¸®åŠ©ï¼Œé€šè¿‡å‘¼æ•‘å¼•æ¥äº†è·¯äººçš„æ³¨æ„ã€‚è¿™ç§åšæ³•è™½ç„¶çœ‹ä¼¼è¢«åŠ¨ï¼Œä½†ä½“ç°äº†ä»è€…çš„æ™ºæ…§å’Œå¯¹ä»–äººçš„ä¿¡ä»»ã€‚',
                            effects: `ä»å¾· +${choice.value}ï¼Œè·å¾—å¤–äº¤ç»éªŒ`
                        };
                        break;
                }
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('result-title').textContent = result.title;
                document.getElementById('result-description').textContent = result.description;
                document.getElementById('result-effects').textContent = result.effects;
                
                this.choiceResult.classList.add('show');
                this.updateStatus('é€‰æ‹©å®Œæˆ');
                
                // æ›´æ–°å±æ€§æ•ˆæœæ˜¾ç¤º
                this.attributeEffect.textContent = `${this.getAttributeName(choice.attribute)}+${choice.value}`;
                this.choiceMade.textContent = choice.name;
            }
            
            // è·å–å±æ€§ä¸­æ–‡å
            getAttributeName(attr) {
                const names = {
                    martial: 'æ­¦å¾·',
                    cunning: 'å·§æ€',
                    virtue: 'ä»å¾·'
                };
                return names[attr];
            }
            
            updateStatus(status) {
                this.status.textContent = status;
            }
        }
        
        // å…¨å±€å‡½æ•°ä¾›æ§åˆ¶é¢æ¿ä½¿ç”¨
        let scene5Instance;
        
        window.addEventListener('DOMContentLoaded', () => {
            scene5Instance = new Scene5Controller();
        });
        
        function makeChoice(choice) {
            scene5Instance.makeChoice(choice);
        }
        
        function continueStory() {
            scene5Instance.choiceResult.classList.remove('show');
            nextScene();
        }
        
        function startScene() {
            console.log('ğŸ¬ é‡æ–°å¼€å§‹åœºæ™¯');
            scene5Instance.startConflictScene();
        }
        
        function showAllChoices() {
            console.log('ğŸ“‹ æ˜¾ç¤ºé€‰æ‹©é¢æ¿');
            scene5Instance.showChoicePanel();
        }
        
        function autoChoice() {
            console.log('ğŸ¤– è‡ªåŠ¨é€‰æ‹©ï¼ˆè‹±å‹‡æˆ˜æ–—ï¼‰');
            scene5Instance.makeChoice('fight');
        }
        
        function nextScene() {
            console.log('â¡ï¸ å‰å¾€ä¸‹ä¸€é•œå¤´');
            if (!scene5Instance.selectedChoice) {
                alert('è¯·å…ˆåšå‡ºé€‰æ‹©ï¼');
                return;
            }
            
            const choiceMap = {
                fight: 'é•œå¤´6ï¼šé¦–æˆ˜å‘Šæ·',
                persuade: 'é•œå¤´6ï¼šæ™ºæ…§èƒœåˆ©',
                help: 'é•œå¤´6ï¼šç›Ÿå‹ç›¸åŠ©'
            };
            
            const nextSceneTitle = choiceMap[scene5Instance.selectedChoice] || 'ä¸‹ä¸€é•œå¤´';
            alert(`é•œå¤´5å®Œæˆï¼\n\né€‰æ‹©ç»“æœï¼š${scene5Instance.choices[scene5Instance.selectedChoice].name}\nå±æ€§è·å¾—ï¼š${scene5Instance.attributeEffect.textContent}\n\næ¥ä¸‹æ¥å°†è¿›å…¥${nextSceneTitle}`);
            
            // å¯ä»¥åœ¨è¿™é‡Œè·³è½¬åˆ°ä¸‹ä¸€ä¸ªé•œå¤´
            // window.location.href = 'scene6-first-battle.html';
        }
        
        function restartScene() {
            console.log('ğŸ”„ é‡æ–°å¼€å§‹é•œå¤´5');
            location.reload();
        }
        
        // å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case '1':
                    makeChoice('fight');
                    break;
                case '2':
                    makeChoice('persuade');
                    break;
                case '3':
                    makeChoice('help');
                    break;
                case ' ':
                    e.preventDefault();
                    showAllChoices();
                    break;
                case 'Enter':
                    e.preventDefault();
                    autoChoice();
                    break;
                case 'n':
                case 'N':
                    nextScene();
                    break;
                case 'r':
                case 'R':
                    restartScene();
                    break;
            }
        });
        
        console.log('ğŸ® é•œå¤´5æ§åˆ¶ï¼š1=ç›´æ¥å†²ä¸Šå», 2=æ™ºæ…§åŠè¯´, 3=å¯»æ±‚å¸®åŠ©, ç©ºæ ¼=æ˜¾ç¤ºé€‰æ‹©, å›è½¦=è‡ªåŠ¨é€‰æ‹©, N=ä¸‹ä¸€é•œå¤´, R=é‡å¯');
    </script>
</body>
</html> 