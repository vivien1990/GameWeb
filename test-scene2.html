<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é•œå¤´2æµ‹è¯• - ç‰ä½©è§‰é†’</title>
    
    <!-- åŸºç¡€æ ·å¼ -->
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/ui-components.css">
    <link rel="stylesheet" href="styles/scene2.css">
    <link rel="stylesheet" href="styles/animations.css">
    
    <style>
        /* æµ‹è¯•ä¸“ç”¨æ ·å¼ */
        .test-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Microsoft YaHei', sans-serif;
            font-size: 12px;
            z-index: 999999;
            min-width: 200px;
        }
        
        .test-button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: #333;
            color: white;
            border: 1px solid #666;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .test-button:hover {
            background: #555;
        }
        
        .debug-info {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #666;
            font-size: 10px;
            opacity: 0.8;
        }
        
        #scene-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- åœºæ™¯å®¹å™¨ -->
    <div id="scene-container"></div>
    
    <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
    <div class="test-controls">
        <h4 style="margin: 0 0 10px 0; color: #ffcc00;">é•œå¤´2æµ‹è¯•</h4>
        
        <button class="test-button" onclick="startScene2()">å¼€å§‹é•œå¤´2</button>
        <button class="test-button" onclick="testN001()">æµ‹è¯•N001æ’­æ”¾</button>
        <button class="test-button" onclick="testN002()">æµ‹è¯•N002æ’­æ”¾</button>
        <button class="test-button" onclick="testN003()">æµ‹è¯•N003æ’­æ”¾</button>
        <button class="test-button" onclick="testThunder()">æµ‹è¯•é›·å£°</button>
        <button class="test-button" onclick="showButton()">æ˜¾ç¤ºæ¿€æ´»æŒ‰é’®</button>
        <button class="test-button" onclick="restartScene()">é‡å¯åœºæ™¯</button>
        
        <div class="debug-info">
            <div>ç‚¹å‡»æ¬¡æ•°: <span id="click-count">0</span>/3</div>
            <div>å½“å‰è§†é¢‘: <span id="current-video">æ— </span></div>
            <div>çŠ¶æ€: <span id="scene-status">æœªåˆå§‹åŒ–</span></div>
        </div>
    </div>

    <!-- æ ¸å¿ƒåº“ -->
    <script src="scripts/utils/EventBus.js"></script>
    <script src="scripts/utils/ResourceLoader.js"></script>
    <script src="scripts/utils/DebugTools.js"></script>
    
    <!-- é…ç½®æ–‡ä»¶ -->
    <script src="config/global-config.js"></script>
    <script src="config/audio-config.js"></script>
    <script src="config/scene-config.js"></script>
    
    <!-- æ ¸å¿ƒç³»ç»Ÿ -->
    <script src="scripts/core/AudioManager.js"></script>
    <script src="scripts/core/SceneManager.js"></script>
    <script src="scripts/core/InteractionManager.js"></script>
    
    <!-- ç»„ä»¶ç³»ç»Ÿ -->
    <script src="scripts/components/SubtitleSystem.js"></script>
    <script src="scripts/components/EffectSystem.js"></script>
    <script src="scripts/components/UIComponents.js"></script>
    
    <!-- åœºæ™¯æ¨¡å— -->
    <script src="scripts/scenes/Scene1.js"></script>
    <script src="scripts/scenes/Scene2.js"></script>

    <script>
        let scene2Instance = null;
        let testClickCount = 0;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ§ª é•œå¤´2æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // åˆå§‹åŒ–äº‹ä»¶æ€»çº¿
            if (window.EventBus) {
                console.log('âœ… EventBuså·²å°±ç»ª');
            }
            
            // åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨
            if (window.AudioManager) {
                await window.AudioManager.initialize();
                console.log('âœ… AudioManagerå·²åˆå§‹åŒ–');
            }
            
            updateStatus('å·²å°±ç»ª');
        });
        
        // å¼€å§‹é•œå¤´2
        async function startScene2() {
            console.log('ğŸ¬ å¼€å§‹é•œå¤´2æµ‹è¯•');
            
            try {
                updateStatus('å¯åŠ¨ä¸­...');
                
                // è·å–åœºæ™¯é…ç½®
                const scene2Config = window.SceneConfig?.scene2;
                if (!scene2Config) {
                    throw new Error('é•œå¤´2é…ç½®æœªæ‰¾åˆ°');
                }
                
                // åˆ›å»ºåœºæ™¯å®ä¾‹
                scene2Instance = new window.Scene2(scene2Config);
                
                // åˆå§‹åŒ–åœºæ™¯
                await scene2Instance.initialize();
                
                updateStatus('è¿è¡Œä¸­');
                console.log('âœ… é•œå¤´2å¯åŠ¨æˆåŠŸ');
                
                // ç›‘å¬çŠ¶æ€å˜åŒ–
                setInterval(updateDebugInfo, 1000);
                
            } catch (error) {
                console.error('âŒ é•œå¤´2å¯åŠ¨å¤±è´¥:', error);
                updateStatus('å¯åŠ¨å¤±è´¥');
                alert('é•œå¤´2å¯åŠ¨å¤±è´¥: ' + error.message);
            }
        }
        
        // æµ‹è¯•N001æ’­æ”¾
        function testN001() {
            if (scene2Instance) {
                scene2Instance.step1_PlayN001();
                updateCurrentVideo('N001');
            }
        }
        
        // æµ‹è¯•N002æ’­æ”¾
        function testN002() {
            if (scene2Instance) {
                scene2Instance.step2_PlayN002();
                updateCurrentVideo('N002');
            }
        }
        
        // æµ‹è¯•N003æ’­æ”¾
        function testN003() {
            if (scene2Instance) {
                scene2Instance.playN003();
                updateCurrentVideo('N003');
            }
        }
        
        // æµ‹è¯•é›·å£°
        function testThunder() {
            if (window.AudioManager) {
                window.AudioManager.playAmbient('thunder');
                console.log('ğŸŒ©ï¸ é›·å£°æµ‹è¯•æ’­æ”¾');
            }
        }
        
        // æ˜¾ç¤ºæ¿€æ´»æŒ‰é’®
        function showButton() {
            if (scene2Instance) {
                scene2Instance.showActivateButton();
                console.log('ğŸ¯ æ¿€æ´»æŒ‰é’®å·²æ˜¾ç¤º');
            }
        }
        
        // é‡å¯åœºæ™¯
        function restartScene() {
            if (scene2Instance) {
                scene2Instance.cleanup();
                scene2Instance = null;
            }
            
            // æ¸…ç†å®¹å™¨
            const container = document.getElementById('scene-container');
            if (container) {
                container.innerHTML = '';
            }
            
            updateStatus('å·²é‡ç½®');
            updateCurrentVideo('æ— ');
            updateClickCount(0);
            
            console.log('ğŸ”„ åœºæ™¯å·²é‡ç½®');
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(status) {
            document.getElementById('scene-status').textContent = status;
        }
        
        function updateCurrentVideo(video) {
            document.getElementById('current-video').textContent = video;
        }
        
        function updateClickCount(count) {
            testClickCount = count;
            document.getElementById('click-count').textContent = count;
        }
        
        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo() {
            if (scene2Instance) {
                const status = scene2Instance.getStatus();
                updateClickCount(status.clickCount);
                updateCurrentVideo(status.currentVideo || 'æ— ');
                
                if (status.isWaitingForClicks) {
                    updateStatus('ç­‰å¾…ç‚¹å‡»');
                } else {
                    updateStatus('è¿è¡Œä¸­');
                }
            }
        }
        
        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case '1':
                    startScene2();
                    break;
                case '2':
                    testN001();
                    break;
                case '3':
                    testN002();
                    break;
                case '4':
                    testN003();
                    break;
                case '5':
                    testThunder();
                    break;
                case '6':
                    showButton();
                    break;
                case 'r':
                case 'R':
                    restartScene();
                    break;
            }
        });
        
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', (e) => {
            console.error('âŒ å…¨å±€é”™è¯¯:', e.error);
            updateStatus('é”™è¯¯');
        });
        
        // å¯¼å‡ºåˆ°å…¨å±€ä»¥ä¾¿è°ƒè¯•
        window.testScene2 = {
            instance: () => scene2Instance,
            start: startScene2,
            restart: restartScene,
            testN001,
            testN002,
            testN003,
            testThunder,
            showButton
        };
        
        console.log('ğŸ§ª é•œå¤´2æµ‹è¯•APIå·²å°±ç»ª: window.testScene2');
        console.log('ğŸ® å¿«æ·é”®: 1=å¼€å§‹, 2=N001, 3=N002, 4=N003, 5=é›·å£°, 6=æŒ‰é’®, R=é‡å¯');
    </script>
</body>
</html> 