<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é•œå¤´3ï¼šç©¿è¶Šæ—¶ç©ºæ¼©æ¶¡ - ä»£å·qin</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            overflow: hidden;
            font-family: 'Microsoft YaHei', sans-serif;
            color: white;
            cursor: auto;
        }
        
        #scene3-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            overflow: hidden;
        }
        
        /* è§†é¢‘æ’­æ”¾å™¨ */
        .video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* çœ©æ™•æ¨¡ç³Šè¿‡æ¸¡æ•ˆæœ */
        .blur-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transition: backdrop-filter 3s ease-out, opacity 3s ease-out;
            z-index: 2;
        }
        
        .blur-overlay.clear {
            backdrop-filter: blur(0px);
            opacity: 0;
        }
        
        /* åœ†å½¢æ³¢åŠ¨æŒ‰é’®æ ·å¼ - ä¸å‰é¢é•œå¤´ä¿æŒä¸€è‡´ */
        .continue-ripple-button {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.05) 70%, transparent 100%);
            border: 3px solid rgba(255, 255, 255, 0.6);
            z-index: 999999;
            opacity: 0;
            visibility: hidden;
            animation: rippleButton 2s infinite;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            }

        .continue-ripple-button::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: rippleWave 2s infinite;
            z-index: -1;
            }

        .continue-ripple-button::after {
            content: '';
            position: absolute;
            width: 120%;
            height: 120%;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: rippleWave 2s infinite 0.5s;
            z-index: -2;
        }

        .continue-button-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            text-align: center;
            font-family: 'Microsoft YaHei', sans-serif;
            pointer-events: none;
        }
        
        .continue-ripple-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.1) 70%, transparent 100%);
            border-color: rgba(255, 255, 255, 0.8);
        }
        
        .continue-ripple-button.show {
            opacity: 1;
            visibility: visible;
        }
        
        @keyframes rippleButton {
            0% { 
                opacity: 0.6; 
                transform: translate(-50%, -50%) scale(1); 
            }
            50% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.05); 
            }
            100% { 
                opacity: 0.6; 
                transform: translate(-50%, -50%) scale(1); 
            }
        }

        @keyframes rippleWave {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% { 
                transform: scale(1.5);
                opacity: 0;
            }
        }
        
        /* ä½é¢æ¢ç´¢çƒä½“å®¹å™¨ */
        .exploration-orbs {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
            cursor: auto;
        }
        
        /* ä½é¢è¯†åˆ«æ–‡å­—æ˜¾ç¤ºåŒºåŸŸ - å¯¹è¯æ³¡æ³¡æ ·å¼ï¼Œå‘ä¸Šç§»åŠ¨æ›´é è¿‘çƒä½“ */
        .plane-text-display {
            position: fixed;
            bottom: 200px; /* ä»80pxæå‡åˆ°200pxï¼Œæ›´é è¿‘çƒä½“ */
            left: 50%;
            transform: translateX(-50%);
            z-index: 30000;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s ease-in-out;
            transform-origin: center;
        }
        
        .plane-text-display.show {
            opacity: 1;
            transform: translateX(-50%) scale(1.05);
        }
        
        .text-content {
            background: rgba(255, 255, 255, 0.95);
            color: #000;
            padding: 15px 20px;
            border-radius: 20px;
            border: 3px solid #333;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            text-align: center;
            font-family: 'Microsoft YaHei', sans-serif;
            position: relative;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* å¯¹è¯æ³¡æ³¡å°¾å·´ */
        .text-content::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 12px solid transparent;
            border-top-color: #333;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .text-content::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 9px solid transparent;
            border-top-color: rgba(255, 255, 255, 0.95);
            bottom: -21px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
        }
        
        /* é€å­—æ˜¾ç¤ºæ•ˆæœ */
        .typing-char {
            opacity: 0;
            animation: typeIn 0.15s ease-in-out forwards;
        }
        
        @keyframes typeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ç‚¹å‡»æŒ‡å¼•æ ·å¼ï¼Œå‘ä¸Šç§»åŠ¨æ›´é è¿‘çƒä½“ */
        .click-guide {
            position: fixed;
            bottom: 270px; /* ä»150pxæå‡åˆ°270pxï¼Œæ›´é è¿‘çƒä½“ */
            left: 50%;
            transform: translateX(-50%);
            z-index: 30000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            text-align: center;
        }
        
        .click-guide.show {
            opacity: 1;
        }
        
        .hand-icon {
            font-size: 40px;
            margin-bottom: 10px;
            animation: handBounce 1.5s ease-in-out infinite;
        }
        
        .guide-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            font-family: 'Microsoft YaHei', sans-serif;
            animation: textPulse 2s ease-in-out infinite;
        }
        
        @keyframes handBounce {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-15px);
            }
        }
        
        @keyframes textPulse {
            0%, 100% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
        }
        
        /* å…¨å±ç‚¹å‡»è¦†ç›–å±‚ */
        .screen-click-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 25000;
            background: transparent;
            cursor: pointer;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .screen-click-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* ğŸŒŸ åŒå±‚çƒä½“ç»“æ„æ ·å¼ */
        .orb-container {
            /* åŸºç¡€æ ·å¼ç”±JavaScriptå†…è”è®¾ç½® */
        }
        
        /* ğŸ¯ å¤–å±‚å®¹å™¨æ‚¬åœæ•ˆæœ - ç§»é™¤å®¹å™¨æœ¬èº«çš„å¤–å‘å…‰ï¼Œåªä¿ç•™glowLayer */
        .orb-container.hovering {
            /* ç§»é™¤enhancedGlowåŠ¨ç”»ï¼Œé¿å…é¢å¤–çš„è§†è§‰å¹²æ‰° */
        }
        
        .orb-container.hovering .glow-layer {
            /* ç§»é™¤box-shadowï¼Œåªä½¿ç”¨background radial-gradientï¼Œé¿å…åŒé‡å‘å…‰ */
            opacity: 1 !important;
        }
        
        /* ğŸ¯ å¤–å±‚å®¹å™¨æ”¾å¤§çŠ¶æ€ - æ”¹ä¸º2.4å€ï¼ˆä»10pxæ”¾å¤§åˆ°240pxï¼‰ */
        .orb-container.enlarged {
            animation: none !important;
            transform: translate(-50%, -50%) scale(2.4) !important;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
            z-index: 1000 !important;
        }
        
        /* ğŸŒŸ ç»Ÿä¸€çƒä½“è§†é¢‘æ ·å¼å®šä¹‰ */
        .orb-video {
            /* å¤–å±‚å®¹å™¨154px + å†…å±‚è§†é¢‘220px + clip-path(36%) = å®Œç¾è´´åˆçš„å¤–å‘å…‰æ•ˆæœ */
        }
        
        /* ç§»é™¤video hoveræ•ˆæœï¼Œé¿å…é¼ æ ‡æ¶ˆå¤±é—®é¢˜ */
        
        /* çƒä½“æ¼‚æµ®åŠ¨ç”» - ä¿æŒscale(2.4)é¿å…ç¼©å°è·³è·ƒ */
        @keyframes orb-float {
            0%, 100% {
                transform: translate(-50%, -50%) scale(2.4) translateY(0px);
            }
            50% {
                transform: translate(-50%, -50%) scale(2.4) translateY(-15px);
            }
        }
        
        /* çƒä½“æ‚¬åœå‘å…‰æ•ˆæœ - æ›´å¼ºçƒˆçš„è„‰å†²å‘å…‰ */
        @keyframes orb-glow-pulse {
            0%, 100% {
                box-shadow: 
                    0 0 25px 10px rgba(88, 145, 171, 0.7), 
                    0 0 50px 20px rgba(88, 145, 171, 0.4),
                    0 0 75px 30px rgba(88, 145, 171, 0.2);
                filter: drop-shadow(0 0 15px rgba(88, 145, 171, 0.8));
            }
            50% {
                box-shadow: 
                    0 0 40px 15px rgba(88, 145, 171, 0.9), 
                    0 0 80px 30px rgba(88, 145, 171, 0.6), 
                    0 0 120px 40px rgba(88, 145, 171, 0.4);
                filter: drop-shadow(0 0 30px rgba(88, 145, 171, 1));
        }
        }
        
        /* ğŸŒŸ å¢å¼ºçš„å‘å…‰åŠ¨ç”» */
        @keyframes enhancedGlow {
            0%, 100% { 
                filter: brightness(1.3) saturate(1.3) hue-rotate(0deg);
            }
            50% { 
                filter: brightness(1.6) saturate(1.5) hue-rotate(10deg);
            }
        }
        
        /* ğŸš€ çƒä½“é£å‡ºåŠ¨ç”» - ä¿®å¤é¼ æ ‡æ¶ˆå¤±é—®é¢˜ï¼Œç§»é™¤ä½ç½®åç§» */
        @keyframes orbFlyOut {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.8;
                filter: brightness(1.0);
            }
            30% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0.9;
                filter: brightness(1.1);
            }
            60% {
                transform: translate(-50%, -50%) scale(1.8);
                opacity: 1;
                filter: brightness(1.2);
        }
            100% {
                transform: translate(-50%, -50%) scale(2.4);
                opacity: 1;
                filter: brightness(1.0);
            }
        }
        

        
        /* æ§åˆ¶é¢æ¿ */
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 10000;
            min-width: 200px;
            border: 1px solid #333;
        }
        
        .control-button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: #333;
            color: white;
            border: 1px solid #666;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s;
        }
        
        .control-button:hover {
            background: #555;
        }
        
        .status {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #666;
            font-size: 10px;
            opacity: 0.8;
        }
        
        /* é˜¶æ®µæŒ‡ç¤ºå™¨ - ç§»åˆ°å·¦ä¸‹è§’é¿å…ä¸æ§åˆ¶å°é‡å  */
        .phase-indicator {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: #FFD700;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 14px;
            z-index: 100;
            border: 1px solid #FFD700;
            display: none !important; /* éšè—æç¤º */
        }
        
        
        
        /* çƒä½“æ¶ˆå¤±ç‰¹æ•ˆ - ä¼˜åŒ–ä¸ºä»æ”¾å¤§çŠ¶æ€ç›´æ¥æ¶ˆå¤± */
        .orb-disappearing {
            animation: orbDisappear 2s ease-out forwards;
        }
        
        @keyframes orbDisappear {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(2.4) rotate(0deg); /* ä»2.4å€å¼€å§‹æ¶ˆå¤± */
                box-shadow: 0 0 60px rgba(88, 145, 171, 1);
            }
            30% {
                opacity: 0.9;
                transform: translate(-50%, -50%) scale(3.0) rotate(180deg); /* ç¨å¾®ç»§ç»­æ”¾å¤§ */
                box-shadow: 0 0 120px rgba(88, 145, 171, 1.2);
            }
            60% {
                opacity: 0.6;
                transform: translate(-50%, -50%) scale(4.2) rotate(270deg); /* ç»§ç»­æ”¾å¤§æ—‹è½¬ */
                box-shadow: 0 0 180px rgba(88, 145, 171, 1);
            }
            80% {
                opacity: 0.3;
                transform: translate(-50%, -50%) scale(6.0) rotate(360deg); /* æ›´å¤§æ›´äº® */
                box-shadow: 0 0 240px rgba(88, 145, 171, 0.8);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(8.4) rotate(540deg); /* æœ€ç»ˆå·¨å¤§æ¶ˆå¤± */
                box-shadow: none;
            }
        }
        
        /* å…‰ç¯æ‰©æ•£ç‰¹æ•ˆ */
        .orb-glow-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(88, 145, 171, 0.8);
            transform: translate(-50%, -50%);
            animation: glowRingExpand 2s ease-out;
            pointer-events: none;
        }
        
        @keyframes glowRingExpand {
            0% {
                width: 100%;
                height: 100%;
                border-width: 3px;
                opacity: 1;
            }
        }

        
        /* ç²’å­çˆ†æ•£ç‰¹æ•ˆ */
        .orb-particles {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(88, 145, 171, 1) 0%, rgba(88, 145, 171, 0.8) 50%, transparent 100%);
            border-radius: 50%;
            animation: particleExplosion 1.5s ease-out;
        }
        
        @keyframes particleExplosion {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--dx), var(--dy)) scale(0.2);
            }
        }
        
        /* ğŸŒŸ æ–°å¢å‘å…‰è„‰å†²åŠ¨ç”» */
        @keyframes glowPulse {
            0%, 100% { 
                filter: brightness(1) saturate(1);
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                filter: brightness(1.3) saturate(1.2);
                transform: translate(-50%, -50%) scale(1.05);
            }
        }
        
        /* ğŸ† æ³¡æ³¡çˆ†æ‰æ¶ˆå¤±æ•ˆæœ - ä»2å€å¼€å§‹ */
        @keyframes bubblePop {
            0% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 1;
                filter: brightness(1) blur(0px);
            }
            25% {
                transform: translate(-50%, -50%) scale(2.5);
                opacity: 0.6;
                filter: brightness(1.2) blur(1px);
            }
            50% {
                transform: translate(-50%, -50%) scale(3);
                opacity: 0.3;
                filter: brightness(1.5) blur(3px);
                border-radius: 30%;
            }
            75% {
                transform: translate(-50%, -50%) scale(3.5);
                opacity: 0.1;
                filter: brightness(2) blur(5px);
                border-radius: 10%;
            }
            100% {
                transform: translate(-50%, -50%) scale(4);
                opacity: 0;
                filter: brightness(3) blur(8px);
                border-radius: 0%;
            }
        }
        
        /* ğŸ† ç²’å­çˆ†ç‚¸å¢å¼ºæ•ˆæœ */
        @keyframes particleExplosion {
            0% {
                transform: scale(0) translate(0, 0);
                opacity: 1;
                filter: brightness(2);
            }
            30% {
                transform: scale(1.5) translate(var(--dx), var(--dy));
                opacity: 0.9;
                filter: brightness(1.8);
            }
            70% {
                transform: scale(2) translate(calc(var(--dx) * 2), calc(var(--dy) * 2));
                opacity: 0.4;
                filter: brightness(1.2);
            }
            100% {
                transform: scale(0.5) translate(calc(var(--dx) * 3), calc(var(--dy) * 3));
                opacity: 0;
                filter: brightness(0.5);
            }
        }
    </style>
</head>
<body>
    <div id="scene3-container">
        <!-- ä¸»è§†é¢‘æ’­æ”¾å™¨ -->
        <video class="video-player" id="main-video" preload="auto">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
        </video>
        
        <!-- éŸ³é¢‘æ’­æ”¾å™¨ -->
        <audio id="background-audio" preload="auto">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
        </audio>
        
        <!-- é˜¶æ®µ1éŸ³æ•ˆæ’­æ”¾å™¨ -->
        <audio id="phase1-audio" preload="auto">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
        </audio>
        
        <!-- çƒä½“éŸ³æ•ˆæ’­æ”¾å™¨ -->
        <audio id="orb-sound" preload="auto">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
        </audio>
        
        <!-- çœ©æ™•æ¨¡ç³Šè¿‡æ¸¡å±‚ -->
        <div class="blur-overlay" id="blur-overlay"></div>
        
        <!-- ç‚¹å‡»ç»§ç»­æç¤º -->
        <div class="continue-ripple-button" id="click-continue">
            <div class="continue-button-text">ç‚¹å‡»ç»§ç»­</div>
        </div>
        
        <!-- ä½é¢æ¢ç´¢çƒä½“å®¹å™¨ -->
        <div class="exploration-orbs" id="exploration-orbs">
            <!-- çƒä½“å°†é€šè¿‡JavaScriptåŠ¨æ€åˆ›å»º -->
        </div>
        
        <!-- ä½é¢è¯†åˆ«æ–‡å­—æ˜¾ç¤ºåŒºåŸŸ -->
        <div id="plane-text-display" class="plane-text-display">
            <div class="text-content"></div>
        </div>
        
        <!-- ç‚¹å‡»æŒ‡å¼• -->
        <div id="click-guide" class="click-guide">
            <div class="hand-icon">ğŸ‘†</div>
            <div class="guide-text">ç‚¹å‡»å±å¹•ç»§ç»­</div>
        </div>
        
        <!-- å…¨å±ç‚¹å‡»è¦†ç›–å±‚ -->
        <div id="screen-click-overlay" class="screen-click-overlay"></div>
        
        <!-- é˜¶æ®µæŒ‡ç¤ºå™¨ -->
        <div class="phase-indicator" id="phase-indicator">
            é˜¶æ®µ1ï¼šçœ©æ™•è‹é†’
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="controls" id="debug-controls">
            <h4 style="margin: 0 0 10px 0; color: #ffcc00;">é•œå¤´3ï¼šæ—¶ç©ºç©¿è¶Š</h4>
            <button class="control-button" onclick="startScene()">å¼€å§‹åœºæ™¯</button>
            <button class="control-button" onclick="skipToExploration()">è·³è½¬åˆ°ä½é¢æ¢ç´¢</button>
            <button class="control-button" onclick="skipToConfirm()">è·³è½¬åˆ°ç¡®è®¤ç©¿è¶Š</button>
            <button class="control-button" onclick="restartScene()">é‡æ–°å¼€å§‹</button>
            <button class="control-button" onclick="nextScene()">ä¸‹ä¸€é•œå¤´</button>
            
            <div class="status">
                <div>çŠ¶æ€: <span id="scene-status">å‡†å¤‡ä¸­</span></div>
                <div>é˜¶æ®µ: <span id="current-phase">çœ©æ™•è‹é†’</span></div>
                <div>è¿›åº¦: <span id="scene-progress">0%</span></div>
            </div>
        </div>
    </div>

    <script src="scripts/keyboardToggle.js"></script>

    <script>
        class Scene3TimeVortex {
            constructor() {
                this.container = document.getElementById('scene3-container');
                this.mainVideo = document.getElementById('main-video');
                this.backgroundAudio = document.getElementById('background-audio');
                this.phase1Audio = document.getElementById('phase1-audio');
                this.orbSound = document.getElementById('orb-sound');
                this.blurOverlay = document.getElementById('blur-overlay');
                this.clickContinue = document.getElementById('click-continue');
                this.explorationOrbs = document.getElementById('exploration-orbs');
                this.phaseIndicator = document.getElementById('phase-indicator');
                this.planeTextDisplay = document.getElementById('plane-text-display');
                this.clickGuide = document.getElementById('click-guide');
                this.screenClickOverlay = document.getElementById('screen-click-overlay');
                
                // çŠ¶æ€æŒ‡ç¤ºå™¨
                this.sceneStatus = document.getElementById('scene-status');
                this.currentPhase = document.getElementById('current-phase');
                this.sceneProgress = document.getElementById('scene-progress');
                
                // åœºæ™¯çŠ¶æ€
                this.phase = 1; // 1:çœ©æ™•è‹é†’, 2:æ¼©æ¶¡å…¨æ™¯, 3:ä½é¢æ¢ç´¢, 4:ç¡®è®¤ç©¿è¶Š
                this.isStarted = false;
                this.continueClicked = false;
                this.completedOrbs = 0; // è®°å½•å·²å®Œæˆæ’­æ”¾çš„çƒä½“æ•°é‡
                this.userInteracted = false; // è®°å½•ç”¨æˆ·æ˜¯å¦å·²äº¤äº’
                this.currentOrbIndex = 0; // å½“å‰çƒä½“ç´¢å¼•
                this.inOrbPhase = false; // æ ‡è®°æ˜¯å¦åœ¨çƒä½“é˜¶æ®µ
                this.currentOrbContainer = null; // å½“å‰æ­£åœ¨æ’­æ”¾çš„çƒä½“å®¹å™¨
                this.currentOrbVideo = null; // å½“å‰æ­£åœ¨æ’­æ”¾çš„çƒä½“è§†é¢‘
                
                // è§†é¢‘èµ„æºè·¯å¾„
                this.videos = {
                    dizzy: 'é•œå¤´3/1/C03001.mp4',        // çœ©æ™•è‹é†’å’Œæ¼©æ¶¡å…¨æ™¯
                    orb1: 'é•œå¤´3/2/C03002-1.mp4',      // ä½é¢1è§†é¢‘
                    orb2: 'é•œå¤´3/2/C03002-2.mp4',      // ä½é¢2è§†é¢‘
                    orb3: 'é•œå¤´3/2/C03002-3.mp4',      // ä½é¢3è§†é¢‘
                    orb4: 'é•œå¤´3/2/C03002-4.mp4',      // ä½é¢4è§†é¢‘
                    confirm: 'é•œå¤´3/3/C03003.mp4'       // ç¡®è®¤ç©¿è¶Š
                };
                
                // éŸ³é¢‘èµ„æº
                this.audio = {
                    background: 'é•œå¤´3/1/S03002.MP3',       // èƒŒæ™¯éŸ³ä¹ï¼ˆå…¨ç¨‹å¾ªç¯ï¼‰
                    phase1Audio: 'é•œå¤´3/1/S03001.MP3',      // é˜¶æ®µ1éŸ³æ•ˆï¼ˆ5ç§’åæ’­æ”¾ï¼‰
                    orbSound: 'é•œå¤´3/2/pong.MP3'            // çƒä½“å‡ºç°éŸ³æ•ˆ
                };
                
                // ä½é¢æ•°æ®
                this.orbs = [
                    { 
                        id: 'orb1', 
                        name: 'è‰èˆ¹å€Ÿç®­', 
                        position: { x: '25%', y: '20%' }, 
                        video: 'orb1',
                        text: 'è¿™æ˜¯...è‰èˆ¹å€Ÿç®­ï¼Ÿï¼'
                    },
                    { 
                        id: 'orb2', 
                        name: 'å¥³çš‡æœå ‚', 
                        position: { x: '75%', y: '25%' }, 
                        video: 'orb2',
                        text: 'æœå ‚é«˜åçš„è¿™æ˜¯å¥³çš‡æ­¦åˆ™å¤©ï¼Ÿ'
                    },
                    { 
                        id: 'orb3', 
                        name: 'éƒ‘å’Œä¸‹è¥¿æ´‹', 
                        position: { x: '20%', y: '70%' }, 
                        video: 'orb3',
                        text: 'éƒ‘å’Œä¸‹è¥¿æ´‹ï¼ï¼Ÿ'
                    },
                    { 
                        id: 'orb4', 
                        name: 'ä¹å°¾ç‹', 
                        position: { x: '70%', y: '65%' }, 
                        video: 'orb4',
                        text: 'å—¯ï¼Ÿä¹...ä¹å°¾ç‹ï¼Ÿï¼'
                    }
                ];
                
                this.selectedOrb = null;
                
                this.init();
            }
            
            init() {
                console.log('ğŸ¬ é•œå¤´3ï¼šæ—¶ç©ºæ¼©æ¶¡åˆå§‹åŒ–');
                
                // æ£€æŸ¥æ˜¯å¦åœ¨iframeä¸­è¿è¡Œï¼Œå¦‚æœæ˜¯åˆ™éšè—æ§åˆ¶é¢æ¿
                if (window.parent !== window) {
                    const debugControls = document.getElementById('debug-controls');
                    if (debugControls) {
                        debugControls.style.display = 'none';
                        console.log('ğŸ–¥ï¸ åœ¨iframeä¸­è¿è¡Œï¼Œå·²éšè—è°ƒè¯•æ§åˆ¶é¢æ¿');
                    }
                }
                
                this.updateStatus('å‡†å¤‡ä¸­...');
                this.setupEventListeners();
                
                // é¢„åŠ è½½è§†é¢‘èµ„æº
                this.preloadResources();
                
                // è‡ªåŠ¨å¼€å§‹åœºæ™¯
                setTimeout(() => {
                    this.startScene();
                }, 1000);
            }
            
            preloadResources() {
                // é¢„åŠ è½½ä¸»è¦è§†é¢‘å’ŒèƒŒæ™¯éŸ³ä¹
                this.mainVideo.src = this.videos.dizzy;
                this.backgroundAudio.src = this.audio.background;
                
                // é¢„åŠ è½½é˜¶æ®µ1éŸ³æ•ˆå’Œçƒä½“éŸ³æ•ˆ
                this.phase1Audio.src = this.audio.phase1Audio;
                this.orbSound.src = this.audio.orbSound;
                
                // ä½¿ç”¨è§†é¢‘é¢„åŠ è½½ç³»ç»Ÿ
                if (window.videoPreloader) {
                    console.log('ğŸ¥ å¼€å§‹é¢„åŠ è½½é•œå¤´3æ‰€æœ‰è§†é¢‘...');
                    const allVideos = [
                        this.videos.dizzy,
                        this.videos.orb1,
                        this.videos.orb2, 
                        this.videos.orb3,
                        this.videos.orb4,
                        this.videos.confirm
                    ];
                    
                    window.videoPreloader.preloadVideoList(allVideos, (loaded, total, progress) => {
                        console.log(`ğŸ¥ é•œå¤´3è§†é¢‘é¢„åŠ è½½è¿›åº¦: ${loaded}/${total} (${progress.toFixed(1)}%)`);
                    });
                }
                
                console.log('ğŸ“¦ é¢„åŠ è½½è§†é¢‘å’ŒéŸ³é¢‘èµ„æºå®Œæˆ');
            }
            
            setupEventListeners() {
                // ç‚¹å‡»ç»§ç»­äº‹ä»¶
                this.clickContinue.addEventListener('click', () => {
                    this.handleContinueClick();
                });
                
                // è§†é¢‘æ’­æ”¾äº‹ä»¶
                this.mainVideo.addEventListener('loadeddata', () => {
                    console.log('ğŸ“¹ è§†é¢‘åŠ è½½å®Œæˆ');
                });
                
                this.mainVideo.addEventListener('ended', () => {
                    this.handleVideoEnded();
                });
                
                // å…¨å±ç‚¹å‡»äº‹ä»¶ï¼ˆæ¼©æ¶¡å…¨æ™¯é˜¶æ®µï¼‰
                this.container.addEventListener('click', (e) => {
                    if (this.phase === 2 && !this.continueClicked && e.target === this.container) {
                        this.handleContinueClick();
                    }
                });
                
                // å…¨å±è¦†ç›–å±‚ç‚¹å‡»äº‹ä»¶ï¼ˆçƒä½“æ’­æ”¾å®Œæˆåï¼‰
                this.screenClickOverlay.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (this.currentOrbContainer && this.currentOrbVideo) {
                        const orbData = this.orbs.find(orb => this.currentOrbVideo.id === orb.id);
                        if (orbData) {
                            this.handleOrbClick(orbData, this.currentOrbContainer, this.currentOrbVideo);
                        }
                    }
                });
            }
            
            startScene() {
                if (this.isStarted) return;
                
                console.log('ğŸŒ€ å¼€å§‹é•œå¤´3ï¼šæ—¶ç©ºç©¿è¶Š');
                this.isStarted = true;
                this.userInteracted = true; // æ ‡è®°ç”¨æˆ·å·²äº¤äº’
                
                // ğŸµ å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹S03002.MP3ï¼ˆå…¨ç¨‹å¾ªç¯ï¼‰
                this.backgroundAudio.src = this.audio.background;
                this.backgroundAudio.loop = true; // å¾ªç¯æ’­æ”¾
                this.backgroundAudio.volume = 0.6;
                this.backgroundAudio.currentTime = 0;
                this.backgroundAudio.muted = false;
                
                this.backgroundAudio.play().then(() => {
                    console.log('âœ… èƒŒæ™¯éŸ³ä¹S03002.MP3å¼€å§‹å¾ªç¯æ’­æ”¾');
                }).catch(e => {
                    console.log('âŒ èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                });
                
                this.startPhase1();
            }
            
            // é˜¶æ®µ1ï¼šçœ©æ™•è‹é†’ï¼ˆ0-5ç§’ï¼‰
            startPhase1() {
                this.phase = 1;
                this.updatePhase('é˜¶æ®µ1ï¼šçœ©æ™•è‹é†’');
                this.updateStatus('çœ©æ™•è‹é†’ä¸­...');
                this.updateProgress(10);
                
                console.log('ğŸ˜µ é˜¶æ®µ1ï¼šçœ©æ™•è‹é†’å¼€å§‹');
                
                // ğŸ¬ C03001ç°åœ¨æ˜¯çº¯è§†é¢‘ï¼Œé™éŸ³å¾ªç¯æ’­æ”¾
                this.mainVideo.src = this.videos.dizzy;
                this.mainVideo.currentTime = 0;
                this.mainVideo.muted = true; // çº¯è§†é¢‘ï¼Œé™éŸ³æ’­æ”¾
                this.mainVideo.loop = true; // å¾ªç¯æ’­æ”¾
                this.mainVideo.autoplay = true;
                
                // æ’­æ”¾çº¯è§†é¢‘
                this.mainVideo.play().then(() => {
                    console.log('âœ… C03001çº¯è§†é¢‘å¾ªç¯æ’­æ”¾æˆåŠŸï¼');
                }).catch(e => {
                    console.log('âŒ C03001è§†é¢‘æ’­æ”¾å¤±è´¥:', e);
                });
                
                // æ¨¡ç³Šè¿‡æ¸¡æ•ˆæœï¼ˆ3ç§’å†…ä»æ¨¡ç³Šåˆ°æ¸…æ™°ï¼‰
                setTimeout(() => {
                    this.blurOverlay.classList.add('clear');
                }, 2000);
                
                // ğŸµ 3ç§’åæ’­æ”¾é˜¶æ®µ1éŸ³æ•ˆS03001.MP3ï¼ˆæå‰2ç§’ï¼‰
                setTimeout(() => {
                    this.phase1Audio.volume = 0.7;
                    this.phase1Audio.currentTime = 0;
                    this.phase1Audio.play().then(() => {
                        console.log('âœ… é˜¶æ®µ1éŸ³æ•ˆS03001.MP3å¼€å§‹æ’­æ”¾ï¼ˆæå‰2ç§’ï¼‰');
                    }).catch(e => {
                        console.log('âŒ é˜¶æ®µ1éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
                    });
                }, 3000);
                
                // 9ç§’åè¿›å…¥é˜¶æ®µ2ï¼ˆåŸæ¥æ˜¯5ç§’ï¼Œç°åœ¨æ”¹ä¸º9ç§’ï¼Œç¬¦åˆç”¨æˆ·æ–¹æ¡ˆï¼‰
                setTimeout(() => {
                    this.startPhase2();
                }, 9000);
            }
            


            handleContinueClick() {
                if (this.phase !== 2 || this.continueClicked) return;
                
                console.log('ğŸ‘† ç”¨æˆ·ç‚¹å‡»ç»§ç»­');
                this.continueClicked = true;
                this.userInteracted = true;
                
                // S03002.MP3èƒŒæ™¯éŸ³ä¹å·²åœ¨åœºæ™¯å¼€å§‹æ—¶æ’­æ”¾ï¼Œç»§ç»­è¿›å…¥é˜¶æ®µ3
                console.log('ğŸµ S03002.MP3èƒŒæ™¯éŸ³ä¹ç»§ç»­æ’­æ”¾ï¼Œè¿›å…¥é˜¶æ®µ3');
                
                // éšè—ç»§ç»­æŒ‰é’®
                this.clickContinue.classList.remove('show');
                this.clickContinue.style.display = 'none';
                
                setTimeout(() => {
                    this.startPhase3();
                }, 500);
            }
            
            // é˜¶æ®µ2ï¼šæ¼©æ¶¡å…¨æ™¯ï¼ˆ5-10ç§’ï¼‰
            startPhase2() {
                this.phase = 2;
                this.updatePhase('é˜¶æ®µ2ï¼šæ¼©æ¶¡å…¨æ™¯');
                this.updateStatus('æ¼©æ¶¡å…¨æ™¯å±•ç¤º...');
                this.updateProgress(30);
                
                console.log('ğŸŒ€ é˜¶æ®µ2ï¼šæ¼©æ¶¡å…¨æ™¯å¼€å§‹');
                
                // C03001ç»§ç»­å¾ªç¯æ’­æ”¾ï¼ˆå·²ç»åœ¨é˜¶æ®µ1è®¾ç½®ï¼‰
                // èƒŒæ™¯éŸ³ä¹S03002.MP3ç»§ç»­æ’­æ”¾ï¼ˆå·²ç»åœ¨startSceneå¼€å§‹ï¼‰
                
                console.log('ğŸµ é˜¶æ®µ2ï¼šç»§ç»­æ’­æ”¾C03001è§†é¢‘å’ŒS03002èƒŒæ™¯éŸ³ä¹');
                
                // æ˜¾ç¤ºç‚¹å‡»ç»§ç»­æç¤ºï¼ˆæå‰3ç§’å‡ºç°ï¼‰
                setTimeout(() => {
                    if (this.phase === 2 && !this.inOrbPhase && !this.continueClicked) { // ç¡®ä¿åªåœ¨é˜¶æ®µ2æ˜¾ç¤ºï¼Œä¸”ä¸åœ¨çƒä½“é˜¶æ®µ
                        this.clickContinue.style.display = 'flex'; // é‡ç½®æ˜¾ç¤º
                        this.clickContinue.style.visibility = 'visible';
                        this.clickContinue.style.pointerEvents = 'auto';
                        this.clickContinue.style.zIndex = '999999';
                        this.clickContinue.classList.add('show');
                    }
                }, 0); // ç«‹å³æ˜¾ç¤ºï¼Œæå‰3ç§’
            }
            
            // é˜¶æ®µ3ï¼šä½é¢æ¢ç´¢ï¼ˆ10-20ç§’ï¼‰
            startPhase3() {
                this.phase = 3;
                this.updatePhase('é˜¶æ®µ3ï¼šä½é¢æ¢ç´¢');
                this.updateStatus('ä½é¢æ¢ç´¢ä¸­...');
                this.updateProgress(60);
                
                console.log('ğŸ”® é˜¶æ®µ3ï¼šä½é¢æ¢ç´¢å¼€å§‹');
                
                // ğŸ”§ è®¾ç½®çƒä½“é˜¶æ®µæ ‡è®°ï¼Œå½»åº•éšè—"ç‚¹å‡»ç»§ç»­"æŒ‰é’®
                this.inOrbPhase = true;
                this.clickContinue.classList.remove('show');
                this.clickContinue.style.display = 'none';
                this.clickContinue.style.visibility = 'hidden';
                this.clickContinue.style.opacity = '0';
                this.clickContinue.style.pointerEvents = 'none';
                this.clickContinue.style.zIndex = '-1';
                
                // ğŸ¬ ä¿æŒèƒŒæ™¯è§†é¢‘å¾ªç¯æ’­æ”¾ï¼Œä¸è¦åœæ­¢
                this.mainVideo.loop = true;
                
                // åˆ›å»º4ä¸ªæ¢ç´¢çƒä½“
                this.createExplorationOrbs();
            }
            
            createExplorationOrbs() {
                console.log('ğŸŒ€ å¼€å§‹åˆ›å»ºå•ä¸ªçƒä½“åºåˆ—');
                this.currentOrbIndex = 0; // å½“å‰çƒä½“ç´¢å¼•
                this.createNextOrb(); // åˆ›å»ºç¬¬ä¸€ä¸ªçƒä½“
            }
            
            createNextOrb() {
                if (this.currentOrbIndex >= this.orbs.length) {
                    console.log('ğŸ‰ æ‰€æœ‰çƒä½“å·²å®Œæˆ');
                    this.startPhase4();
                    return;
                }
                
                const orbData = this.orbs[this.currentOrbIndex];
                console.log(`ğŸš€ åˆ›å»ºçƒä½“ ${this.currentOrbIndex + 1}/4: ${orbData.name}`);
                this.createSingleOrbInCenter(orbData);
            }
            
            createSingleOrbInCenter(orbData) {
                console.log(`ğŸ¯ åˆ›å»ºä¸­å¤®çƒä½“: ${orbData.name}`);
                
                // ğŸŒŸ åˆ›å»ºåŒå±‚ç»“æ„ï¼šå¤–å±‚å®¹å™¨ + å†…å±‚è§†é¢‘
                const orbContainer = document.createElement('div');
                orbContainer.className = 'orb-container';
                orbContainer.id = `container-${orbData.id}`;
                
                // åˆ›å»ºçƒä½“è§†é¢‘å…ƒç´ ï¼ˆå†…å±‚ï¼‰
                const orbVideo = document.createElement('video');
                orbVideo.id = orbData.id;
                orbVideo.className = 'orb-video';
                orbVideo.src = this.videos[orbData.video];
                orbVideo.preload = 'auto'; // æ”¹ä¸ºautoï¼Œç¡®ä¿è§†é¢‘å®Œå…¨é¢„åŠ è½½
                orbVideo.muted = true; // åˆå§‹é™éŸ³ï¼Œæ’­æ”¾æ—¶å†å¼€å¯å£°éŸ³
                orbVideo.loop = false; // å•æ¬¡æ’­æ”¾ï¼Œä¸å¾ªç¯
                orbVideo.controls = false;
                orbVideo.autoplay = false; // ç¨åé€šè¿‡ä»£ç æ§åˆ¶æ’­æ”¾
                
                // æ·»åŠ è§†é¢‘é¢„åŠ è½½æ”¯æŒ
                if (window.videoPreloader) {
                    window.videoPreloader.preloadVideo(this.videos[orbData.video]);
                }
                
                // ğŸŒŸ å¤–å±‚å®¹å™¨æ ·å¼ï¼šä»0å¼€å§‹ï¼Œå‡ºç°åŠ¨ç”»åˆ°200px
                orbContainer.style.cssText = `
                    position: absolute;
                    left: 50%;
                    top: 50%;
                    width: 10px;
                    height: 10px;
                    cursor: pointer;
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                    z-index: 100;
                    pointer-events: auto;
                    cursor: pointer;
                    border-radius: 50%;
                    
                    /* å¤–å‘å…‰ç°åœ¨ç”±ç‹¬ç«‹çš„glowLayerå¤„ç† */
                        
                    /* ç§»é™¤åˆå§‹å‘å…‰çƒèƒŒæ™¯ï¼Œé¿å…è§†é¢‘å†…éƒ¨å‡ºç°è“è‰²å‘å…‰ */
                    background: transparent;
                `;
                
                // ğŸŒŸ å†…å±‚è§†é¢‘æ ·å¼ï¼šä½¿ç”¨ç™¾åˆ†æ¯”å°ºå¯¸ï¼Œè·Ÿéšå®¹å™¨ä»10pxåˆ°200pxåŒæ­¥ç¼©æ”¾
                orbVideo.style.cssText = `
                    position: relative;
                    width: 100%;
                    height: 100%;
                    left: 50%;
                    top: 50%;
                    transform: translate(-50%, -50%);
                    border-radius: 50%;
                    object-fit: cover;
                    object-position: center center;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    z-index: 10;
                    border: none !important;
                    box-shadow: none !important;
                    isolation: isolate;
                `;
                

                
                // åˆ›å»ºç™½è‰²å…‰çƒå±‚ï¼Œåœ¨é£å‡ºè¿‡ç¨‹ä¸­è¦†ç›–è§†é¢‘ï¼Œåˆ°è¾¾200pxåæ¶ˆå¤±
                const whiteLightBall = document.createElement('div');
                whiteLightBall.className = 'white-light-ball';
                whiteLightBall.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    border-radius: 50%;
                    background: radial-gradient(circle, 
                        rgba(255, 255, 255, 1.0) 0%, 
                        rgba(255, 255, 255, 1.0) 30%, 
                        rgba(255, 255, 255, 0.95) 60%, 
                        rgba(255, 255, 255, 0.8) 80%,
                        rgba(255, 255, 255, 0.3) 95%,
                        transparent 100%) !important;
                    z-index: 15;
                    opacity: 1;
                    transition: opacity 1.5s ease;
                    pointer-events: none;
                    box-shadow: 0 0 20px rgba(255, 255, 255, 0.5) !important;
                    filter: none !important;
                    border: none !important;
                    mix-blend-mode: normal !important;
                    isolation: isolate;
                `;
                
                // åˆ›å»ºå¤–å‘å…‰å±‚ï¼Œç§»é™¤box-shadowé¿å…åŒåœˆæ•ˆæœï¼Œåªä½¿ç”¨å•ä¸€æ¸å˜
                const glowLayer = document.createElement('div');
                glowLayer.className = 'glow-layer';
                glowLayer.style.cssText = `
                    position: absolute;
                    top: -35%;
                    left: -35%;
                    width: 170%;
                    height: 170%;
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 1;
                    opacity: 0.9;
                    transition: opacity 0.5s ease;
                    background: radial-gradient(
                        ellipse 32% 32% at 49.2% 48.7%,
                        transparent 0%,
                        transparent 35%,
                        rgba(63, 252, 255, 0.3) 40%,
                        rgba(63, 252, 255, 0.5) 50%,
                        rgba(63, 252, 255, 0.7) 60%,
                        rgba(63, 252, 255, 0.5) 70%,
                        rgba(63, 252, 255, 0.3) 80%,
                        rgba(63, 252, 255, 0.2) 90%,
                        rgba(63, 252, 255, 0.1) 95%,
                        transparent 100%
                    );
                `;
                
                // ç»„è£…ç»“æ„ï¼šå¤–å‘å…‰åœ¨åº•å±‚ï¼Œè§†é¢‘åœ¨ä¸­å±‚ï¼Œç™½è‰²å…‰çƒåœ¨é¡¶å±‚ï¼ˆä½†é€æ˜ï¼‰
                orbContainer.appendChild(glowLayer);
                orbContainer.appendChild(orbVideo);
                orbContainer.appendChild(whiteLightBall);
                
                // ğŸ”§ äº‹ä»¶å¤„ç†ï¼šç»‘å®šåˆ°å¤–å±‚å®¹å™¨
                orbContainer.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log(`ğŸ–±ï¸ çƒä½“è¢«ç‚¹å‡»: ${orbData.name}`);
                    this.handleOrbClick(orbData, orbContainer, orbVideo);
                });
                
                // ğŸ¬ æå‰æš‚åœæœºåˆ¶ï¼Œé¿å…é»‘å±é—®é¢˜
                orbVideo.addEventListener('timeupdate', () => {
                    if (orbVideo.duration && orbVideo.currentTime >= orbVideo.duration - 0.15) { // æå‰0.15ç§’æš‚åœ
                        orbVideo.pause();
                        console.log(`âœ… çƒä½“è§†é¢‘åœ¨æœ€åä¸€å¸§å‰æš‚åœï¼Œé¿å…é»‘å±: ${orbData.name}`);
                    }
                });
                
                // ğŸ¬ è§†é¢‘æ’­æ”¾å®Œæˆå¤‡ç”¨å¤„ç†
                orbVideo.addEventListener('ended', () => {
                    console.log(`âœ… çƒä½“è§†é¢‘æ’­æ”¾å®Œæˆï¼Œåœç•™åœ¨æœ€åä¸€å¸§: ${orbData.name}`);
                    // è§†é¢‘è‡ªç„¶ç»“æŸï¼Œåœç•™åœ¨æœ€åä¸€å¸§ï¼Œç­‰å¾…ç”¨æˆ·ç‚¹å‡»
                    // ä¸é‡æ’­ï¼Œé¿å…é»‘å±é—®é¢˜
                });
                
                // ğŸ¬ ç¡®ä¿è§†é¢‘å®Œå…¨åŠ è½½åå¼€å§‹æ’­æ”¾
                orbVideo.addEventListener('loadeddata', () => {
                    console.log(`ğŸ“½ï¸ çƒä½“è§†é¢‘æ•°æ®å·²åŠ è½½: ${orbData.name}`);
                });
                
                // ğŸ¬ æ’­æ”¾å¼€å§‹æ—¶çš„æ—¥å¿—
                orbVideo.addEventListener('play', () => {
                    console.log(`â–¶ï¸ çƒä½“è§†é¢‘å¼€å§‹æ’­æ”¾: ${orbData.name}`);
                });
                
                // ğŸ¬ æ’­æ”¾è¿›åº¦ç›‘æ§ï¼ˆå¯é€‰ï¼Œç”¨äºè°ƒè¯•ï¼‰
                orbVideo.addEventListener('timeupdate', () => {
                    // é™é»˜ç›‘æ§ï¼Œä¸è¾“å‡ºè¿‡å¤šæ—¥å¿—
                });
                
                // é¼ æ ‡æ‚¬åœæ•ˆæœ - å¼ºåŒ–é¼ æ ‡äº‹ä»¶ç¨³å®šæ€§
                orbContainer.addEventListener('mouseenter', (e) => {
                    e.stopPropagation();
                    if (!orbContainer.classList.contains('enlarged') && !orbContainer.classList.contains('clicked')) {
                        orbContainer.classList.add('hovering');
                        // å¼ºåˆ¶ç¡®ä¿å…ƒç´ å¯è§å’Œå¯äº¤äº’
                        orbContainer.style.visibility = 'visible';
                        orbContainer.style.opacity = '1';
                        orbContainer.style.pointerEvents = 'auto';
                        orbContainer.style.cursor = 'pointer';
                        orbContainer.style.zIndex = '100';
                        
                        // å¢å¼ºå¤–å‘å…‰
                        const glowLayer = orbContainer.querySelector('.glow-layer');
                        if (glowLayer) {
                            glowLayer.style.opacity = '1.5';
                        }
                    }
                });
                
                orbContainer.addEventListener('mouseleave', (e) => {
                    e.stopPropagation();
                    if (!orbContainer.classList.contains('enlarged') && !orbContainer.classList.contains('clicked')) {
                        orbContainer.classList.remove('hovering');
                        
                        // æ¢å¤é»˜è®¤å¤–å‘å…‰å¼ºåº¦
                        const glowLayer = orbContainer.querySelector('.glow-layer');
                        if (glowLayer) {
                            glowLayer.style.opacity = '0.9'; // æ¢å¤é»˜è®¤å‘å…‰
                        }
                    }
                });
                
                // æ·»åŠ é¢å¤–çš„é¼ æ ‡äº‹ä»¶ä¿éšœ
                orbContainer.addEventListener('mouseover', (e) => {
                    e.stopPropagation();
                    if (!orbContainer.classList.contains('enlarged') && !orbContainer.classList.contains('clicked')) {
                        orbContainer.style.pointerEvents = 'auto';
                    }
                });
                
                this.explorationOrbs.appendChild(orbContainer);
                
                // ğŸŒŸ ä¼˜åŒ–çš„çƒä½“å‡ºç°åŠ¨ç”»ï¼šç™½è‰²å…‰çƒå’Œè§†é¢‘åŒæ­¥æ”¾å¤§ï¼Œç„¶åç™½çƒæ¶ˆå¤±
                setTimeout(() => {
                                    // ğŸµ æ¯å‡ºç°ä¸€ä¸ªçƒï¼Œæ’­æ”¾ä¸€æ¬¡pong.MP3ï¼ˆå¢å¤§éŸ³é‡ï¼‰
                    this.orbSound.currentTime = 0;
                this.orbSound.volume = 1.0; // å¢å¤§éŸ³é‡ä»0.8åˆ°1.0
                    this.orbSound.play().then(() => {
                    console.log(`âœ… çƒä½“${orbData.name}å‡ºç°éŸ³æ•ˆpong.MP3æ’­æ”¾æˆåŠŸï¼ˆéŸ³é‡1.0ï¼‰`);
                    }).catch(e => {
                        console.log(`âŒ çƒä½“${orbData.name}å‡ºç°éŸ³æ•ˆæ’­æ”¾å¤±è´¥:`, e);
                    });
                    
                    // ğŸ“ æ˜¾ç¤ºçƒä½“å¯¹åº”çš„è¯†åˆ«æ–‡å­—ï¼ˆé€å­—æ˜¾ç¤ºï¼‰
                    this.showPlaneText(orbData.text);
                    
                    // é˜¶æ®µ1ï¼šåœ¨æ”¾å¤§å¼€å§‹å‰ï¼Œç«‹å³è®¾ç½®è§†é¢‘çš„æœ€ç»ˆçŠ¶æ€ï¼Œé¿å…åç»­ç¼©æ”¾
                    orbVideo.style.clipPath = 'ellipse(36% 36% at 49.2% 48.7%)';
                    orbVideo.style.webkitClipPath = 'ellipse(36% 36% at 49.2% 48.7%)';
                    orbVideo.style.border = 'none';
                    orbVideo.style.opacity = '0'; // å…ˆéšè—è§†é¢‘ï¼Œç­‰åŠ è½½å®Œæˆåå†æ˜¾ç¤º
                    
                    // çƒä»10pxå˜å¤§åˆ°240pxï¼Œç™½è‰²å…‰çƒå’Œè§†é¢‘åŒæ­¥æ”¾å¤§
                    orbContainer.style.width = '240px';
                    orbContainer.style.height = '240px';
                    orbContainer.style.background = 'transparent';
                    orbContainer.style.animation = 'orbFlyOut 0.6s ease-out forwards';
                    
                    // å¤–å‘å…‰å¼€å§‹æ˜¾ç¤º
                    glowLayer.style.opacity = '0.9';
                    
                    setTimeout(() => {
                        // é˜¶æ®µ2ï¼š500mså¼€å§‹ç™½çƒâ†’è§†é¢‘å¹³æ»‘è¿‡æ¸¡
                        
                        // 530ms: æ£€æŸ¥è§†é¢‘æ˜¯å¦å‡†å¤‡å¥½ï¼Œå¦‚æœå‡†å¤‡å¥½äº†å†å¼€å§‹ç™½çƒæ¶ˆå¤±å’Œè§†é¢‘æ˜¾ç¤º
                        setTimeout(() => {
                            const checkVideoAndTransition = () => {
                                if (orbVideo.readyState >= 2) { // HAVE_CURRENT_DATAæˆ–æ›´é«˜
                                    console.log(`âœ… çƒä½“è§†é¢‘å·²å‡†å¤‡ï¼Œå¼€å§‹ç™½çƒâ†’è§†é¢‘è¿‡æ¸¡: ${orbData.name}`);
                                    
                                    // ç™½çƒå¼€å§‹æ¶ˆå¤±
                                    whiteLightBall.style.transition = 'opacity 70ms linear'; // 70msæ¸è¿›æ¶ˆå¤±
                                    whiteLightBall.style.opacity = '0';
                                    
                                    // è§†é¢‘å¼€å§‹æ˜¾ç¤º
                                    orbVideo.style.transition = 'opacity 70ms linear';
                                    orbVideo.style.opacity = '1';
                                } else {
                                    console.log(`â³ çƒä½“è§†é¢‘æœªå‡†å¤‡å¥½ï¼Œå»¶è¿Ÿè¿‡æ¸¡: ${orbData.name}, readyState: ${orbVideo.readyState}`);
                                    
                                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                                    if (window.videoPreloader) {
                                        window.videoPreloader.showLoading(`ä½é¢çƒä½“å‡†å¤‡ä¸­... (${orbData.name})`);
                                    }
                                    
                                    // 50msåé‡æ–°æ£€æŸ¥
                                    setTimeout(checkVideoAndTransition, 50);
                                }
                            };
                            
                            checkVideoAndTransition();
                        }, 30);
                        
                        // å¤–å‘å…‰é€‚åº¦å¢å¼º
                        setTimeout(() => {
                            glowLayer.style.opacity = '1.2';
                        }, 100);
                        
                        // å¤–å±‚å®¹å™¨å¼€å§‹æ¼‚æµ®ï¼Œå®Œå…¨ç§»é™¤åŠ¨ç”»é¿å…scaleè·³è·ƒ
                        setTimeout(() => {
                            // ç§»é™¤orbFlyOutåŠ¨ç”»ï¼Œæ‰‹åŠ¨è®¾ç½®æœ€ç»ˆçŠ¶æ€
                            orbContainer.style.animation = 'none';
                            orbContainer.style.transform = 'translate(-50%, -50%) scale(2)';
                            orbContainer.style.transition = 'transform 0.1s ease';
                            
                            // çŸ­æš‚å»¶è¿Ÿåå¼€å§‹æ¼‚æµ®
                            setTimeout(() => {
                                orbContainer.style.animation = 'orb-float 3s ease-in-out infinite';
                            }, 20);
                        }, 100);
                
                        // ç¡®ä¿çƒä½“å¯äº¤äº’
                        orbContainer.style.pointerEvents = 'auto';
                        orbContainer.style.cursor = 'pointer';
                        orbContainer.style.zIndex = '100';
                        

                        
                        // ğŸ¬ è®¾ç½®å½“å‰çƒä½“å¼•ç”¨
                        this.currentOrbContainer = orbContainer;
                        this.currentOrbVideo = orbVideo;
                        
                        // ğŸ¬ ç­‰å¾…è§†é¢‘å®Œå…¨æ˜¾ç¤ºåå†å¼€å§‹æ’­æ”¾ï¼ˆå»¶è¿Ÿåˆ°ç™½çƒæ¶ˆå¤±åï¼‰
                        setTimeout(() => {
                            const startVideoPlayback = () => {
                                // ç¡®ä¿è§†é¢‘å·²ç»æ˜¾ç¤ºï¼ˆopacity = 1ï¼‰ä¸”å‡†å¤‡æ’­æ”¾
                                if (orbVideo.style.opacity === '1' && orbVideo.readyState >= 3) {
                                    orbVideo.currentTime = 0;
                                    orbVideo.muted = false; // çƒä½“è§†é¢‘æœ‰å£°éŸ³
                                    orbVideo.volume = 0.8;
                                    
                                    // éšè—åŠ è½½æç¤º
                                    if (window.videoPreloader) {
                                        window.videoPreloader.hideLoading();
                                    }
                                    
                                    orbVideo.play().then(() => {
                                        console.log(`âœ… çƒä½“è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¼€å§‹: ${orbData.name}`);
                                        
                                        // ğŸ¬ è§†é¢‘å¼€å§‹æ’­æ”¾åï¼Œå»¶è¿Ÿ2ç§’æ˜¾ç¤ºç‚¹å‡»æŒ‡å¼•ï¼ˆåœ¨å¯¹è¯æ³¡æ³¡æ˜¾ç¤ºå®Œæˆåï¼‰
                                        setTimeout(() => {
                                            this.showClickGuide();
                                        }, 2000);
                                    }).catch(e => {
                                        console.log(`âŒ çƒä½“è§†é¢‘æ’­æ”¾å¤±è´¥: ${orbData.name}`, e);
                                    });
                                } else {
                                    // è§†é¢‘è¿˜æ²¡å‡†å¤‡å¥½æˆ–è¿˜æ²¡æ˜¾ç¤ºï¼Œç»§ç»­ç­‰å¾…
                                    console.log(`â³ ç­‰å¾…çƒä½“è§†é¢‘æ˜¾ç¤ºå’ŒåŠ è½½å®Œæˆ: ${orbData.name}, opacity: ${orbVideo.style.opacity}, readyState: ${orbVideo.readyState}`);
                                    
                                    // 50msåé‡æ–°æ£€æŸ¥
                                    setTimeout(startVideoPlayback, 50);
                                }
                            };
                            
                            startVideoPlayback();
                        }, 150); // ç­‰å¾…ç™½çƒæ¶ˆå¤±åŠ¨ç”»å®Œæˆåå†æ£€æŸ¥
                        
                        console.log(`âœ¨ çƒä½“ ${orbData.name} å·²å®Œå…¨æ˜¾ç¤ºï¼Œæ— ç¼©æ”¾è·³è·ƒçš„æµç•…è¿‡æ¸¡å®Œæˆ`);
                    }, 500); // 500mså¼€å§‹ç™½çƒâ†’è§†é¢‘è¿‡æ¸¡
                }, 50);
            }
            
            // ğŸ–±ï¸ å¤„ç†çƒä½“ç‚¹å‡»äº‹ä»¶ - ç°åœ¨åªå¤„ç†ç»§ç»­ä¸‹ä¸€ä¸ªçš„é€»è¾‘
            handleOrbClick(orbData, orbContainer, orbVideo) {
                console.log(`ğŸ¯ ç”¨æˆ·ç‚¹å‡»ç»§ç»­ä¸‹ä¸€ä¸ª: ${orbData.name}`);
                
                // é˜²æ­¢é‡å¤ç‚¹å‡»
                if (orbContainer.classList.contains('clicked')) {
                    return;
                }
                orbContainer.classList.add('clicked');
                
                // éšè—ç‚¹å‡»æŒ‡å¼•å’Œæ–‡å­—
                this.hideClickGuide();
                this.hidePlaneText();
                
                // åœæ­¢è§†é¢‘æ’­æ”¾
                orbVideo.pause();
                orbVideo.loop = false;
                
                // æ¸…é™¤å½“å‰çƒä½“å¼•ç”¨
                this.currentOrbContainer = null;
                this.currentOrbVideo = null;
                
                // å¼€å§‹æ¶ˆå¤±åŠ¨ç”»
                this.startOrbDisappear(orbContainer);
                
                // å¢åŠ å®Œæˆè®¡æ•°å’Œåˆ›å»ºä¸‹ä¸€ä¸ªçƒä½“
                this.completedOrbs++;
                this.currentOrbIndex++;
                this.updateStatus(`å·²å®Œæˆ ${this.completedOrbs}/4 ä¸ªä½é¢æ¢ç´¢`);
                
                // çŸ­æš‚å»¶è¿Ÿååˆ›å»ºä¸‹ä¸€ä¸ªçƒä½“
                setTimeout(() => {
                    this.createNextOrb();
                }, 500);
            }
                
            startOrbDisappear(orbContainer) {
                console.log('ğŸŒŸ å¼€å§‹åä¸½æ¶ˆå¤±åŠ¨ç”»ï¼ˆæ³¡æ³¡çˆ†æ‰æ•ˆæœï¼‰');
                
                // ğŸ† ç§»é™¤æ‚¬åœæ•ˆæœï¼Œå‡†å¤‡æ¶ˆå¤±
                orbContainer.classList.remove('hovering');
                orbContainer.style.pointerEvents = 'none';
                
                // ğŸ”¥ åŠ å¼ºglowLayerçš„æ¶ˆå¤±ç‰¹æ•ˆï¼Œä¿æŒ47% 47%åç§»
                const glowLayer = orbContainer.querySelector('.glow-layer');
                if (glowLayer) {
                    glowLayer.style.background = `
                        radial-gradient(
                            ellipse 32% 32% at 49.2% 48.7%,
                            rgba(63, 252, 255, 0.8) 0%,
                            rgba(63, 252, 255, 0.6) 30%,
                            rgba(63, 252, 255, 0.4) 50%,
                            rgba(63, 252, 255, 0.2) 70%,
                            rgba(63, 252, 255, 0.1) 85%,
                            transparent 100%
                        )`;
                }
                // ç§»é™¤å®¹å™¨è¾¹æ¡†ï¼Œé¿å…è“è‰²å‘å…‰æ•ˆæœ
                orbContainer.style.border = 'none';
                
                // ğŸ† åˆ›å»ºæ›´å¤šçˆ†ç‚¸ç²’å­ï¼ˆ24ä¸ªï¼‰
                for (let i = 0; i < 24; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'explosion-particle';
                    
                    // éšæœºæ–¹å‘å’Œè·ç¦»
                    const angle = (i / 24) * 2 * Math.PI;
                    const distance = 150 + Math.random() * 100;
                    const dx = Math.cos(angle) * distance;
                    const dy = Math.sin(angle) * distance;
                    
                    particle.style.cssText = `
                        position: absolute;
                        left: 50%;
                        top: 50%;
                        width: 8px;
                        height: 8px;
                        border-radius: 50%;
                        background: radial-gradient(circle, rgba(63, 252, 255, 1) 0%, rgba(63, 252, 255, 0.8) 50%, transparent 100%);
                        box-shadow: 0 0 15px 5px rgba(63, 252, 255, 0.8);
                        transform: translate(-50%, -50%);
                        pointer-events: none;
                        z-index: 1000;
                        --dx: ${dx}px;
                        --dy: ${dy}px;
                        animation: particleExplosion 1.5s ease-out forwards;
                    `;
                    
                    orbContainer.appendChild(particle);
                    
                    // 1.5ç§’åç§»é™¤ç²’å­
                setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 1500);
                }
                
                // ğŸ† ä¸»ä½“æ³¡æ³¡çˆ†æ‰åŠ¨ç”» - ç¼©çŸ­æ—¶é•¿ç¡®ä¿å¿«é€Ÿæ¶ˆå¤±
                orbContainer.style.animation = 'bubblePop 0.8s ease-out forwards';
                
                // ğŸ”§ ç«‹å³å¼€å§‹é€æ˜åº¦åŠ¨ç”»ï¼Œç¡®ä¿è§†è§‰ä¸Šå¿«é€Ÿæ¶ˆå¤±
                orbContainer.style.transition = 'opacity 0.3s ease-out';
                setTimeout(() => {
                    orbContainer.style.opacity = '0';
                }, 200);
                
                // ğŸ”§ ç›‘å¬åŠ¨ç”»ç»“æŸäº‹ä»¶ï¼Œç¡®ä¿æ—¶æœºå‡†ç¡®
                const handleAnimationEnd = (e) => {
                    // ç¡®ä¿æ˜¯bubblePopåŠ¨ç”»ç»“æŸï¼Œä¸æ˜¯å…¶ä»–åŠ¨ç”»
                    if (e.animationName === 'bubblePop') {
                        if (orbContainer.parentNode) {
                            orbContainer.parentNode.removeChild(orbContainer);
                            console.log('âœ¨ çƒä½“å·²å½»åº•æ¶ˆå¤±ï¼ˆbubblePopåŠ¨ç”»ç»“æŸï¼‰');
                        }
                        orbContainer.removeEventListener('animationend', handleAnimationEnd);
                    }
                };
                
                orbContainer.addEventListener('animationend', handleAnimationEnd);
                
                // ğŸ›¡ï¸ å¤‡ç”¨å®‰å…¨åˆ é™¤ï¼ˆç¼©çŸ­æ—¶é—´ï¼‰
                setTimeout(() => {
                    if (orbContainer.parentNode) {
                        orbContainer.parentNode.removeChild(orbContainer);
                        console.log('âœ¨ çƒä½“å®‰å…¨åˆ é™¤ï¼ˆå¤‡ç”¨æœºåˆ¶ï¼‰');
                    }
                }, 1000);
            }
            
            // é˜¶æ®µ4ï¼šç¡®è®¤ç©¿è¶Šï¼ˆ20-25ç§’ï¼‰
            startPhase4() {
                this.phase = 4;
                this.updatePhase('é˜¶æ®µ4ï¼šç¡®è®¤ç©¿è¶Š');
                this.updateStatus('ç¡®è®¤ç©¿è¶Šä¸­...');
                this.updateProgress(90);
                
                console.log('ğŸšª é˜¶æ®µ4ï¼šç¡®è®¤ç©¿è¶Šå¼€å§‹');
                
                // æ¸…é™¤çƒä½“é˜¶æ®µæ ‡è®°
                this.inOrbPhase = false;
                
                // éšè—æ‰€æœ‰çƒä½“
                this.explorationOrbs.style.opacity = '0';
                
                // ä½¿ç”¨å¹³æ»‘æ·¡å…¥æ–¹å¼æ’­æ”¾ç¡®è®¤ç©¿è¶Šè§†é¢‘ï¼Œé¿å…é»‘å±
                this.crossfadeMainVideo(this.videos.confirm, { muted: true, loop: false });
                
                // ğŸµ é˜¶æ®µ4ï¼šS03002èƒŒæ™¯éŸ³ä¹ç»§ç»­æ’­æ”¾ï¼ˆä¸åœæ­¢ï¼‰
                console.log('ğŸµ é˜¶æ®µ4ï¼šS03002èƒŒæ™¯éŸ³ä¹ç»§ç»­æ’­æ”¾');
                
                // 5ç§’ååœºæ™¯ç»“æŸ
                setTimeout(() => {
                    this.completeScene();
                }, 5000);
            }
            
            handleVideoEnded() {
                if (this.phase === 4) {
                    this.completeScene();
                }
            }
            
            completeScene() {
                console.log('âœ… é•œå¤´3å®Œæˆ');
                this.updatePhase('å®Œæˆ');
                this.updateStatus('ç©¿è¶Šå®Œæˆï¼');
                this.updateProgress(100);
                
                // ğŸµ ç»“æŸï¼šåœæ­¢S03002èƒŒæ™¯éŸ³ä¹
                this.backgroundAudio.pause();
                console.log('ğŸµ ç»“æŸï¼šS03002èƒŒæ™¯éŸ³ä¹å·²åœæ­¢');
                
                // è‹¥åœ¨çˆ¶é¡µé¢ iframe ä¸­ï¼Œç›´æ¥è·³è½¬ä¸‹ä¸€é•œå¤´ï¼›å¦åˆ™æ˜¾ç¤ºå®Œæˆæç¤º
                if (window.parent && window.parent !== window) {
                    // ç›´æ¥é€šçŸ¥çˆ¶é¡µé¢åˆ‡æ¢
                    this.nextScene();
                } else {
                    // ç‹¬ç«‹è¿è¡Œæ—¶ä¿ç•™å®Œæˆæç¤º
                    setTimeout(() => {
                        this.showCompletionMessage();
                    }, 1000);
                }
            }
            
            showCompletionMessage() {
                const message = document.createElement('div');
                message.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.9);
                    color: white;
                    padding: 30px;
                    border-radius: 15px;
                    text-align: center;
                    font-size: 18px;
                    z-index: 10000;
                    border: 2px solid #ffcc00;
                `;
                
                const selectedOrbName = 'å¤šä¸ªä½é¢'; // å› ä¸ºç”¨æˆ·å¯èƒ½æ¢ç´¢äº†å¤šä¸ªä½é¢
                
                message.innerHTML = `
                    <h3 style="color: #ffcc00; margin-bottom: 15px;">ğŸ‰ æ—¶ç©ºç©¿è¶Šå®Œæˆï¼</h3>
                    <p>é€‰æ‹©çš„ä½é¢ï¼š<strong>${selectedOrbName}</strong></p>
                    <p style="margin-top: 15px; font-size: 14px; opacity: 0.8;">å³å°†è¿›å…¥ä¸‹ä¸€é•œå¤´...</p>
                `;
                
                document.body.appendChild(message);
                
                // 3ç§’åè‡ªåŠ¨è·³è½¬
                setTimeout(() => {
                    this.nextScene();
                }, 3000);
            }
            
            // å¿«æ·è·³è½¬åŠŸèƒ½
            skipToExploration() {
                this.continueClicked = true;
                this.inOrbPhase = true; // ç›´æ¥è®¾ç½®çƒä½“é˜¶æ®µæ ‡è®°
                this.startPhase3();
                    }
            
            skipToConfirm() {
                this.startPhase4();
            }
            
            restartScene() {
                console.log('ğŸ”„ é‡æ–°å¼€å§‹é•œå¤´3');
                location.reload();
            }
            
            nextScene() {
                console.log('â¡ï¸ å‰å¾€ä¸‹ä¸€é•œå¤´');
                // é€šçŸ¥çˆ¶é¡µé¢é•œå¤´3å®Œæˆ
                if (window.parent && window.parent !== window) {
                    window.parent.postMessage({ type: 'scene3-complete' }, '*');
                } else {
                    window.location.href = 'scene4-new-awakening.html';
                }
            }
            
            // æš‚åœæ‰€æœ‰åª’ä½“
            pauseAll() {
                if (this.mainVideo && !this.mainVideo.paused) {
                    this.mainVideo.pause();
                }
                if (this.backgroundAudio && !this.backgroundAudio.paused) {
                    this.backgroundAudio.pause();
                }
                if (this.phase1Audio && !this.phase1Audio.paused) {
                    this.phase1Audio.pause();
                }
                if (this.currentOrbVideo && !this.currentOrbVideo.paused) {
                    this.currentOrbVideo.pause();
                }
            }
            
            // æ¢å¤æ’­æ”¾æ‰€æœ‰åª’ä½“
            resumeAll() {
                if (this.mainVideo && this.mainVideo.paused && this.isStarted) {
                    this.mainVideo.play().catch(e => console.log('æ¢å¤ä¸»è§†é¢‘æ’­æ”¾å¤±è´¥:', e));
                }
                if (this.backgroundAudio && this.backgroundAudio.paused && this.isStarted) {
                    this.backgroundAudio.play().catch(e => console.log('æ¢å¤èƒŒæ™¯éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e));
                }
                if (this.phase1Audio && this.phase1Audio.paused && this.isStarted) {
                    this.phase1Audio.play().catch(e => console.log('æ¢å¤é˜¶æ®µ1éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e));
                }
                if (this.currentOrbVideo && this.currentOrbVideo.paused && this.inOrbPhase) {
                    this.currentOrbVideo.play().catch(e => console.log('æ¢å¤çƒä½“è§†é¢‘æ’­æ”¾å¤±è´¥:', e));
                }
            }
            
            // çŠ¶æ€æ›´æ–°æ–¹æ³•
            updateStatus(status) {
                this.sceneStatus.textContent = status;
            }
            
            updatePhase(phase) {
                this.currentPhase.textContent = phase;
                this.phaseIndicator.textContent = phase;
            }
            
            updateProgress(progress) {
                this.sceneProgress.textContent = Math.round(progress) + '%';
            }
            
            // ğŸ“ æ˜¾ç¤ºä½é¢è¯†åˆ«æ–‡å­—ï¼ˆé€å­—æ˜¾ç¤ºï¼‰
            showPlaneText(text) {
                console.log(`ğŸ“ æ˜¾ç¤ºæ–‡å­—: ${text}`);
                
                const textContent = this.planeTextDisplay.querySelector('.text-content');
                
                // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
                textContent.innerHTML = '';
                
                // æ˜¾ç¤ºæ–‡å­—å®¹å™¨
                this.planeTextDisplay.classList.add('show');
                
                // é€å­—æ˜¾ç¤ºæ•ˆæœ
                const chars = text.split('');
                let charIndex = 0;
                
                const typeChar = () => {
                    if (charIndex < chars.length) {
                        const char = chars[charIndex];
                        const charSpan = document.createElement('span');
                        charSpan.textContent = char;
                        charSpan.className = 'typing-char';
                        charSpan.style.animationDelay = '0s';
                        
                        textContent.appendChild(charSpan);
                        
                        charIndex++;
                        
                        // æ¯100msæ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦
                        setTimeout(typeChar, 100);
                    } else {
                        // æ‰€æœ‰å­—ç¬¦æ˜¾ç¤ºå®Œæˆåï¼Œä¸è‡ªåŠ¨éšè—ï¼Œç­‰å¾…çƒä½“è¢«ç‚¹å‡»æ—¶å†éšè—
                        console.log('ğŸ“ å¯¹è¯æ³¡æ³¡æ˜¾ç¤ºå®Œæˆï¼Œç­‰å¾…çƒä½“è¢«ç‚¹å‡»æ—¶éšè—');
                    }
                };
                
                // å¼€å§‹é€å­—æ˜¾ç¤º
                typeChar();
            }
            
            // éšè—ä½é¢è¯†åˆ«æ–‡å­—
            hidePlaneText() {
                this.planeTextDisplay.classList.remove('show');
                
                // å»¶è¿Ÿæ¸…ç©ºå†…å®¹ï¼Œç­‰å¾…æ·¡å‡ºåŠ¨ç”»å®Œæˆ
                setTimeout(() => {
                    const textContent = this.planeTextDisplay.querySelector('.text-content');
                    textContent.innerHTML = '';
                }, 500);
            }
            
            // æ˜¾ç¤ºç‚¹å‡»æŒ‡å¼•
            showClickGuide() {
                console.log('ğŸ‘† æ˜¾ç¤ºç‚¹å‡»æŒ‡å¼•');
                this.clickGuide.classList.add('show');
                this.screenClickOverlay.classList.add('active');
            }
            
            // éšè—ç‚¹å‡»æŒ‡å¼•
            hideClickGuide() {
                console.log('ğŸ‘† éšè—ç‚¹å‡»æŒ‡å¼•');
                this.clickGuide.classList.remove('show');
                this.screenClickOverlay.classList.remove('active');
            }
            
            // âœ¨ å¹³æ»‘åˆ‡æ¢ä¸»è§†é¢‘ï¼Œé¿å…é»‘å±
            crossfadeMainVideo(newSrc, {
                muted = true,
                loop = false,
                autoplay = true
            } = {}) {
                return new Promise((resolve) => {
                    // å¦‚æœç›®æ ‡å°±æ˜¯å½“å‰æºï¼Œåˆ™ç›´æ¥è¿”å›
                    if (this.mainVideo.src.includes(newSrc)) {
                        resolve(this.mainVideo);
                        return;
                    }

                    // åˆ›å»ºæ–°çš„ video å…ƒç´ ï¼Œè¦†ç›–åœ¨æ—§è§†é¢‘ä¹‹ä¸Š
                    const nextVideo = document.createElement('video');
                    nextVideo.className = 'video-player';
                    nextVideo.preload = 'auto';
                    nextVideo.muted = muted;
                    nextVideo.loop = loop;
                    nextVideo.playsInline = true;
                    nextVideo.style.opacity = '0';
                    nextVideo.style.transition = 'opacity 0.4s ease';

                    // æ’å…¥åˆ°å®¹å™¨ä¸­ï¼ˆæ—§è§†é¢‘ä¹‹ä¸Šï¼‰
                    this.container.appendChild(nextVideo);

                    const doPlay = () => {
                        // æ’­æ”¾æ–°è§†é¢‘
                        if (autoplay) {
                            nextVideo.play().catch(e => console.warn('æ–°è§†é¢‘è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', e));
                        }

                        // æ·¡å…¥æ–°è§†é¢‘
                        requestAnimationFrame(() => {
                            nextVideo.style.opacity = '1';
                            // åŒæ­¥æ·¡å‡ºæ—§è§†é¢‘
                            this.mainVideo.style.transition = 'opacity 0.4s ease';
                            this.mainVideo.style.opacity = '0';

                            // 400ms åç§»é™¤æ—§è§†é¢‘ï¼Œæ›¿æ¢å¼•ç”¨
                            setTimeout(() => {
                                try {
                                    this.mainVideo.pause();
                                } catch(e) {}
                                if (this.mainVideo.parentNode) {
                                    this.mainVideo.parentNode.removeChild(this.mainVideo);
                                }
                                this.mainVideo = nextVideo;
                                resolve(nextVideo);
                            }, 400);
                        });
                    };

                    // ä½¿ç”¨é¢„åŠ è½½ç³»ç»Ÿå‡å°‘åŠ è½½æ—¶é—´
                    if (window.videoPreloader) {
                        // è‹¥å·²é¢„åŠ è½½ï¼Œç›´æ¥åˆ‡æ¢
                        const preloaded = window.videoPreloader.getPreloadedVideo(newSrc);
                        if (preloaded) {
                            nextVideo.src = newSrc;
                            // loadeddata ä»éœ€ç­‰å¾…è§£ç 
                        } else {
                            window.videoPreloader.preloadVideo(newSrc).finally(() => {
                                nextVideo.src = newSrc;
                            });
                        }
                    } else {
                        nextVideo.src = newSrc;
                    }

                    // ç­‰å¾…å¯æ’­æ”¾å†å¼€å§‹æ·¡å…¥
                    nextVideo.addEventListener('loadeddata', () => {
                        doPlay();
                    });
                });
            }
        }
        
        // å…¨å±€å‡½æ•°ä¾›æ§åˆ¶é¢æ¿ä½¿ç”¨
        let scene3Instance;
        
        window.addEventListener('DOMContentLoaded', () => {
            scene3Instance = new Scene3TimeVortex();
            
            // ç›‘å¬æ¥è‡ªçˆ¶é¡µé¢çš„æ¶ˆæ¯
            window.addEventListener('message', (event) => {
                if (event.data.type === 'scene3-start') {
                    console.log('ğŸ“¢ æ”¶åˆ°æ¥è‡ªçˆ¶é¡µé¢çš„å¯åŠ¨ä¿¡å·');
                    scene3Instance.startScene();
                } else if (event.data.type === 'pause') {
                    console.log('â¸ï¸ æ”¶åˆ°æš‚åœä¿¡å·');
                    // æš‚åœæ‰€æœ‰éŸ³é¢‘å’Œè§†é¢‘
                    scene3Instance.pauseAll();
                } else if (event.data.type === 'resume') {
                    console.log('â–¶ï¸ æ”¶åˆ°æ¢å¤ä¿¡å·');
                    // æ¢å¤æ’­æ”¾
                    scene3Instance.resumeAll();
                } else if (event.data.type === 'stop-all-audio') {
                    console.log('ğŸ”‡ é•œå¤´3æ”¶åˆ°åœæ­¢éŸ³é¢‘æŒ‡ä»¤');
                    // åœæ­¢æ‰€æœ‰éŸ³é¢‘
                    scene3Instance.pauseAll();
                    console.log('ğŸ”‡ é•œå¤´3æ‰€æœ‰éŸ³é¢‘å·²åœæ­¢');
                } else if (event.data.type === 'skip-to-orbs') {
                    console.log('â­ï¸ æ”¶åˆ°è·³è½¬åˆ°çƒä½“é˜¶æ®µæŒ‡ä»¤');
                    scene3Instance.skipToExploration();
                }
            });
        });
        
        function startScene() {
            scene3Instance.startScene();
        }
        
        function skipToExploration() {
            scene3Instance.skipToExploration();
        }
        
        function skipToConfirm() {
            scene3Instance.skipToConfirm();
        }
        
        function restartScene() {
            scene3Instance.restartScene();
        }
        
        function nextScene() {
            scene3Instance.nextScene();
        }
        
        // å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    if (scene3Instance.phase === 2) {
                        scene3Instance.handleContinueClick();
                    }
                    break;
                case 'Enter':
                    e.preventDefault();
                    startScene();
                    break;
                case 'r':
                case 'R':
                    restartScene();
                    break;
                case 'n':
                case 'N':
                    nextScene();
                    break;
                case '3':
                    skipToExploration();
                    break;
                case '4':
                    skipToConfirm();
                    break;
            }
        });
        
        console.log('ğŸ® é•œå¤´3æ§åˆ¶ï¼šç©ºæ ¼é”®=ç»§ç»­, å›è½¦=å¼€å§‹, R=é‡å¯, N=ä¸‹ä¸€é•œå¤´, 3=è·³è½¬æ¢ç´¢, 4=è·³è½¬ç¡®è®¤');
    </script>
    
    <!-- å¼•å…¥è§†é¢‘é¢„åŠ è½½ç³»ç»Ÿ -->
    <script src="video-preloader.js"></script>
</body>
</html> 