<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈïúÂ§¥7ÔºöÊó∂Ëæ∞ËΩÆÁõò‰øÆË°å - ‰ª£Âè∑qin</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(180deg, #2F4F4F 0%, #1C1C1C 50%, #000000 100%);
            overflow: hidden;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        #scene7-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Êú∫ÂÖ≥ÂüéËÉåÊôØ */
        .mechanism-city {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(139, 69, 19, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(160, 82, 45, 0.2) 0%, transparent 40%),
                linear-gradient(45deg, transparent 0%, rgba(105, 105, 105, 0.1) 50%, transparent 100%);
        }
        
        /* Êó∂Ëæ∞ËΩÆÁõò */
        .time-wheel {
            position: absolute;
            top: 50%;
            left: 30%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            border: 5px solid #DAA520;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(218, 165, 32, 0.1) 0%, transparent 70%);
            animation: wheelRotate 60s linear infinite;
        }
        
        @keyframes wheelRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .time-sector {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .time-sector:hover {
            filter: brightness(1.3);
        }
        
        .time-sector.active {
            filter: brightness(1.5) saturate(1.2);
        }
        
        .sector-label {
            position: absolute;
            top: 20%;
            left: 60%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            pointer-events: none;
        }
        
        .sector-activity {
            position: absolute;
            top: 40%;
            left: 60%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 10px;
            text-align: center;
            pointer-events: none;
            line-height: 1.2;
        }
        
        /* ‰øÆË°åÈù¢Êùø */
        .cultivation-panel {
            position: absolute;
            top: 10%;
            right: 5%;
            width: 350px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #DAA520;
            border-radius: 15px;
            padding: 20px;
            color: white;
        }
        
        .panel-title {
            color: #DAA520;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .current-time {
            text-align: center;
            font-size: 16px;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(218, 165, 32, 0.2);
            border-radius: 8px;
        }
        
        .cultivation-activity {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #32CD32;
        }
        
        .activity-name {
            font-weight: bold;
            color: #90EE90;
            margin-bottom: 5px;
        }
        
        .activity-description {
            font-size: 12px;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .activity-progress {
            margin-top: 8px;
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #32CD32 0%, #90EE90 100%);
            transition: width 2s ease-out;
        }
        
        /* Â∏àÁà∂ÈÄâÊã©Èù¢Êùø */
        .master-selection {
            position: absolute;
            bottom: 10%;
            left: 5%;
            width: 400px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 20px;
            color: white;
        }
        
        .masters-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .master-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #666;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .master-card:hover {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
        }
        
        .master-card.selected {
            border-color: #32CD32;
            background: rgba(50, 205, 50, 0.2);
        }
        
        .master-name {
            font-weight: bold;
            font-size: 12px;
            margin-bottom: 3px;
            color: #FFD700;
        }
        
        .master-skill {
            font-size: 10px;
            opacity: 0.8;
            line-height: 1.2;
        }
        
        /* ÁâπÊÆä‰∫ã‰ª∂ÂºπÁ™ó */
        .special-event {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #FF6347;
            text-align: center;
            z-index: 99999;
            max-width: 400px;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
            transition: all 0.5s ease;
        }
        
        .special-event.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .event-title {
            color: #FF6347;
            font-size: 20px;
            margin-bottom: 15px;
        }
        
        .event-description {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        /* Êó•Á®ãË°® */
        .schedule-display {
            position: absolute;
            top: 50%;
            right: 50px;
            transform: translateY(-50%);
            width: 200px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #666;
            border-radius: 10px;
            padding: 15px;
            color: white;
        }
        
        .schedule-item {
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 5px;
            font-size: 11px;
        }
        
        .schedule-item.current {
            background: rgba(218, 165, 32, 0.3);
            border-left: 3px solid #DAA520;
        }
        
        .schedule-item.completed {
            opacity: 0.5;
            text-decoration: line-through;
        }
        
        /* ÊéßÂà∂Èù¢Êùø */
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 10000;
            min-width: 200px;
            border: 1px solid #333;
        }
        
        .control-button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: #333;
            color: white;
            border: 1px solid #666;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s;
        }
        
        .control-button:hover {
            background: #555;
        }
        
        .status {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #666;
            font-size: 10px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="scene7-container">
        <!-- Êú∫ÂÖ≥ÂüéËÉåÊôØ -->
        <div class="mechanism-city"></div>
        
        <!-- Êó∂Ëæ∞ËΩÆÁõò -->
        <div class="time-wheel" id="time-wheel">
            <!-- Êó∂Ëæ∞ÊâáÂå∫Â∞ÜÈÄöËøáJavaScriptÁîüÊàê -->
        </div>
        
        <!-- ‰øÆË°åÈù¢Êùø -->
        <div class="cultivation-panel">
            <div class="panel-title">üìø ‰øÆË°åÊó•Â∏∏</div>
            
            <div class="current-time">
                <div>ÂΩìÂâçÊó∂Ëæ∞Ôºö<span id="current-time">ÂçØÊó∂</span></div>
                <div>Êó∂Èó¥Ôºö<span id="time-range">5:00-7:00</span></div>
            </div>
            
            <div class="cultivation-activity" id="current-activity">
                <div class="activity-name" id="activity-name">Êô®ÁªÉÔºàÂêêÁ∫≥ÊòüËæâ‰πãÂäõÔºâ</div>
                <div class="activity-description" id="activity-description">
                    ÈÄöËøáÁâπÊÆäÁöÑÂëºÂê∏Ê≥ïÔºåÂê∏Êî∂Ê∏ÖÊô®ÁöÑÊòüËæâÊÆãÁïôËÉΩÈáèÔºåÂ¢ûÂº∫‰ΩìË¥®ÂíåÁÅµÂäõ„ÄÇ
                </div>
                <div class="activity-progress">
                    <div class="progress-fill" id="activity-progress" style="width: 0%"></div>
                </div>
            </div>
            
            <button class="control-button" onclick="startCultivation()" style="width: 100%; margin-top: 10px;">
                ÂºÄÂßã‰øÆË°å
            </button>
        </div>
        
        <!-- Â∏àÁà∂ÈÄâÊã©Èù¢Êùø -->
        <div class="master-selection">
            <div class="panel-title">üéì ÈÄâÊã©Â∏àÁà∂</div>
            <div style="font-size: 12px; opacity: 0.8; margin-bottom: 10px;">
                ‰∏çÂêåÁöÑÂ∏àÁà∂Â∞ÜÊïôÊéà‰∏çÂêåÁöÑÊäÄËÉΩË∑ØÁ∫ø
            </div>
            
            <div class="masters-grid">
                <div class="master-card" onclick="selectMaster('jingke')">
                    <div class="master-name">ËçÜËΩ≤</div>
                    <div class="master-skill">Âà∫ÂÆ¢<br/>ÊöóÊùÄ‰πãÊúØ</div>
                </div>
                <div class="master-card selected" onclick="selectMaster('mozi')">
                    <div class="master-name">Â¢®Â≠ê</div>
                    <div class="master-skill">Â¢®ËÄÖ<br/>Êú∫ÂÖ≥ÊúØ</div>
                </div>
                <div class="master-card" onclick="selectMaster('liguang')">
                    <div class="master-name">ÊùéÂπø</div>
                    <div class="master-skill">Â∞ÑÊâã<br/>È™ëÂ∞Ñ‰πãÊúØ</div>
                </div>
                <div class="master-card" onclick="selectMaster('yuefei')">
                    <div class="master-name">Â≤≥È£û</div>
                    <div class="master-skill">Ê≠¶Â£´<br/>ÊêèÂáª‰πãÊúØ</div>
                </div>
                <div class="master-card" onclick="selectMaster('huatuo')">
                    <div class="master-name">Âçé‰Ωó</div>
                    <div class="master-skill">ÂåªËÄÖ<br/>Ê≤ªÊÑà‰πãÊúØ</div>
                </div>
                <div class="master-card" onclick="selectMaster('zuoci')">
                    <div class="master-name">Â∑¶ÊÖà</div>
                    <div class="master-skill">ÈÅìÂ£´<br/>ÊñπÂØ∏Â•áÊúØ</div>
                </div>
            </div>
        </div>
        
        <!-- Êó•Á®ãË°®ÊòæÁ§∫ -->
        <div class="schedule-display">
            <h4 style="margin-bottom: 10px; color: #DAA520;">‰ªäÊó•‰øÆË°å</h4>
            <div class="schedule-item current">
                <strong>ÂçØÊó∂</strong> - Êô®ÁªÉ
            </div>
            <div class="schedule-item">
                <strong>Â∑≥Êó∂</strong> - Êú∫ÂÖ≥ÊúØÂÖ•Èó®
            </div>
            <div class="schedule-item">
                <strong>ÂçàÊó∂</strong> - Âçà‰ºëÁ†îËØª
            </div>
            <div class="schedule-item">
                <strong>Êú™Êó∂</strong> - Â•áÈó®ÈÅÅÁî≤
            </div>
            <div class="schedule-item">
                <strong>Áî≥Êó∂</strong> - ÂÆûÊàòÂØπÊäó
            </div>
        </div>
        
        <!-- ÁâπÊÆä‰∫ã‰ª∂ÂºπÁ™ó -->
        <div class="special-event" id="special-event">
            <div class="event-title" id="event-title">ÁâπÊÆä‰∫ã‰ª∂</div>
            <div class="event-description" id="event-description">‰∫ã‰ª∂ÊèèËø∞</div>
            <button onclick="closeSpecialEvent()" 
                    style="padding: 10px 20px; background: #FF6347; color: #fff; border: none; border-radius: 5px; cursor: pointer;">
                Á°ÆÂÆö
            </button>
        </div>
        
        <!-- ÊéßÂà∂Èù¢Êùø -->
        <div class="controls">
            <h4 style="margin: 0 0 10px 0; color: #DAA520;">ÈïúÂ§¥7Ôºö‰øÆË°åÁ≥ªÁªü</h4>
            <button class="control-button" onclick="startCultivation()">ÂºÄÂßã‰øÆË°å</button>
            <button class="control-button" onclick="nextTimeSlot()">‰∏ã‰∏ÄÊó∂Ëæ∞</button>
            <button class="control-button" onclick="triggerSpecialEvent()">Ëß¶ÂèëÁâπÊÆä‰∫ã‰ª∂</button>
            <button class="control-button" onclick="autoProgress()">Ëá™Âä®ËøõÂ∫¶</button>
            <button class="control-button" onclick="nextScene()">ÂÆåÊàê‰øÆË°å</button>
            <button class="control-button" onclick="restartScene()">ÈáçÊñ∞ÂºÄÂßã</button>
            
            <div class="status">
                <div>ÂΩìÂâçÊó∂Ëæ∞: <span id="status-time">ÂçØÊó∂</span></div>
                <div>‰øÆË°åËøõÂ∫¶: <span id="cultivation-progress">0%</span></div>
                <div>ÈÄâÊã©Â∏àÁà∂: <span id="selected-master">Â¢®Â≠ê</span></div>
                <div>Ëé∑ÂæóÁªèÈ™å: <span id="gained-exp">0</span></div>
            </div>
        </div>
    </div>

    <script>
        class Scene7Cultivation {
            constructor() {
                this.container = document.getElementById('scene7-container');
                this.timeWheel = document.getElementById('time-wheel');
                this.currentTimeSpan = document.getElementById('current-time');
                this.timeRangeSpan = document.getElementById('time-range');
                this.activityName = document.getElementById('activity-name');
                this.activityDescription = document.getElementById('activity-description');
                this.activityProgress = document.getElementById('activity-progress');
                this.specialEvent = document.getElementById('special-event');
                this.eventTitle = document.getElementById('event-title');
                this.eventDescription = document.getElementById('event-description');
                this.statusTime = document.getElementById('status-time');
                this.cultivationProgressSpan = document.getElementById('cultivation-progress');
                this.selectedMasterSpan = document.getElementById('selected-master');
                this.gainedExpSpan = document.getElementById('gained-exp');
                
                this.currentTimeSlot = 0;
                this.cultivationProgress = 0;
                this.selectedMaster = 'mozi';
                this.gainedExp = 0;
                this.isTraining = false;
                
                // Êó∂Ëæ∞Êï∞ÊçÆ
                this.timeSlots = [
                    {
                        name: 'ÂçØÊó∂',
                        time: '5:00-7:00',
                        activity: 'Êô®ÁªÉÔºàÂêêÁ∫≥ÊòüËæâ‰πãÂäõÔºâ',
                        description: 'ÈÄöËøáÁâπÊÆäÁöÑÂëºÂê∏Ê≥ïÔºåÂê∏Êî∂Ê∏ÖÊô®ÁöÑÊòüËæâÊÆãÁïôËÉΩÈáèÔºåÂ¢ûÂº∫‰ΩìË¥®ÂíåÁÅµÂäõ„ÄÇ',
                        color: '#FFB6C1',
                        angle: 0,
                        specialEvent: 'Áéâ‰Ω©ÊÑèÂ§ñÂÖ±È∏£ÔºåËß¶Âèë"ÊòüËæâÁÅå‰Ωì"'
                    },
                    {
                        name: 'Ëæ∞Êó∂',
                        time: '7:00-9:00',
                        activity: 'Êó©ËÜ≥‰∏éÁêÜËÆ∫Â≠¶‰π†',
                        description: '‰∫´Áî®ÁÆÄÂçïÊó©ËÜ≥ÔºåÂ≠¶‰π†Â¢®ÂÆ∂ÁêÜËÆ∫ÂíåÊú∫ÂÖ≥Â≠¶Âü∫Á°ÄÁü•ËØÜ„ÄÇ',
                        color: '#DDA0DD',
                        angle: 45
                    },
                    {
                        name: 'Â∑≥Êó∂',
                        time: '9:00-11:00',
                        activity: 'Êú∫ÂÖ≥ÊúØÂÖ•Èó®',
                        description: 'Â≠¶‰π†Âü∫Á°ÄÊú∫ÂÖ≥Âà∂‰ΩúÔºå‰ªéÁÆÄÂçïÁöÑÊú∫ÂÖ≥Êú®‰∫∫ÂºÄÂßãÁªÉ‰π†„ÄÇ',
                        color: '#98FB98',
                        angle: 90,
                        specialEvent: 'ËØØËß¶Êú∫ÂÖ≥ÔºåÊï¥Â∫ßÂüéÊ±†Ë≠¶Êä•Â§ß‰Ωú'
                    },
                    {
                        name: 'ÂçàÊó∂',
                        time: '11:00-13:00',
                        activity: 'Âçà‰ºë & Â¢®ÂÆ∂ÂÖ∏Á±çÁ†îËØª',
                        description: 'Âçà‰ºëÊÅ¢Â§çÁ≤æÂäõÔºåÁ†îËØªÂ¢®ÂÆ∂ÁªèÂÖ∏ÂíåÂè§Á±ç„ÄÇ',
                        color: '#F0E68C',
                        angle: 135,
                        specialEvent: 'Â¨¥ÊîøÂèëÁé∞„ÄäÈæôÈ≠ÇÁéâÂΩï„ÄãÊÆãÂç∑'
                    },
                    {
                        name: 'Êú™Êó∂',
                        time: '13:00-15:00',
                        activity: 'Â•áÈó®ÈÅÅÁî≤ÊºîÁªÉ',
                        description: 'Â≠¶‰π†ÈòµÊ≥ïÂíåÈÅÅÁî≤‰πãÊúØÔºåÊèêÂçáÊàòÊúØÊÄùÁª¥„ÄÇ',
                        color: '#87CEEB',
                        angle: 180,
                        specialEvent: '‰∏§‰∫∫Ë¢´Âõ∞ÂπªÈòµÔºåÈúÄÂêà‰ΩúÁ†¥Ëß£'
                    },
                    {
                        name: 'Áî≥Êó∂',
                        time: '15:00-17:00',
                        activity: 'ÂÆûÊàòÂØπÊäóÔºàÂ¢®ÂÆ∂ÂºüÂ≠êÔºâ',
                        description: '‰∏éÂÖ∂‰ªñÂ¢®ÂÆ∂ÂºüÂ≠êËøõË°åÂÆûÊàòËÆ≠ÁªÉÔºåÊ£ÄÈ™å‰øÆË°åÊàêÊûú„ÄÇ',
                        color: '#DEB887',
                        angle: 225,
                        specialEvent: 'È¶ñÊ¨°ÊøÄÊ¥ª"ÊòüËæâÊä§‰Ωì"'
                    },
                    {
                        name: 'ÈÖâÊó∂',
                        time: '17:00-19:00',
                        activity: 'ÊäÄËâ∫Âàõ‰Ωú',
                        description: 'Ê†πÊçÆÊâÄÂ≠¶Âàõ‰ΩúÊú∫ÂÖ≥‰ΩúÂìÅÊàñËøõË°åÊäÄËÉΩ‰∏ìÁ≤æËÆ≠ÁªÉ„ÄÇ',
                        color: '#F4A460',
                        angle: 270
                    },
                    {
                        name: 'ÊàåÊó∂',
                        time: '19:00-21:00',
                        activity: 'ÊôöËØæÊÄªÁªì',
                        description: 'ÊÄªÁªì‰∏ÄÂ§©ÊâÄÂ≠¶Ôºå‰∏éÂ∏àÁà∂ËÆ®ËÆ∫‰øÆË°åÂøÉÂæó„ÄÇ',
                        color: '#CD853F',
                        angle: 315
                    }
                ];
                
                this.init();
            }
            
            init() {
                console.log('üé¨ ÈïúÂ§¥7ÔºöÊó∂Ëæ∞ËΩÆÁõò‰øÆË°åÂàùÂßãÂåñ');
                this.createTimeWheel();
                this.updateCurrentActivity();
                this.updateStatus();
                
                // Ëá™Âä®ÂºÄÂßãÁ¨¨‰∏Ä‰∏™‰øÆË°å
                setTimeout(() => {
                    this.startCultivation();
                }, 2000);
            }
            
            createTimeWheel() {
                this.timeSlots.forEach((slot, index) => {
                    const sector = document.createElement('div');
                    sector.className = 'time-sector';
                    sector.style.transform = `rotate(${slot.angle}deg)`;
                    sector.style.background = `linear-gradient(45deg, ${slot.color} 0%, transparent 100%)`;
                    
                    if (index === this.currentTimeSlot) {
                        sector.classList.add('active');
                    }
                    
                    const label = document.createElement('div');
                    label.className = 'sector-label';
                    label.textContent = slot.name;
                    label.style.transform = `translate(-50%, -50%) rotate(-${slot.angle}deg)`;
                    
                    const activity = document.createElement('div');
                    activity.className = 'sector-activity';
                    activity.innerHTML = slot.activity.split('Ôºà')[0];
                    activity.style.transform = `translate(-50%, -50%) rotate(-${slot.angle}deg)`;
                    
                    sector.appendChild(label);
                    sector.appendChild(activity);
                    
                    sector.addEventListener('click', () => {
                        this.selectTimeSlot(index);
                    });
                    
                    this.timeWheel.appendChild(sector);
                });
            }
            
            selectTimeSlot(index) {
                console.log(`‚è∞ ÈÄâÊã©Êó∂Ëæ∞: ${this.timeSlots[index].name}`);
                this.currentTimeSlot = index;
                this.updateTimeWheelDisplay();
                this.updateCurrentActivity();
                this.updateStatus();
            }
            
            updateTimeWheelDisplay() {
                const sectors = this.timeWheel.querySelectorAll('.time-sector');
                sectors.forEach((sector, index) => {
                    if (index === this.currentTimeSlot) {
                        sector.classList.add('active');
                    } else {
                        sector.classList.remove('active');
                    }
                });
            }
            
            updateCurrentActivity() {
                const slot = this.timeSlots[this.currentTimeSlot];
                this.currentTimeSpan.textContent = slot.name;
                this.timeRangeSpan.textContent = slot.time;
                this.activityName.textContent = slot.activity;
                this.activityDescription.textContent = slot.description;
            }
            
            startCultivation() {
                if (this.isTraining) return;
                
                console.log('üßò ÂºÄÂßã‰øÆË°å');
                this.isTraining = true;
                this.cultivationProgress = 0;
                this.activityProgress.style.width = '0%';
                
                // Ê®°Êãü‰øÆË°åËøõÂ∫¶
                const progressInterval = setInterval(() => {
                    this.cultivationProgress += 10;
                    this.activityProgress.style.width = this.cultivationProgress + '%';
                    this.cultivationProgressSpan.textContent = this.cultivationProgress + '%';
                    
                    if (this.cultivationProgress >= 100) {
                        clearInterval(progressInterval);
                        this.completeCultivation();
                    }
                }, 300);
                
                // Ê£ÄÊü•ÊòØÂê¶ÊúâÁâπÊÆä‰∫ã‰ª∂
                const slot = this.timeSlots[this.currentTimeSlot];
                if (slot.specialEvent && Math.random() < 0.7) {
                    setTimeout(() => {
                        this.triggerSpecialEvent(slot.specialEvent);
                    }, 1500);
                }
            }
            
            completeCultivation() {
                console.log('‚úÖ ‰øÆË°åÂÆåÊàê');
                this.isTraining = false;
                this.gainedExp += 20;
                this.gainedExpSpan.textContent = this.gainedExp;
                
                // Êõ¥Êñ∞Êó•Á®ãË°®
                this.updateScheduleDisplay();
                
                // Ëá™Âä®ËøõÂÖ•‰∏ã‰∏ÄÊó∂Ëæ∞
                setTimeout(() => {
                    this.nextTimeSlot();
                }, 1000);
            }
            
            nextTimeSlot() {
                if (this.currentTimeSlot < this.timeSlots.length - 1) {
                    this.selectTimeSlot(this.currentTimeSlot + 1);
                } else {
                    this.completeDayTraining();
                }
            }
            
            completeDayTraining() {
                console.log('üåü ‰∏ÄÂ§©‰øÆË°åÂÆåÊàê');
                this.showSpecialEvent('üåü ‰øÆË°åÊó•Á®ãÂÆåÊàê', '‰∏ÄÂ§©ÁöÑ‰øÆË°åÂúÜÊª°ÁªìÊùüÔºÅ‰Ω†Âú®Â¢®ÂÆ∂Â∑®Â≠êÁöÑÊåáÂØº‰∏ãÔºåÂ≠¶‰ºö‰∫ÜÂü∫Á°ÄÁöÑÊú∫ÂÖ≥ÊúØÂíåÂ•áÈó®ÈÅÅÁî≤ÔºåÂÆûÂäõÂ§ßÂ§ßÊèêÂçá„ÄÇÊòéÂ§©Â∞ÜÈù¢‰∏¥Êõ¥Â§ßÁöÑÊåëÊàò...');
            }
            
            triggerSpecialEvent(eventText = null) {
                const events = [
                    {
                        title: '‚ö° Áéâ‰Ω©ÂÖ±È∏£',
                        description: '‰øÆË°åËøáÁ®ã‰∏≠ÔºåÁéâ‰Ω©Á™ÅÁÑ∂ÂèëÂá∫Âº∫ÁÉàÁöÑÂÖâËäíÔºå‰Ω†ÊÑüËßâÂà∞‰∏ÄËÇ°ÊöñÊµÅÂú®‰ΩìÂÜÖÊµÅËΩ¨ÔºåÊòüËæâ‰πãÂäõÂæóÂà∞‰∫ÜÊòæËëóÊèêÂçáÔºÅ'
                    },
                    {
                        title: 'üîß Êú∫ÂÖ≥Â§±Êéß',
                        description: 'Âú®Â≠¶‰π†Êú∫ÂÖ≥ÊúØÊó∂Ôºå‰Ω†ËØØËß¶‰∫Ü‰∏Ä‰∏™Â§çÊùÇÊú∫ÂÖ≥ÔºåÊï¥Â∫ßÊú∫ÂÖ≥ÂüéË≠¶Êä•Â§ß‰ΩúÔºÅÂ•ΩÂú®Â¢®ÂÆ∂Â∑®Â≠êÂèäÊó∂Ëµ∂Âà∞ÂåñËß£‰∫ÜÂç±Êú∫„ÄÇ'
                    },
                    {
                        title: 'üìú ÂèëÁé∞ÁßòÁ±ç',
                        description: 'Âú®Á†îËØªÂÖ∏Á±çÊó∂ÔºåÂ¨¥ÊîøÂèëÁé∞‰∫Ü‰∏ÄÊú¨„ÄäÈæôÈ≠ÇÁéâÂΩï„ÄãÁöÑÊÆãÂç∑ÔºåÂÖ∂‰∏≠ËÆ∞ËΩΩÁùÄÂÖ≥‰∫éÁéâ‰Ω©ÁöÑÂè§ËÄÅÁßòÂØÜ...'
                    },
                    {
                        title: 'üåÄ ÂπªÈòµÂõ∞Â¢É',
                        description: 'Âú®Â•áÈó®ÈÅÅÁî≤ÊºîÁªÉ‰∏≠Ôºå‰Ω†ÂíåÂ¨¥ÊîøË¢´Âõ∞Âú®‰∏Ä‰∏™Â§çÊùÇÁöÑÂπªÈòµ‰∏≠ÔºåÂøÖÈ°ªÂêà‰ΩúÊâçËÉΩÁ†¥Ëß£ÈòµÊ≥ïËÑ±Ë∫´„ÄÇ'
                    },
                    {
                        title: 'üí´ ÊòüËæâÊä§‰Ωì',
                        description: 'Âú®ÂÆûÊàòÂØπÊäó‰∏≠ÔºåÂç±ÊÄ•Êó∂Âàª‰Ω†È¶ñÊ¨°ÊøÄÊ¥ª‰∫Ü"ÊòüËæâÊä§‰Ωì"ËÉΩÂäõÔºåË∫´‰ΩìË¢´Ê∑°Ê∑°ÁöÑÊòüÂÖâÂåÖÂõ¥ÔºåÈò≤Âæ°ÂäõÂ§ßÂ¢ûÔºÅ'
                    }
                ];
                
                let event;
                if (eventText) {
                    event = {
                        title: 'üìÖ Êó∂Ëæ∞ÁâπÊÆä‰∫ã‰ª∂',
                        description: eventText
                    };
                } else {
                    event = events[Math.floor(Math.random() * events.length)];
                }
                
                this.showSpecialEvent(event.title, event.description);
            }
            
            showSpecialEvent(title, description) {
                this.eventTitle.textContent = title;
                this.eventDescription.textContent = description;
                this.specialEvent.classList.add('show');
            }
            
            closeSpecialEvent() {
                this.specialEvent.classList.remove('show');
            }
            
            selectMaster(masterId) {
                console.log(`üë®‚Äçüè´ ÈÄâÊã©Â∏àÁà∂: ${masterId}`);
                this.selectedMaster = masterId;
                
                // Êõ¥Êñ∞UI
                document.querySelectorAll('.master-card').forEach(card => {
                    card.classList.remove('selected');
                });
                event.target.closest('.master-card').classList.add('selected');
                
                const masterNames = {
                    jingke: 'ËçÜËΩ≤',
                    mozi: 'Â¢®Â≠ê',
                    liguang: 'ÊùéÂπø',
                    yuefei: 'Â≤≥È£û',
                    huatuo: 'Âçé‰Ωó',
                    zuoci: 'Â∑¶ÊÖà'
                };
                
                this.selectedMasterSpan.textContent = masterNames[masterId];
                
                // ÊòæÁ§∫ÈÄâÊã©ÁªìÊûú
                this.showSpecialEvent('üéì Â∏àÁà∂ÈÄâÊã©', `‰Ω†ÈÄâÊã©‰∫Ü${masterNames[masterId]}‰Ωú‰∏∫Â∏àÁà∂ÔºÅ‰ªñÂ∞ÜÊïôÊéà‰Ω†‰∏ìÂ±ûÁöÑÊäÄËÉΩË∑ØÁ∫øÔºåÂºÄÂêØ‰∏çÂêåÁöÑ‰øÆË°åÈÅìË∑Ø„ÄÇ`);
            }
            
            updateScheduleDisplay() {
                const scheduleItems = document.querySelectorAll('.schedule-item');
                scheduleItems.forEach((item, index) => {
                    if (index < this.currentTimeSlot) {
                        item.classList.add('completed');
                        item.classList.remove('current');
                    } else if (index === this.currentTimeSlot) {
                        item.classList.add('current');
                        item.classList.remove('completed');
                    } else {
                        item.classList.remove('current', 'completed');
                    }
                });
            }
            
            autoProgress() {
                console.log('ü§ñ Ëá™Âä®ËøõÂ∫¶');
                const autoAdvance = () => {
                    if (this.currentTimeSlot < this.timeSlots.length - 1) {
                        this.startCultivation();
                        setTimeout(() => {
                            this.nextTimeSlot();
                            setTimeout(autoAdvance, 1000);
                        }, 2000);
                    } else {
                        this.completeDayTraining();
                    }
                };
                autoAdvance();
            }
            
            nextScene() {
                console.log('‚û°Ô∏è ÂÆåÊàê‰øÆË°åÔºåÂâçÂæÄ‰∏ã‰∏ÄÈïúÂ§¥');
                alert('ÈïúÂ§¥7ÂÆåÊàêÔºÅ\n\nÊó∂Ëæ∞ËΩÆÁõò‰øÆË°åÁ≥ªÁªüÂ±ïÁ§∫ÂÆåÊàê\nÂ¢®ÂÆ∂Êú∫ÂÖ≥ÂüéÊó•Â∏∏‰ΩìÈ™åÁªìÊùü\nÂ∏àÁà∂ÈÄâÊã©Á°ÆÂÆö\n‰øÆË°åËÉΩÂäõÂ§ßÂπÖÊèêÂçá\n\nÊïÖ‰∫ãËøõÂÖ•Êñ∞ÁöÑÁØáÁ´†...');
            }
            
            restartScene() {
                console.log('üîÑ ÈáçÊñ∞ÂºÄÂßãÈïúÂ§¥7');
                location.reload();
            }
            
            updateStatus() {
                this.statusTime.textContent = this.timeSlots[this.currentTimeSlot].name;
            }
        }
        
        // ÂÖ®Â±ÄÂáΩÊï∞
        let scene7Instance;
        
        window.addEventListener('DOMContentLoaded', () => {
            scene7Instance = new Scene7Cultivation();
        });
        
        function startCultivation() {
            scene7Instance.startCultivation();
        }
        
        function nextTimeSlot() {
            scene7Instance.nextTimeSlot();
        }
        
        function triggerSpecialEvent() {
            scene7Instance.triggerSpecialEvent();
        }
        
        function autoProgress() {
            scene7Instance.autoProgress();
        }
        
        function selectMaster(masterId) {
            scene7Instance.selectMaster(masterId);
        }
        
        function closeSpecialEvent() {
            scene7Instance.closeSpecialEvent();
        }
        
        function nextScene() {
            scene7Instance.nextScene();
        }
        
        function restartScene() {
            scene7Instance.restartScene();
        }
        
        // Âø´Êç∑ÈîÆÊîØÊåÅ
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    startCultivation();
                    break;
                case 'Enter':
                    e.preventDefault();
                    nextTimeSlot();
                    break;
                case 'e':
                case 'E':
                    triggerSpecialEvent();
                    break;
                case 'a':
                case 'A':
                    autoProgress();
                    break;
                case 'n':
                case 'N':
                    nextScene();
                    break;
                case 'r':
                case 'R':
                    restartScene();
                    break;
                case 'Escape':
                    closeSpecialEvent();
                    break;
            }
        });
        
        console.log('üéÆ ÈïúÂ§¥7ÊéßÂà∂ÔºöÁ©∫Ê†º=ÂºÄÂßã‰øÆË°å, ÂõûËΩ¶=‰∏ã‰∏ÄÊó∂Ëæ∞, E=ÁâπÊÆä‰∫ã‰ª∂, A=Ëá™Âä®ËøõÂ∫¶, N=‰∏ã‰∏ÄÈïúÂ§¥, R=ÈáçÂêØ, ESC=ÂÖ≥Èó≠ÂºπÁ™ó');
    </script>
</body>
</html> 