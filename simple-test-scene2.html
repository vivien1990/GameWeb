<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é•œå¤´2ç®€åŒ–æµ‹è¯•</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            overflow: hidden;
            font-family: 'Microsoft YaHei', sans-serif;
            cursor: crosshair;
        }
        
        #scene2-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            overflow: hidden;
        }
        
        #video-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        .scene2-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        /* åœ†å½¢æ³¢åŠ¨æŒ‰é’® */
        .activate-button {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.05) 70%, transparent 100%);
            border: 3px solid rgba(255, 255, 255, 0.6);
            z-index: 999999;
            opacity: 0;
            animation: rippleButton 2s infinite;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            pointer-events: auto;
        }
        
        .activate-button::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: rippleWave 2s infinite;
            z-index: -1;
        }
        
        .activate-button::after {
            content: '';
            position: absolute;
            width: 120%;
            height: 120%;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: rippleWave 2s infinite 0.5s;
            z-index: -2;
        }
        
        .button-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            text-align: center;
            pointer-events: none;
        }
        
        .activate-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.1) 70%, transparent 100%);
            border-color: rgba(255, 255, 255, 0.8);
        }
        
        /* åŠ¨ç”» */
        @keyframes rippleButton {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1); 
                opacity: 0.8; 
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.05); 
                opacity: 1; 
            }
        }
        
        @keyframes rippleWave {
            0% { 
                transform: scale(1); 
                opacity: 0.6; 
            }
            50% { 
                transform: scale(1.3); 
                opacity: 0.3; 
            }
            100% { 
                transform: scale(1.6); 
                opacity: 0; 
            }
        }
        
        @keyframes clickRipple {
            0% {
                width: 20px;
                height: 20px;
                opacity: 0.8;
            }
            50% {
                width: 60px;
                height: 60px;
                opacity: 0.4;
            }
            100% {
                width: 100px;
                height: 100px;
                opacity: 0;
            }
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 999999;
            min-width: 200px;
        }
        
        .control-button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: #333;
            color: white;
            border: 1px solid #666;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .control-button:hover {
            background: #555;
        }
        
        .status {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #666;
            font-size: 10px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <!-- åœºæ™¯å®¹å™¨ -->
    <div id="scene2-container">
        <!-- è§†é¢‘æ’­æ”¾åŒºåŸŸ -->
        <div id="video-container">
            <!-- è§†é¢‘ä¼šåŠ¨æ€æ’å…¥è¿™é‡Œ -->
        </div>
        
        <!-- UIå®¹å™¨ -->
        <div id="ui-container">
            <!-- æŒ‰é’®ä¼šåŠ¨æ€æ’å…¥è¿™é‡Œ -->
        </div>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="controls" id="debug-controls">
        <h4 style="margin: 0 0 10px 0; color: #ffcc00;">é•œå¤´2ç®€åŒ–æµ‹è¯•</h4>
        
        <button class="control-button" onclick="startScene2()">å¼€å§‹é•œå¤´2</button>
        <button class="control-button" onclick="testN001()">æ’­æ”¾N001</button>
        <button class="control-button" onclick="testN002()">æ’­æ”¾N002</button>
        <button class="control-button" onclick="testN003()">æ’­æ”¾N003</button>
        <button class="control-button" onclick="playThunder()">æ’­æ”¾é›·å£°</button>
        <button class="control-button" onclick="stopThunder()">åœæ­¢é›·å£°</button>
        <button class="control-button" onclick="testThunderOnly()">ä»…æµ‹è¯•é›·å£°</button>
        <button class="control-button" onclick="showButton()">æ˜¾ç¤ºæŒ‰é’®</button>
        <button class="control-button" onclick="triggerCompletion()">ğŸš€ è§¦å‘å®Œæˆ</button>
        <button class="control-button" onclick="resetAll()">é‡ç½®</button>
        
        <div class="status">
            <div>ç‚¹å‡»æ¬¡æ•°: <span id="click-count">0</span>/3</div>
            <div>å½“å‰è§†é¢‘: <span id="current-video">æ— </span></div>
            <div>çŠ¶æ€: <span id="status">å°±ç»ª</span></div>
        </div>
    </div>

    <script>
        // ç®€åŒ–çš„é•œå¤´2å®ç°
        class SimpleScene2 {
            constructor() {
                this.currentVideo = null;
                this.clickCount = 0;
                this.requiredClicks = 3;
                this.isWaitingForClicks = false;
                this.thunderAudio = null;
                this.s02002Audio = null;
                this.audioUnlocked = false; // éŸ³é¢‘è§£é”çŠ¶æ€
                this.pendingAudioActions = []; // å¾…æ‰§è¡Œçš„éŸ³é¢‘æ“ä½œ
                this.activationHandled = false; // é˜²æ­¢é‡å¤æ¿€æ´»å¤„ç†
                
                this.videoContainer = document.getElementById('video-container');
                this.uiContainer = document.getElementById('ui-container');
                
                console.log('ğŸ¬ ç®€åŒ–é•œå¤´2åˆå§‹åŒ–');
                
                // æ£€æŸ¥æ˜¯å¦åœ¨iframeä¸­è¿è¡Œï¼Œå¦‚æœæ˜¯åˆ™éšè—æ§åˆ¶é¢æ¿
                if (window.parent !== window) {
                    const debugControls = document.getElementById('debug-controls');
                    if (debugControls) {
                        debugControls.style.display = 'none';
                        console.log('ğŸ–¥ï¸ åœ¨iframeä¸­è¿è¡Œï¼Œå·²éšè—è°ƒè¯•æ§åˆ¶é¢æ¿');
                    }
                }
                
                // ç›‘å¬éŸ³é¢‘è§£é”äº‹ä»¶
                this.setupAudioUnlockListener();
            }
            
            // è®¾ç½®éŸ³é¢‘è§£é”ç›‘å¬å™¨
            setupAudioUnlockListener() {
                // æ£€æµ‹æ˜¯å¦åœ¨iframeä¸­
                const isInIframe = window.parent !== window;
                
                if (isInIframe) {
                    // åœ¨iframeä¸­ï¼Œç›‘å¬çˆ¶çª—å£çš„éŸ³é¢‘è§£é”ä¿¡å·
                    window.addEventListener('message', (event) => {
                        if (event.data.type === 'audio-unlocked') {
                            console.log('ğŸµ æ”¶åˆ°éŸ³é¢‘è§£é”ä¿¡å·');
                            this.audioUnlocked = true;
                            
                            console.log('ğŸµ éŸ³é¢‘å·²è§£é”ï¼Œç­‰å¾…é•œå¤´2çœŸæ­£æ¿€æ´»æ—¶å†å¼€å§‹æ’­æ”¾');
                            // ä¸å†è‡ªåŠ¨å¯åŠ¨ï¼Œç­‰å¾…é•œå¤´çœŸæ­£æ¿€æ´»
                        }
                    });
                    
                    // è¯·æ±‚éŸ³é¢‘çŠ¶æ€
                    window.parent.postMessage({
                        type: 'request-audio-status'
                    }, '*');
                } else {
                    // ç‹¬ç«‹è¿è¡Œæ—¶ï¼Œå‡è®¾éŸ³é¢‘å·²è§£é”
                    this.audioUnlocked = true;
                }
            }
            
            // æ‰§è¡Œå¾…å¤„ç†çš„éŸ³é¢‘æ“ä½œ
            executePendingAudioActions() {
                // åªæœ‰åœ¨é•œå¤´2æ´»è·ƒæ—¶æ‰æ‰§è¡ŒéŸ³é¢‘æ“ä½œ
                if (!this.isCurrentlyActiveScene()) {
                    console.log('ğŸµ é•œå¤´2éæ´»è·ƒçŠ¶æ€ï¼Œä¸æ‰§è¡Œå¾…å¤„ç†çš„éŸ³é¢‘æ“ä½œ');
                    return;
                }
                
                console.log(`ğŸµ æ‰§è¡Œ ${this.pendingAudioActions.length} ä¸ªå¾…å¤„ç†çš„éŸ³é¢‘æ“ä½œ`);
                this.pendingAudioActions.forEach(action => {
                    action();
                });
                this.pendingAudioActions = [];
            }
            
            // æ£€æŸ¥é•œå¤´2æ˜¯å¦ä¸ºå½“å‰æ´»è·ƒé•œå¤´
            isCurrentlyActiveScene() {
                const isInIframe = window.parent !== window;
                if (!isInIframe) {
                    // ç‹¬ç«‹è¿è¡Œæ—¶ï¼Œè®¤ä¸ºæ˜¯æ´»è·ƒçš„
                    return true;
                }
                
                try {
                    // æ£€æŸ¥iframeæ˜¯å¦å¯è§
                    const iframe = window.frameElement;
                    if (!iframe) return false;
                    
                    // æ£€æŸ¥iframeçš„çˆ¶å®¹å™¨æ˜¯å¦æœ‰activeç±»
                    const frameContainer = iframe.parentElement;
                    if (frameContainer && frameContainer.classList.contains('active')) {
                        return true;
                    }
                    
                    return false;
                } catch (e) {
                    console.warn('æ— æ³•æ£€æŸ¥iframeçŠ¶æ€:', e);
                    return false;
                }
            }
            
            // è®¾ç½®æ¿€æ´»çŠ¶æ€ç›‘å¬å™¨
            setupActivationMonitor() {
                const isInIframe = window.parent !== window;
                if (!isInIframe) return;
                
                console.log('ğŸ” è®¾ç½®é•œå¤´2æ¿€æ´»çŠ¶æ€ç›‘å¬å™¨');
                
                // å®šæœŸæ£€æŸ¥æ¿€æ´»çŠ¶æ€
                const checkActivation = () => {
                    const wasActive = this.wasActive || false;
                    const isActive = this.isCurrentlyActiveScene();
                    
                    if (!wasActive && isActive) {
                        console.log('ğŸ¯ é•œå¤´2åˆšåˆšæ¿€æ´»ï¼');
                        this.onSceneActivated();
                    }
                    
                    this.wasActive = isActive;
                };
                
                // æ¯200msæ£€æŸ¥ä¸€æ¬¡
                setInterval(checkActivation, 200);
            }
            
            // é•œå¤´æ¿€æ´»æ—¶çš„å¤„ç†
            onSceneActivated() {
                // é˜²æ­¢é‡å¤æ¿€æ´»
                if (this.activationHandled) {
                    console.log('ğŸ¯ é•œå¤´2æ¿€æ´»äº‹ä»¶å·²å¤„ç†è¿‡ï¼Œè·³è¿‡é‡å¤å¤„ç†');
                    return;
                }
                
                console.log('ğŸ¯ å¤„ç†é•œå¤´2æ¿€æ´»äº‹ä»¶');
                this.activationHandled = true;
                
                // é•œå¤´2çœŸæ­£æ¿€æ´»æ—¶ï¼Œå…ˆæ˜¾ç¤ºé»‘å±è½¬åœºï¼Œç„¶åå¼€å§‹æ’­æ”¾N001
                if (!this.currentVideo) {
                    console.log('ğŸ¬ é•œå¤´2æ¿€æ´»ï¼Œå¼€å§‹è½¬åœºåˆ°N001');
                    this.transitionToN001();
                }
                
                // å¦‚æœéŸ³é¢‘å·²è§£é”ä¸”æœ‰å¾…å¤„ç†çš„éŸ³é¢‘æ“ä½œï¼Œæ‰§è¡Œå®ƒä»¬
                if (this.audioUnlocked && this.pendingAudioActions.length > 0) {
                    console.log('ğŸµ é•œå¤´2æ¿€æ´»ï¼Œæ‰§è¡Œå¾…å¤„ç†çš„éŸ³é¢‘æ“ä½œ');
                    this.executePendingAudioActions();
                }
                
                // å¦‚æœå½“å‰æ­£åœ¨æ’­æ”¾N002ï¼Œå¯åŠ¨éŸ³æ•ˆ
                if (this.currentVideo && this.currentVideo.src.includes('N002')) {
                    if (this.audioUnlocked && !this.s02002Audio && !this.thunderAudio) {
                        console.log('ğŸµ é•œå¤´2æ¿€æ´»ï¼ŒN002æ­£åœ¨æ’­æ”¾ï¼Œå¯åŠ¨éŸ³æ•ˆ');
                        this.playS02002();
                        this.startThunder();
                    }
                }
            }
            
            // é•œå¤´1åˆ°N001çš„è½¬åœºç‰¹æ•ˆï¼ˆé»‘è¡£äººæ­¥æ­¥é€¼è¿‘ï¼‰
            transitionToN001() {
                console.log('ğŸ¬ æ‰§è¡Œé•œå¤´1â†’N001è½¬åœºç‰¹æ•ˆï¼ˆé»‘è¡£äººæ­¥æ­¥é€¼è¿‘ï¼‰');
                
                // åˆ›å»ºè½¬åœºå®¹å™¨
                const transitionContainer = document.createElement('div');
                transitionContainer.className = 'scene1-n001-transition';
                transitionContainer.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0, 0, 0, 1);
                    z-index: 99999;
                    opacity: 1;
                    pointer-events: none;
                `;
                
                document.body.appendChild(transitionContainer);
                
                // ç¬¬ä¸€é˜¶æ®µï¼šæ˜¾ç¤º"é»‘è¡£äººè½¬å‘é•œå¤´"
                this.showTransitionImage(transitionContainer, 'é•œå¤´2/é»‘è¡£äººè½¬å‘é•œå¤´.png', 2000, () => {
                    console.log('ğŸ¬ ç¬¬ä¸€é˜¶æ®µï¼šé»‘è¡£äººè½¬å‘é•œå¤´');
                });
                
                // ç¬¬äºŒé˜¶æ®µï¼šæ˜¾ç¤º"æ­¥æ­¥é€¼è¿‘"
                setTimeout(() => {
                    this.showTransitionImage(transitionContainer, 'é•œå¤´2/æ­¥æ­¥é€¼è¿‘.png', 2000, () => {
                        console.log('ğŸ¬ ç¬¬äºŒé˜¶æ®µï¼šæ­¥æ­¥é€¼è¿‘');
                    });
                }, 2000);
                
                // ç¬¬ä¸‰é˜¶æ®µï¼šå¼€å§‹æ’­æ”¾N001
                setTimeout(() => {
                    console.log('ğŸ¬ ç¬¬ä¸‰é˜¶æ®µï¼šå¼€å§‹æ’­æ”¾N001');
                    this.start();
                    
                    // æ·¡å‡ºè½¬åœºå®¹å™¨
                    transitionContainer.style.transition = 'opacity 1s ease-in-out';
                    transitionContainer.style.opacity = '0';
                    
                    setTimeout(() => {
                        if (transitionContainer.parentNode) {
                            transitionContainer.remove();
                        }
                        console.log('ğŸ¬ é•œå¤´1â†’N001è½¬åœºå®Œæˆ');
                    }, 1000);
                }, 4000);
            }
            
            // æ˜¾ç¤ºè½¬åœºå›¾ç‰‡çš„è¾…åŠ©å‡½æ•°
            showTransitionImage(container, imageSrc, duration, callback) {
                // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
                const img = document.createElement('img');
                img.src = imageSrc;
                img.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    max-width: 90%;
                    max-height: 90%;
                    object-fit: contain;
                    opacity: 0;
                    transition: opacity 0.8s ease-in-out;
                `;
                
                container.appendChild(img);
                
                // å›¾ç‰‡åŠ è½½å®Œæˆåæ·¡å…¥
                img.onload = () => {
                    setTimeout(() => {
                        img.style.opacity = '1';
                        if (callback) callback();
                    }, 100);
                };
                
                // é”™è¯¯å¤„ç†
                img.onerror = () => {
                    console.warn(`âš ï¸ è½¬åœºå›¾ç‰‡åŠ è½½å¤±è´¥: ${imageSrc}`);
                    if (callback) callback();
                };
                
                // åœ¨æŒ‡å®šæ—¶é—´åæ·¡å‡ºå¹¶ç§»é™¤
                setTimeout(() => {
                    img.style.opacity = '0';
                    setTimeout(() => {
                        if (img.parentNode) {
                            img.remove();
                        }
                    }, 800);
                }, duration - 800);
            }
            
            // æ˜¾ç¤ºè§†é¢‘é”™è¯¯ä¿¡æ¯
            showVideoError(message) {
                console.error('ğŸš¨ æ˜¾ç¤ºè§†é¢‘é”™è¯¯:', message);
                this.updateStatus(`é”™è¯¯: ${message}`);
                
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(255, 0, 0, 0.8);
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    text-align: center;
                    z-index: 1000;
                `;
                errorDiv.innerHTML = `
                    <h3>âš ï¸ è§†é¢‘åŠ è½½é”™è¯¯</h3>
                    <p>${message}</p>
                    <button onclick="location.reload()" style="margin-top: 10px; padding: 5px 10px;">åˆ·æ–°é¡µé¢</button>
                `;
                
                this.videoContainer.appendChild(errorDiv);
            }
            

            
            // N001åˆ°N002çš„è½¬åœºç‰¹æ•ˆï¼ˆN001æ¸æš—â†’N002ä»æš—æ¸äº®ï¼‰- ä¼˜åŒ–ç‰ˆæœ¬
            transitionFromN001ToN002() {
                console.log('ğŸ¬ æ‰§è¡ŒN001â†’N002ç›´æ¥è½¬åœºï¼ˆæ¸æš—â†’ä»æš—æ¸äº®+éœ‡æ’¼æ•ˆæœï¼‰');
                
                // å…ˆè®©N001æ¸æš—ï¼Œç„¶åç›´æ¥åˆ‡æ¢åˆ°N002ï¼ˆå¸¦ä»æš—æ¸äº®æ•ˆæœï¼‰
                this.fadeOutToN002();
            }
            
            // å½“å‰è§†é¢‘æ¸æš—ï¼ˆå›è°ƒç‰ˆæœ¬ï¼‰
            fadeOutCurrentVideo(callback) {
                if (!this.currentVideo) {
                    if (callback) callback();
                    return;
                }
                
                console.log('ğŸ¬ N001è§†é¢‘å¼€å§‹æ¸æš—ï¼ˆåŠ é€Ÿï¼‰');
                
                // åˆ›å»ºæ¸æš—é®ç½©
                const fadeOverlay = document.createElement('div');
                fadeOverlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0);
                    z-index: 10;
                    transition: background 0.75s ease-out;
                    pointer-events: none;
                `;
                
                this.videoContainer.appendChild(fadeOverlay);
                
                // å¼€å§‹æ¸æš—
                setTimeout(() => {
                    fadeOverlay.style.background = 'rgba(0, 0, 0, 1)';
                }, 50);
                
                // 0.75ç§’åå®Œæˆæ¸æš—ï¼Œæ‰§è¡Œå›è°ƒ
                setTimeout(() => {
                    if (callback) callback();
                    // ç§»é™¤æ¸æš—é®ç½©
                    setTimeout(() => {
                        if (fadeOverlay.parentNode) {
                            fadeOverlay.remove();
                        }
                    }, 250);
                }, 800);
            }
            
            // å½“å‰è§†é¢‘æ¸æš—ï¼ˆå¹¶è¡Œç‰ˆæœ¬ï¼Œæ— å›è°ƒï¼‰
            fadeOutCurrentVideoParallel() {
                if (!this.currentVideo) {
                    return;
                }
                
                console.log('ğŸ¬ N001è§†é¢‘å¼€å§‹å¹¶è¡Œæ¸æš—');
                
                // åˆ›å»ºæ¸æš—é®ç½©
                const fadeOverlay = document.createElement('div');
                fadeOverlay.className = 'parallel-fade-overlay';
                fadeOverlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0);
                    z-index: 10;
                    transition: background 0.6s ease-out;
                    pointer-events: none;
                `;
                
                this.videoContainer.appendChild(fadeOverlay);
                
                // ç«‹å³å¼€å§‹æ¸æš—
                setTimeout(() => {
                    fadeOverlay.style.background = 'rgba(0, 0, 0, 1)';
                }, 50);
                
                // 0.8ç§’åç§»é™¤é®ç½©
                setTimeout(() => {
                    if (fadeOverlay.parentNode) {
                        fadeOverlay.remove();
                    }
                    console.log('ğŸ¬ å¹¶è¡Œæ¸æš—å®Œæˆ');
                }, 800);
            }

            // å½“å‰è§†é¢‘æ¸æš—ï¼ˆåŠ é€Ÿç‰ˆæœ¬ï¼‰- é€Ÿåº¦æå‡3å€
            fadeOutCurrentVideoParallelFast() {
                if (!this.currentVideo) {
                    return;
                }
                
                console.log('ğŸ¬ N001è§†é¢‘å¼€å§‹å¿«é€Ÿå¹¶è¡Œæ¸æš—ï¼ˆ3å€é€Ÿï¼‰');
                
                // åˆ›å»ºæ¸æš—é®ç½©
                const fadeOverlay = document.createElement('div');
                fadeOverlay.className = 'parallel-fade-overlay-fast';
                fadeOverlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0);
                    z-index: 10;
                    transition: background 0.2s ease-out;
                    pointer-events: none;
                `;
                
                this.videoContainer.appendChild(fadeOverlay);
                
                // ç«‹å³å¼€å§‹æ¸æš—
                setTimeout(() => {
                    fadeOverlay.style.background = 'rgba(0, 0, 0, 1)';
                }, 20);
                
                // 0.25ç§’åç§»é™¤é®ç½©
                setTimeout(() => {
                    if (fadeOverlay.parentNode) {
                        fadeOverlay.remove();
                    }
                    console.log('ğŸ¬ å¿«é€Ÿå¹¶è¡Œæ¸æš—å®Œæˆ');
                }, 250);
            }

            // N001æ¸æš—åç›´æ¥åˆ‡æ¢åˆ°N002ï¼ˆå»æ‰çº¢å…‰è½¬åœºï¼‰
            fadeOutToN002() {
                if (!this.currentVideo) {
                    this.playN002Fast();
                    return;
                }
                
                console.log('ğŸ¬ N001å¼€å§‹æ¸æš—ï¼Œå‡†å¤‡ç›´æ¥åˆ‡æ¢åˆ°N002');
                
                // åˆ›å»ºæ¸æš—é®ç½©ï¼ˆä¿ç•™åœ¨è§†é¢‘å®¹å™¨ä¸­ï¼Œä½œä¸ºN002çš„æš—èƒŒæ™¯ï¼‰
                const fadeOverlay = document.createElement('div');
                fadeOverlay.className = 'fade-to-n002-overlay';
                fadeOverlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0);
                    z-index: 10;
                    transition: background 0.3s ease-out;
                    pointer-events: none;
                `;
                
                this.videoContainer.appendChild(fadeOverlay);
                
                // å¼€å§‹æ¸æš—
                setTimeout(() => {
                    fadeOverlay.style.background = 'rgba(0, 0, 0, 1)';
                }, 50);
                
                // åœ¨æ¸æš—å®Œæˆæ—¶åˆ‡æ¢åˆ°N002ï¼ˆN002ä¼šä»è¿™ä¸ªæš—èƒŒæ™¯å¼€å§‹ä»æš—æ¸äº®ï¼‰
                setTimeout(() => {
                    console.log('ğŸ¬ N001æ¸æš—å®Œæˆï¼Œç›´æ¥åˆ‡æ¢åˆ°N002ï¼ˆä»æš—æ¸äº®ï¼‰');
                    this.playN002WithDarkToLight();
                    
                    // ä¸ç«‹å³ç§»é™¤é®ç½©ï¼Œè®©N002çš„ä»æš—æ¸äº®æ•ˆæœæ¥ç®¡
                }, 350);
            }
            
            // æ’­æ”¾N002ï¼ˆä»æš—æ¸äº®ç‰ˆæœ¬ï¼Œå¸¦éœ‡æ’¼æ•ˆæœï¼‰
            playN002WithDarkToLight() {
                // é˜²æ­¢é‡å¤æ’­æ”¾ - æ›´ä¸¥æ ¼çš„æ£€æŸ¥
                if (this.currentVideo && this.currentVideo.src.includes('N002') && !this.currentVideo.paused) {
                    console.log('ğŸ¬ N002å·²åœ¨æ’­æ”¾ä¸­ï¼Œè·³è¿‡é‡å¤æ’­æ”¾');
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰N002è§†é¢‘åœ¨æ’­æ”¾
                const existingN002 = this.videoContainer.querySelector('video[src*="N002"]');
                if (existingN002 && !existingN002.paused) {
                    console.log('ğŸ¬ æ£€æµ‹åˆ°ç°æœ‰N002è§†é¢‘åœ¨æ’­æ”¾ï¼Œè·³è¿‡é‡å¤åˆ›å»º');
                    this.currentVideo = existingN002;
                    return;
                }
                
                this.updateCurrentVideo('N002');
                this.updateStatus('æ’­æ”¾N002ï¼ˆä»æš—æ¸äº®+éœ‡æ’¼ï¼‰');
                
                console.log('ğŸ¬ å¼€å§‹æ’­æ”¾N002ï¼ˆä»æš—æ¸äº®+éœ‡æ’¼æ•ˆæœï¼‰');
                
                const video = this.createVideo('é•œå¤´2/N002.mp4');
                video.loop = true;
                
                // åˆ›å»ºä»æš—æ¸äº®çš„éœ‡æ’¼æ•ˆæœï¼ˆæ¥ç®¡ä¹‹å‰çš„æš—èƒŒæ™¯ï¼‰
                this.createDarkToLightTransition(video);
                
                // å¼€å§‹æ’­æ”¾æ—¶æ’­æ”¾éŸ³æ•ˆå’Œé›·å£°
                video.addEventListener('playing', () => {
                    console.log('ğŸ¬ N002ä»æš—æ¸äº®ç‰ˆå¼€å§‹æ’­æ”¾ï¼Œæ£€æŸ¥æ˜¯å¦åº”è¯¥å¯åŠ¨éŸ³æ•ˆå’Œé›·å£°');
                    if (this.isCurrentlyActiveScene()) {
                        console.log('ğŸ¬ é•œå¤´2å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå¯åŠ¨éŸ³æ•ˆå’Œé›·å£°');
                        this.playS02002();
                        this.startThunder();
                    } else {
                        console.log('ğŸ¬ é•œå¤´2éæ´»è·ƒçŠ¶æ€ï¼Œä¸æ’­æ”¾éŸ³æ•ˆ');
                    }
                    
                    // æ’­æ”¾1ç§’åæ˜¾ç¤ºæ¿€æ´»æŒ‰é’®
                    setTimeout(() => {
                        if (!this.isWaitingForClicks) {
                            console.log('ğŸ¬ N002ä»æš—æ¸äº®ç‰ˆæ’­æ”¾ä¸­ï¼Œæ˜¾ç¤ºæ¿€æ´»æŒ‰é’®');
                            this.showActivateButton();
                        }
                    }, 1000);
                }, { once: true });
                
                // å¤‡ç”¨ï¼šé¦–æ¬¡å¾ªç¯ç»“æŸæ—¶ä¹Ÿå°è¯•æ˜¾ç¤ºæŒ‰é’®
                video.addEventListener('ended', () => {
                    if (!this.isWaitingForClicks) {
                        console.log('ğŸ¬ N002å¾ªç¯ç»“æŸï¼Œç¡®ä¿æ¿€æ´»æŒ‰é’®æ˜¾ç¤º');
                        this.showActivateButton();
                    }
                });
                
                this.setCurrentVideo(video);
            }
            
            // æ˜¾ç¤ºå¾®å¼±çº¢å…‰è½¬åœºï¼ˆä¸²è¡Œç‰ˆæœ¬ï¼‰
            showWeakRedTransition() {
                console.log('ğŸ¬ æ˜¾ç¤ºå¾®å¼±çº¢å…‰è½¬åœºï¼ˆåŠ é€Ÿï¼‰');
                
                // åˆ›å»ºè½¬åœºé®ç½©
                const overlay = document.createElement('div');
                overlay.className = 'n001-n002-transition';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0, 0, 0, 1);
                    z-index: 99999;
                    opacity: 1;
                    pointer-events: none;
                `;
                
                // æ·»åŠ å¾®å¼±çº¢å…‰æ•ˆæœ
                const redGlow = document.createElement('div');
                redGlow.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 200px;
                    height: 200px;
                    background: radial-gradient(circle, rgba(255,0,0,0.3) 0%, rgba(255,0,0,0.15) 30%, transparent 70%);
                    border-radius: 50%;
                    animation: weakRedPulse 1.2s ease-in-out infinite;
                `;
                
                overlay.appendChild(redGlow);
                document.body.appendChild(overlay);
                
                // æ·»åŠ CSSåŠ¨ç”»
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes weakRedPulse {
                        0% { 
                            transform: translate(-50%, -50%) scale(0.9);
                            opacity: 0.2;
                        }
                        50% { 
                            transform: translate(-50%, -50%) scale(1.1);
                            opacity: 0.4;
                        }
                        100% { 
                            transform: translate(-50%, -50%) scale(0.9);
                            opacity: 0.2;
                        }
                    }
                `;
                document.head.appendChild(style);
                
                // åœ¨çº¢å…‰æ˜¾ç¤º0.75ç§’ååˆ‡æ¢åˆ°N002
                setTimeout(() => {
                    console.log('ğŸ¬ çº¢å…‰è½¬åœºä¸­æœŸï¼Œåˆ‡æ¢åˆ°N002');
                    this.playN002();
                }, 750);
                
                // è½¬åœºç»“æŸï¼Œæ·¡å‡ºçº¢å…‰
                setTimeout(() => {
                    overlay.style.transition = 'opacity 0.5s ease-out';
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        if (overlay.parentNode) {
                            overlay.remove();
                        }
                        if (style.parentNode) {
                            style.remove();
                        }
                        console.log('ğŸ¬ N001â†’N002è½¬åœºå®Œæˆ');
                    }, 500);
                }, 1250);
            }
            
            // æ˜¾ç¤ºå¾®å¼±çº¢å…‰è½¬åœºï¼ˆå¹¶è¡Œç‰ˆæœ¬ï¼‰
            showWeakRedTransitionParallel() {
                console.log('ğŸ¬ æ˜¾ç¤ºå¹¶è¡Œå¾®å¼±çº¢å…‰è½¬åœº');
                
                // 0.3ç§’å»¶è¿Ÿåå¼€å§‹çº¢å…‰ï¼Œè®©æ¸æš—å…ˆè¿›è¡Œä¸€ç‚¹
                setTimeout(() => {
                    // åˆ›å»ºè½¬åœºé®ç½©
                    const overlay = document.createElement('div');
                    overlay.className = 'n001-n002-parallel-transition';
                    overlay.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background: rgba(0, 0, 0, 0);
                        z-index: 99999;
                        opacity: 0;
                        transition: all 0.4s ease-in-out;
                        pointer-events: none;
                    `;
                    
                    // æ·»åŠ å¾®å¼±çº¢å…‰æ•ˆæœ
                    const redGlow = document.createElement('div');
                    redGlow.style.cssText = `
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 200px;
                        height: 200px;
                        background: radial-gradient(circle, rgba(255,0,0,0.3) 0%, rgba(255,0,0,0.15) 30%, transparent 70%);
                        border-radius: 50%;
                        animation: weakRedPulseParallel 1s ease-in-out infinite;
                    `;
                    
                    overlay.appendChild(redGlow);
                    document.body.appendChild(overlay);
                    
                    // æ·»åŠ CSSåŠ¨ç”»
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes weakRedPulseParallel {
                            0% { 
                                transform: translate(-50%, -50%) scale(0.9);
                                opacity: 0.3;
                            }
                            50% { 
                                transform: translate(-50%, -50%) scale(1.1);
                                opacity: 0.5;
                            }
                            100% { 
                                transform: translate(-50%, -50%) scale(0.9);
                                opacity: 0.3;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    // ç«‹å³æ˜¾ç¤ºçº¢å…‰æ•ˆæœ
                    setTimeout(() => {
                        overlay.style.background = 'rgba(0, 0, 0, 0.8)';
                        overlay.style.opacity = '1';
                    }, 50);
                    
                    // 0.5ç§’ååˆ‡æ¢åˆ°N002
                    setTimeout(() => {
                        console.log('ğŸ¬ å¹¶è¡Œçº¢å…‰è½¬åœºä¸­æœŸï¼Œåˆ‡æ¢åˆ°N002');
                        this.playN002();
                    }, 500);
                    
                    // è½¬åœºç»“æŸï¼Œæ·¡å‡ºçº¢å…‰
                    setTimeout(() => {
                        overlay.style.opacity = '0';
                        setTimeout(() => {
                            if (overlay.parentNode) {
                                overlay.remove();
                            }
                            if (style.parentNode) {
                                style.remove();
                            }
                            console.log('ğŸ¬ å¹¶è¡ŒN001â†’N002è½¬åœºå®Œæˆ');
                        }, 400);
                    }, 1000);
                }, 300); // 0.3ç§’å»¶è¿Ÿå¼€å§‹çº¢å…‰
            }

            // æ˜¾ç¤ºå¾®å¼±çº¢å…‰è½¬åœºï¼ˆåŠ é€Ÿç‰ˆæœ¬ï¼‰- é€Ÿåº¦æå‡3å€ï¼ŒåŠ éœ‡æ’¼æ•ˆæœ
            showWeakRedTransitionParallelFast() {
                console.log('ğŸ¬ æ˜¾ç¤ºå¿«é€Ÿå¹¶è¡Œçº¢å…‰è½¬åœºï¼ˆ3å€é€Ÿ+éœ‡æ’¼æ•ˆæœï¼‰');
                
                // ç¼©çŸ­å»¶è¿Ÿåˆ°0.1ç§’
                setTimeout(() => {
                    // åˆ›å»ºè½¬åœºé®ç½©
                    const overlay = document.createElement('div');
                    overlay.className = 'n001-n002-parallel-transition-fast';
                    overlay.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background: rgba(0, 0, 0, 0);
                        z-index: 99999;
                        opacity: 0;
                        transition: all 0.15s ease-in-out;
                        pointer-events: none;
                    `;
                    
                    // æ·»åŠ å¢å¼ºçº¢å…‰æ•ˆæœ
                    const redGlow = document.createElement('div');
                    redGlow.style.cssText = `
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 250px;
                        height: 250px;
                        background: radial-gradient(circle, rgba(255,0,0,0.5) 0%, rgba(255,0,0,0.25) 30%, transparent 70%);
                        border-radius: 50%;
                        animation: shockRedPulseFast 0.3s ease-in-out infinite;
                    `;
                    
                    overlay.appendChild(redGlow);
                    document.body.appendChild(overlay);
                    
                    // æ·»åŠ åŠ é€ŸCSSåŠ¨ç”»å’Œéœ‡æ’¼æ•ˆæœ
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes shockRedPulseFast {
                            0% { 
                                transform: translate(-50%, -50%) scale(0.7);
                                opacity: 0.4;
                            }
                            50% { 
                                transform: translate(-50%, -50%) scale(1.3);
                                opacity: 0.7;
                            }
                            100% { 
                                transform: translate(-50%, -50%) scale(0.7);
                                opacity: 0.4;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    // ç«‹å³æ˜¾ç¤ºçº¢å…‰æ•ˆæœ
                    setTimeout(() => {
                        overlay.style.background = 'rgba(0, 0, 0, 0.9)';
                        overlay.style.opacity = '1';
                    }, 20);
                    
                    // 0.15ç§’ååˆ‡æ¢åˆ°N002ï¼ˆåŠ é€Ÿç‰ˆæœ¬ï¼‰
                    setTimeout(() => {
                        console.log('ğŸ¬ å¿«é€Ÿçº¢å…‰è½¬åœºä¸­æœŸï¼Œåˆ‡æ¢åˆ°N002');
                        this.playN002Fast(); // è°ƒç”¨åŠ é€Ÿç‰ˆN002æ’­æ”¾
                    }, 150);
                    
                    // è½¬åœºç»“æŸï¼Œå¿«é€Ÿæ·¡å‡ºçº¢å…‰
                    setTimeout(() => {
                        overlay.style.opacity = '0';
                        setTimeout(() => {
                            if (overlay.parentNode) {
                                overlay.remove();
                            }
                            if (style.parentNode) {
                                style.remove();
                            }
                            console.log('ğŸ¬ å¿«é€ŸN001â†’N002è½¬åœºå®Œæˆ');
                        }, 150);
                    }, 350);
                }, 100); // 0.1ç§’å»¶è¿Ÿå¼€å§‹çº¢å…‰
            }
            
            // N002åˆ°N003çš„è½¬åœºç‰¹æ•ˆï¼ˆå¿«é€Ÿé»‘å±æ¸éšï¼Œä¼˜åŒ–N003å¯è§æ€§ï¼‰
            transitionFromN002ToN003() {
                console.log('ğŸ¬ æ‰§è¡ŒN002â†’N003è½¬åœºç‰¹æ•ˆï¼ˆå¿«é€Ÿé»‘å±æ¸éšï¼Œä¼˜åŒ–N003å¯è§æ€§ï¼‰');
                
                // åˆ›å»ºå¿«é€Ÿé»‘å±è½¬åœºé®ç½©
                const overlay = document.createElement('div');
                overlay.className = 'n002-n003-transition-optimized';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0, 0, 0, 1);
                    z-index: 99999;
                    opacity: 0;
                    transition: opacity 0.4s ease-in-out;
                    pointer-events: none;
                `;
                
                document.body.appendChild(overlay);
                
                // å¿«é€Ÿå¼€å§‹è½¬åœº
                setTimeout(() => {
                    overlay.style.opacity = '1';
                }, 50);
                
                // åœ¨è½¬åœºæ—©æœŸåˆ‡æ¢åˆ°N003ï¼ˆæå‰åˆ‡æ¢ï¼Œç¡®ä¿N003æœ‰è¶³å¤Ÿæ—¶é—´æ˜¾ç¤ºï¼‰
                setTimeout(() => {
                    console.log('ğŸ¬ å¿«é€Ÿè½¬åœºï¼Œæå‰åˆ‡æ¢åˆ°N003');
                    this.playN003();
                }, 250);
                
                // å¿«é€Ÿç»“æŸè½¬åœºï¼Œè®©N003ç”»é¢å°½æ—©å¯è§
                setTimeout(() => {
                    overlay.style.transition = 'opacity 0.3s ease-out';
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        if (overlay.parentNode) {
                            overlay.remove();
                        }
                        console.log('ğŸ¬ N002â†’N003å¿«é€Ÿè½¬åœºå®Œæˆï¼ŒN003ç”»é¢å¯è§');
                    }, 300);
                }, 500);
            }
            
            // å¼€å§‹åœºæ™¯
            start() {
                console.log('ğŸ¬ å¼€å§‹é•œå¤´2');
                this.updateStatus('å¯åŠ¨ä¸­...');
                this.playN001();
            }
            
            // æ’­æ”¾N001
            playN001() {
                // é˜²æ­¢é‡å¤æ’­æ”¾ - æ›´ä¸¥æ ¼çš„æ£€æŸ¥
                if (this.currentVideo && this.currentVideo.src.includes('N001') && !this.currentVideo.paused) {
                    console.log('ğŸ¬ N001å·²åœ¨æ’­æ”¾ä¸­ï¼Œè·³è¿‡é‡å¤æ’­æ”¾');
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰N001è§†é¢‘åœ¨æ’­æ”¾
                const existingN001 = this.videoContainer.querySelector('video[src*="N001"]');
                if (existingN001 && !existingN001.paused) {
                    console.log('ğŸ¬ æ£€æµ‹åˆ°ç°æœ‰N001è§†é¢‘åœ¨æ’­æ”¾ï¼Œè·³è¿‡é‡å¤åˆ›å»º');
                    this.currentVideo = existingN001; // ç¡®ä¿currentVideoæŒ‡å‘æ­£ç¡®çš„è§†é¢‘
                    return;
                }
                
                this.updateCurrentVideo('N001');
                this.updateStatus('æ’­æ”¾N001');
                
                console.log('ğŸ¬ å¼€å§‹æ’­æ”¾N001');
                
                // N001å¼€å§‹æ’­æ”¾ï¼ˆç§»é™¤äº†è°ƒè¯•é€šçŸ¥ï¼‰
                
                const video = this.createVideo('é•œå¤´2/N001.mp4');
                
                // æ·»åŠ æ›´è¯¦ç»†çš„äº‹ä»¶ç›‘å¬
                video.addEventListener('ended', () => {
                    console.log('âœ… N001æ’­æ”¾å®Œæ¯•ï¼Œå¼€å§‹è½¬åœºç‰¹æ•ˆ');
                    this.transitionFromN001ToN002();
                });
                
                video.addEventListener('canplay', () => {
                    console.log('âœ… N001è§†é¢‘å¯ä»¥æ’­æ”¾');
                });
                
                video.addEventListener('playing', () => {
                    console.log('â–¶ï¸ N001è§†é¢‘å¼€å§‹æ’­æ”¾');
                });
                
                video.addEventListener('stalled', () => {
                    console.warn('âš ï¸ N001è§†é¢‘æ’­æ”¾åœæ»');
                });
                
                video.addEventListener('waiting', () => {
                    console.warn('â³ N001è§†é¢‘ç­‰å¾…æ•°æ®');
                });
                
                // ç›‘å¬æ—¶é—´æ›´æ–°ï¼Œæ˜¾ç¤ºæ’­æ”¾è¿›åº¦
                video.addEventListener('timeupdate', () => {
                    if (video.duration > 0) {
                        const progress = Math.round((video.currentTime / video.duration) * 100);
                        if (progress % 20 === 0) { // æ¯20%æ˜¾ç¤ºä¸€æ¬¡
                            console.log(`ğŸ¬ N001æ’­æ”¾è¿›åº¦: ${progress}% (${video.currentTime.toFixed(1)}s/${video.duration.toFixed(1)}s)`);
                        }
                    }
                });
                
                this.setCurrentVideo(video);
                
                // ç§»é™¤è¶…æ—¶æœºåˆ¶ï¼Œè®©N001è‡ªç„¶æ’­æ”¾æˆ–å¤±è´¥
                console.log('ğŸ¬ N001å·²è®¾ç½®ï¼Œç­‰å¾…è‡ªç„¶æ’­æ”¾æˆ–loadedäº‹ä»¶');
            }
            
            // æ’­æ”¾N002ï¼ˆå¾ªç¯ï¼‰
            playN002() {
                // é˜²æ­¢é‡å¤æ’­æ”¾ - æ›´ä¸¥æ ¼çš„æ£€æŸ¥
                if (this.currentVideo && this.currentVideo.src.includes('N002') && !this.currentVideo.paused) {
                    console.log('ğŸ¬ N002å·²åœ¨æ’­æ”¾ä¸­ï¼Œè·³è¿‡é‡å¤æ’­æ”¾');
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰N002è§†é¢‘åœ¨æ’­æ”¾
                const existingN002 = this.videoContainer.querySelector('video[src*="N002"]');
                if (existingN002 && !existingN002.paused) {
                    console.log('ğŸ¬ æ£€æµ‹åˆ°ç°æœ‰N002è§†é¢‘åœ¨æ’­æ”¾ï¼Œè·³è¿‡é‡å¤åˆ›å»º');
                    this.currentVideo = existingN002; // ç¡®ä¿currentVideoæŒ‡å‘æ­£ç¡®çš„è§†é¢‘
                    // ç¡®ä¿æ¿€æ´»æŒ‰é’®æ˜¾ç¤º
                    if (!this.isWaitingForClicks) {
                        setTimeout(() => this.showActivateButton(), 1000);
                    }
                    return;
                }
                
                this.updateCurrentVideo('N002');
                this.updateStatus('æ’­æ”¾N002ï¼ˆå¾ªç¯ï¼‰');
                
                console.log('ğŸ¬ å¼€å§‹æ’­æ”¾N002ï¼ˆå¾ªç¯ï¼‰');
                
                const video = this.createVideo('é•œå¤´2/N002.mp4');
                video.loop = true;
                
                // å¼€å§‹æ’­æ”¾æ—¶æ’­æ”¾éŸ³æ•ˆå’Œé›·å£°
                video.addEventListener('playing', () => {
                    console.log('ğŸ¬ N002å¼€å§‹æ’­æ”¾ï¼Œæ£€æŸ¥æ˜¯å¦åº”è¯¥å¯åŠ¨éŸ³æ•ˆå’Œé›·å£°');
                    if (this.isCurrentlyActiveScene()) {
                        console.log('ğŸ¬ é•œå¤´2å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå¯åŠ¨éŸ³æ•ˆå’Œé›·å£°');
                        this.playS02002();
                        this.startThunder();
                    } else {
                        console.log('ğŸ¬ é•œå¤´2éæ´»è·ƒçŠ¶æ€ï¼Œä¸æ’­æ”¾éŸ³æ•ˆ');
                    }
                    
                    // æ’­æ”¾3ç§’åæ˜¾ç¤ºæ¿€æ´»æŒ‰é’®ï¼Œç¡®ä¿ç”¨æˆ·çœ‹åˆ°è§†é¢‘å†…å®¹
                    setTimeout(() => {
                        if (!this.isWaitingForClicks) {
                            console.log('ğŸ¬ N002æ’­æ”¾ä¸­ï¼Œæ˜¾ç¤ºæ¿€æ´»æŒ‰é’®');
                            this.showActivateButton();
                        }
                    }, 3000);
                }, { once: true });
                
                // å¤‡ç”¨ï¼šé¦–æ¬¡å¾ªç¯ç»“æŸæ—¶ä¹Ÿå°è¯•æ˜¾ç¤ºæŒ‰é’®ï¼ˆé˜²æ­¢ä¸Šé¢çš„timeoutå¤±æ•ˆï¼‰
                video.addEventListener('ended', () => {
                    if (!this.isWaitingForClicks) {
                        console.log('ğŸ¬ N002å¾ªç¯ç»“æŸï¼Œç¡®ä¿æ¿€æ´»æŒ‰é’®æ˜¾ç¤º');
                        this.showActivateButton();
                    }
                });
                
                this.setCurrentVideo(video);
            }
            
            // æ’­æ”¾N002ï¼ˆå¾ªç¯ï¼‰- åŠ é€Ÿç‰ˆæœ¬ï¼Œå¸¦éœ‡æ’¼æ•ˆæœ
            playN002Fast() {
                // é˜²æ­¢é‡å¤æ’­æ”¾ - æ›´ä¸¥æ ¼çš„æ£€æŸ¥
                if (this.currentVideo && this.currentVideo.src.includes('N002') && !this.currentVideo.paused) {
                    console.log('ğŸ¬ N002å·²åœ¨æ’­æ”¾ä¸­ï¼Œè·³è¿‡é‡å¤æ’­æ”¾');
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰N002è§†é¢‘åœ¨æ’­æ”¾
                const existingN002 = this.videoContainer.querySelector('video[src*="N002"]');
                if (existingN002 && !existingN002.paused) {
                    console.log('ğŸ¬ æ£€æµ‹åˆ°ç°æœ‰N002è§†é¢‘åœ¨æ’­æ”¾ï¼Œè·³è¿‡é‡å¤åˆ›å»º');
                    this.currentVideo = existingN002;
                    // ç¡®ä¿æ¿€æ´»æŒ‰é’®æ˜¾ç¤º
                    if (!this.isWaitingForClicks) {
                        setTimeout(() => this.showActivateButton(), 300); // åŠ é€Ÿæ˜¾ç¤º
                    }
                    return;
                }
                
                this.updateCurrentVideo('N002');
                this.updateStatus('æ’­æ”¾N002ï¼ˆå¾ªç¯ï¼‰- åŠ é€Ÿç‰ˆæœ¬');
                
                console.log('ğŸ¬ å¼€å§‹æ’­æ”¾N002ï¼ˆå¾ªç¯ï¼‰- åŠ é€Ÿç‰ˆæœ¬ + éœ‡æ’¼æ•ˆæœ');
                
                const video = this.createVideo('é•œå¤´2/N002.mp4');
                video.loop = true;
                
                // æ·»åŠ å¿«é€Ÿä»é»‘åˆ°äº®çš„éœ‡æ’¼æ•ˆæœ
                this.createBlackToLightShockEffect(video);
                
                // å¼€å§‹æ’­æ”¾æ—¶æ’­æ”¾éŸ³æ•ˆå’Œé›·å£°
                video.addEventListener('playing', () => {
                    console.log('ğŸ¬ N002å¿«é€Ÿç‰ˆå¼€å§‹æ’­æ”¾ï¼Œæ£€æŸ¥æ˜¯å¦åº”è¯¥å¯åŠ¨éŸ³æ•ˆå’Œé›·å£°');
                    if (this.isCurrentlyActiveScene()) {
                        console.log('ğŸ¬ é•œå¤´2å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå¯åŠ¨éŸ³æ•ˆå’Œé›·å£°');
                        this.playS02002();
                        this.startThunder();
                    } else {
                        console.log('ğŸ¬ é•œå¤´2éæ´»è·ƒçŠ¶æ€ï¼Œä¸æ’­æ”¾éŸ³æ•ˆ');
                    }
                    
                    // æ’­æ”¾1ç§’åæ˜¾ç¤ºæ¿€æ´»æŒ‰é’®ï¼ˆåŠ é€Ÿç‰ˆæœ¬ï¼‰
                    setTimeout(() => {
                        if (!this.isWaitingForClicks) {
                            console.log('ğŸ¬ N002å¿«é€Ÿç‰ˆæ’­æ”¾ä¸­ï¼Œæ˜¾ç¤ºæ¿€æ´»æŒ‰é’®');
                            this.showActivateButton();
                        }
                    }, 1000);
                }, { once: true });
                
                // å¤‡ç”¨ï¼šé¦–æ¬¡å¾ªç¯ç»“æŸæ—¶ä¹Ÿå°è¯•æ˜¾ç¤ºæŒ‰é’®
                video.addEventListener('ended', () => {
                    if (!this.isWaitingForClicks) {
                        console.log('ğŸ¬ N002å¾ªç¯ç»“æŸï¼Œç¡®ä¿æ¿€æ´»æŒ‰é’®æ˜¾ç¤º');
                        this.showActivateButton();
                    }
                });
                
                this.setCurrentVideo(video);
            }
            
            // åˆ›å»ºä»é»‘åˆ°äº®çš„éœ‡æ’¼æ•ˆæœ
            createBlackToLightShockEffect(video) {
                console.log('âœ¨ åˆ›å»ºä»é»‘åˆ°äº®çš„éœ‡æ’¼æ•ˆæœ');
                
                // åˆ›å»ºéœ‡æ’¼æ•ˆæœå®¹å™¨
                const shockContainer = document.createElement('div');
                shockContainer.className = 'black-to-light-shock';
                shockContainer.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: 20;
                    pointer-events: none;
                `;
                
                // æ·»åŠ é»‘å±é®ç½©
                const blackOverlay = document.createElement('div');
                blackOverlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 1);
                    z-index: 21;
                    transition: opacity 0.3s ease-out;
                `;
                
                // æ·»åŠ äº®åº¦æå‡å±‚
                const brightLayer = document.createElement('div');
                brightLayer.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0);
                    z-index: 22;
                    transition: all 0.2s ease-out;
                    mix-blend-mode: screen;
                `;
                
                shockContainer.appendChild(blackOverlay);
                shockContainer.appendChild(brightLayer);
                this.videoContainer.appendChild(shockContainer);
                
                // æ·»åŠ éœ‡æ’¼åŠ¨ç”»æ ·å¼
                const shockStyle = document.createElement('style');
                shockStyle.textContent = `
                    @keyframes shockScaleEffect {
                        0% { 
                            transform: scale(1);
                        }
                        20% { 
                            transform: scale(1.05);
                        }
                        40% { 
                            transform: scale(0.95);
                        }
                        60% { 
                            transform: scale(1.03);
                        }
                        80% { 
                            transform: scale(0.98);
                        }
                        100% { 
                            transform: scale(1);
                        }
                    }
                    
                    .video-shock-scale {
                        animation: shockScaleEffect 0.6s ease-in-out;
                    }
                `;
                document.head.appendChild(shockStyle);
                
                // æ‰§è¡Œéœ‡æ’¼æ•ˆæœåºåˆ—
                setTimeout(() => {
                    // ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€Ÿå»é™¤é»‘å±
                    blackOverlay.style.opacity = '0';
                    console.log('âœ¨ ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€Ÿå»é™¤é»‘å±');
                }, 100);
                
                setTimeout(() => {
                    // ç¬¬äºŒé˜¶æ®µï¼šäº®åº¦çˆ†å‘
                    brightLayer.style.background = 'rgba(255, 255, 255, 0.3)';
                    console.log('âœ¨ ç¬¬äºŒé˜¶æ®µï¼šäº®åº¦çˆ†å‘');
                }, 200);
                
                setTimeout(() => {
                    // ç¬¬ä¸‰é˜¶æ®µï¼šéœ‡æ’¼ç¼©æ”¾
                    video.classList.add('video-shock-scale');
                    console.log('âœ¨ ç¬¬ä¸‰é˜¶æ®µï¼šéœ‡æ’¼ç¼©æ”¾');
                }, 250);
                
                setTimeout(() => {
                    // ç¬¬å››é˜¶æ®µï¼šé€æ¸æ¢å¤æ­£å¸¸
                    brightLayer.style.background = 'rgba(255, 255, 255, 0.1)';
                    console.log('âœ¨ ç¬¬å››é˜¶æ®µï¼šé€æ¸æ¢å¤æ­£å¸¸');
                }, 400);
                
                setTimeout(() => {
                    // ç¬¬äº”é˜¶æ®µï¼šå®Œå…¨æ¢å¤
                    brightLayer.style.background = 'rgba(255, 255, 255, 0)';
                    console.log('âœ¨ ç¬¬äº”é˜¶æ®µï¼šå®Œå…¨æ¢å¤');
                }, 600);
                
                // æ¸…ç†æ•ˆæœ
                setTimeout(() => {
                    if (shockContainer.parentNode) {
                        shockContainer.remove();
                    }
                    if (shockStyle.parentNode) {
                        shockStyle.remove();
                    }
                    video.classList.remove('video-shock-scale');
                    console.log('âœ¨ ä»é»‘åˆ°äº®éœ‡æ’¼æ•ˆæœå®Œæˆ');
                }, 900);
            }

            // åˆ›å»ºä»æš—æ¸äº®è½¬åœºæ•ˆæœï¼ˆæ¥ç®¡N001çš„æ¸æš—èƒŒæ™¯ï¼‰
            createDarkToLightTransition(video) {
                console.log('âœ¨ åˆ›å»ºä»æš—æ¸äº®è½¬åœºæ•ˆæœï¼ˆæ— çº¢å…‰ï¼Œç›´æ¥ä»æš—èƒŒæ™¯æ¸äº®ï¼‰');
                
                // å¯»æ‰¾å¹¶ç§»é™¤ä¹‹å‰çš„æ¸æš—é®ç½©
                const existingOverlay = this.videoContainer.querySelector('.fade-to-n002-overlay');
                
                // æ·»åŠ å¢å¼ºçš„éœ‡æ’¼åŠ¨ç”»æ ·å¼ (ç‰ˆæœ¬: æƒŠå“å¼v2.0)
                const transitionStyle = document.createElement('style');
                transitionStyle.textContent = `
                    @keyframes enhancedShockEffect {
                        /* è“„åŠ›é˜¶æ®µï¼šè¥é€ å‹è¿«æ„Ÿï¼Œå¢åŠ é¢¤æŠ– */
                        0% { 
                            transform: scale(0.3) rotate(0deg) translateX(0px);
                            filter: brightness(0.05) contrast(0.2) blur(8px) saturate(0.1);
                        }
                        4% { 
                            transform: scale(0.32) rotate(-0.5deg) translateX(-2px);
                            filter: brightness(0.07) contrast(0.25) blur(7px) saturate(0.15);
                        }
                        8% { 
                            transform: scale(0.35) rotate(0.5deg) translateX(2px);
                            filter: brightness(0.1) contrast(0.3) blur(6px) saturate(0.2);
                        }
                        12% { 
                            transform: scale(0.38) rotate(-1deg) translateX(-3px);
                            filter: brightness(0.15) contrast(0.4) blur(5px) saturate(0.3);
                        }
                        16% { 
                            transform: scale(0.4) rotate(1deg) translateX(3px);
                            filter: brightness(0.2) contrast(0.5) blur(4px) saturate(0.4);
                        }
                        /* çˆ†å‘é˜¶æ®µï¼šæç«¯æ”¾å¤§ + å¿«é€Ÿé¢¤æŠ– */
                        20% { 
                            transform: scale(18) rotate(-12deg) translateX(-8px);
                            filter: brightness(10.0) contrast(6.0) blur(0px) saturate(5.0);
                        }
                        22% { 
                            transform: scale(16) rotate(10deg) translateX(8px);
                            filter: brightness(8.0) contrast(5.0) blur(0px) saturate(4.5);
                        }
                        24% { 
                            transform: scale(14) rotate(-8deg) translateX(-6px);
                            filter: brightness(7.0) contrast(4.5) blur(0px) saturate(4.0);
                        }
                        /* å¼ºå†²å‡»é˜¶æ®µï¼ŒåŠ å…¥éœ‡è¡ */
                        30% { 
                            transform: scale(6) rotate(12deg) translateX(5px);
                            filter: brightness(5.0) contrast(4.0) blur(0px) saturate(3.5);
                        }
                        35% { 
                            transform: scale(5.5) rotate(-10deg) translateX(-4px);
                            filter: brightness(4.5) contrast(3.8) blur(0px) saturate(3.2);
                        }
                        40% { 
                            transform: scale(5) rotate(8deg) translateX(3px);
                            filter: brightness(4.0) contrast(3.5) blur(0px) saturate(3.0);
                        }
                        50% { 
                            transform: scale(3.5) rotate(-5deg) translateX(-2px);
                            filter: brightness(3.0) contrast(3.0) blur(0px) saturate(2.5);
                        }
                        60% { 
                            transform: scale(2.5) rotate(3deg) translateX(2px);
                            filter: brightness(2.5) contrast(2.5) blur(0px) saturate(2.0);
                        }
                        /* ç¨³å®šè¿‡æ¸¡ï¼ŒæŒç»­è½»å¾®éœ‡è¡ */
                        70% { 
                            transform: scale(1.8) rotate(-2deg) translateX(-1px);
                            filter: brightness(2.0) contrast(2.2) blur(0px) saturate(1.8);
                        }
                        80% { 
                            transform: scale(1.3) rotate(1deg) translateX(1px);
                            filter: brightness(1.5) contrast(1.8) blur(0px) saturate(1.3);
                        }
                        90% { 
                            transform: scale(1.1) rotate(-0.5deg) translateX(0px);
                            filter: brightness(1.2) contrast(1.3) blur(0px) saturate(1.1);
                        }
                        /* æ¢å¤æ­£å¸¸ */
                        100% { 
                            transform: scale(1) rotate(0deg) translateX(0px);
                            filter: brightness(1) contrast(1) blur(0px) saturate(1);
                        }
                    }
                    
                    @keyframes bodyShake {
                        /* é…åˆè“„åŠ›é˜¶æ®µ - è½»å¾®ä¸å®‰æ„Ÿ */
                        0% { transform: translateX(0) translateY(0); }
                        4% { transform: translateX(-1px) translateY(-1px); }
                        8% { transform: translateX(1px) translateY(1px); }
                        12% { transform: translateX(-2px) translateY(1px); }
                        16% { transform: translateX(2px) translateY(-1px); }
                        /* çˆ†å‘é˜¶æ®µ - å¼ºçƒˆä½†å¯æ§çš„éœ‡åŠ¨ */
                        20% { transform: translateX(-8px) translateY(-6px); }
                        22% { transform: translateX(8px) translateY(6px); }
                        24% { transform: translateX(-7px) translateY(5px); }
                        26% { transform: translateX(7px) translateY(-5px); }
                        28% { transform: translateX(-6px) translateY(-4px); }
                        30% { transform: translateX(6px) translateY(4px); }
                        32% { transform: translateX(-5px) translateY(3px); }
                        34% { transform: translateX(5px) translateY(-3px); }
                        36% { transform: translateX(-4px) translateY(-2px); }
                        38% { transform: translateX(4px) translateY(2px); }
                        /* å¼ºéœ‡é˜¶æ®µ - å¯†é›†éœ‡åŠ¨ */
                        40% { transform: translateX(-6px) translateY(-4px); }
                        42% { transform: translateX(6px) translateY(4px); }
                        44% { transform: translateX(-5px) translateY(3px); }
                        46% { transform: translateX(5px) translateY(-3px); }
                        48% { transform: translateX(-4px) translateY(-2px); }
                        50% { transform: translateX(4px) translateY(2px); }
                        52% { transform: translateX(-3px) translateY(1px); }
                        54% { transform: translateX(3px) translateY(-1px); }
                        56% { transform: translateX(-2px) translateY(-1px); }
                        58% { transform: translateX(2px) translateY(1px); }
                        60% { transform: translateX(-1px) translateY(0px); }
                        /* é€æ¸å¹³æ¯ - ç²¾ç»†æ§åˆ¶ */
                        65% { transform: translateX(1px) translateY(-1px); }
                        70% { transform: translateX(-1px) translateY(1px); }
                        75% { transform: translateX(1px) translateY(0px); }
                        80% { transform: translateX(-1px) translateY(0px); }
                        85% { transform: translateX(0px) translateY(-1px); }
                        90% { transform: translateX(0px) translateY(1px); }
                        95% { transform: translateX(0px) translateY(0px); }
                        100% { transform: translateX(0) translateY(0); }
                    }
                    
                    .video-enhanced-shock {
                        animation: enhancedShockEffect 0.6s ease-out;
                    }
                    
                    .body-shock-effect {
                        animation: bodyShake 0.6s ease-out;
                    }
                `;
                document.head.appendChild(transitionStyle);
                
                // ç­‰å¾…è§†é¢‘å‡†å¤‡å¥½å†å¼€å§‹ä»æš—æ¸äº®
                setTimeout(() => {
                    // ç¬¬ä¸€é˜¶æ®µï¼šå¼€å§‹å¢å¼ºéœ‡æ’¼æ•ˆæœï¼ˆè§†é¢‘+å…¨å±éœ‡åŠ¨ï¼‰
                    video.classList.add('video-enhanced-shock');
                    document.body.classList.add('body-shock-effect');
                    console.log('âœ¨ ç¬¬ä¸€é˜¶æ®µï¼šå¼€å§‹å¢å¼ºéœ‡æ’¼æ•ˆæœï¼ˆè§†é¢‘ç¼©æ”¾+æ—‹è½¬+äº®åº¦+å…¨å±éœ‡åŠ¨ï¼‰');
                    
                    // åˆ›å»ºå¤šå±‚æ¬¡é—ªå…‰å†²å‡»æ•ˆæœ
                    this.createEnhancedFlashSequence();
                    
                    // ç¬¬äºŒé˜¶æ®µï¼šæ¸äº®æ•ˆæœ
                    if (existingOverlay) {
                        existingOverlay.style.transition = 'background 0.6s ease-out';
                        existingOverlay.style.background = 'rgba(0, 0, 0, 0)';
                        console.log('âœ¨ ç¬¬äºŒé˜¶æ®µï¼šä»æš—èƒŒæ™¯å¼€å§‹æ¸äº®');
                        
                        // ç§»é™¤æš—èƒŒæ™¯é®ç½©
                        setTimeout(() => {
                            if (existingOverlay.parentNode) {
                                existingOverlay.remove();
                            }
                            console.log('âœ¨ ç¬¬ä¸‰é˜¶æ®µï¼šç§»é™¤æš—èƒŒæ™¯ï¼Œç”»é¢å®Œå…¨æ˜¾ç¤º');
                        }, 600);
                    }
                }, 100);
                
                // æ¸…ç†æ ·å¼
                setTimeout(() => {
                    video.classList.remove('video-enhanced-shock');
                    document.body.classList.remove('body-shock-effect');
                    
                    if (transitionStyle.parentNode) {
                        transitionStyle.remove();
                    }
                    console.log('âœ¨ ä¼˜åŒ–ç‰ˆéœ‡æ’¼è½¬åœºæ•ˆæœå®Œæˆï¼ˆ0.6ç§’ï¼‰- è“„åŠ›â†’çˆ†å‘â†’å†²å‡»â†’æ¢å¤');
                    console.log('ğŸ¯ ç‰ˆæœ¬ä¿¡æ¯: Enhanced Shock v5.0 - ä¼˜åŒ–éœ‡åŠ¨ç‰ˆæœ¬');
                }, 1200);
            }
            
            // åˆ›å»ºå¢å¼ºçš„å¤šå±‚æ¬¡é—ªå…‰åºåˆ—
            createEnhancedFlashSequence() {
                console.log('âœ¨ åˆ›å»ºå¤šå±‚æ¬¡é—ªå…‰å†²å‡»åºåˆ—');
                
                // ç¬¬ä¸€å±‚ï¼šè“„åŠ›é˜¶æ®µçš„å¾®å¼±çº¢å…‰
                const preparationFlash = document.createElement('div');
                preparationFlash.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: radial-gradient(circle, rgba(255,50,50,0.3) 0%, rgba(255,50,50,0.1) 50%, transparent 80%);
                    z-index: 9996;
                    opacity: 0;
                    pointer-events: none;
                    transition: opacity 0.2s ease-in-out;
                `;
                document.body.appendChild(preparationFlash);
                
                // è“„åŠ›é˜¶æ®µçº¢å…‰æ¸æ˜¾
                setTimeout(() => preparationFlash.style.opacity = '1', 0);
                setTimeout(() => preparationFlash.style.opacity = '0', 100);
                
                // ç¬¬äºŒå±‚ï¼šçˆ†å‘é˜¶æ®µçš„å¼ºçƒˆç™½å…‰
                const explosionFlash = document.createElement('div');
                explosionFlash.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,255,255,0.8) 15%, rgba(255,255,255,0.3) 35%, transparent 60%);
                    z-index: 9997;
                    opacity: 0;
                    pointer-events: none;
                    transition: opacity 0.05s ease-out;
                `;
                document.body.appendChild(explosionFlash);
                
                // çˆ†å‘é˜¶æ®µç™½å…‰å†²å‡»ï¼ˆä¸20%å…³é”®å¸§åŒæ­¥ï¼‰
                setTimeout(() => {
                    explosionFlash.style.opacity = '1';
                    setTimeout(() => explosionFlash.style.opacity = '0', 80);
                }, 120); // 20% of 600ms = 120ms
                
                // ç¬¬ä¸‰å±‚ï¼šå†²å‡»æ³¢æ•ˆæœ
                const shockwaveFlash = document.createElement('div');
                shockwaveFlash.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: radial-gradient(circle, transparent 0%, rgba(255,255,255,0.6) 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
                    z-index: 9998;
                    opacity: 0;
                    pointer-events: none;
                    transition: opacity 0.1s ease-out;
                `;
                document.body.appendChild(shockwaveFlash);
                
                // å†²å‡»æ³¢æ•ˆæœï¼ˆä¸40%å…³é”®å¸§åŒæ­¥ï¼‰
                setTimeout(() => {
                    shockwaveFlash.style.opacity = '1';
                    setTimeout(() => shockwaveFlash.style.opacity = '0', 120);
                }, 240); // 40% of 600ms = 240ms
                
                // æ¸…ç†æ‰€æœ‰é—ªå…‰æ•ˆæœ
                setTimeout(() => {
                    [preparationFlash, explosionFlash, shockwaveFlash].forEach(flash => {
                        if (flash.parentNode) {
                            flash.remove();
                        }
                    });
                    console.log('âœ¨ å¤šå±‚æ¬¡é—ªå…‰åºåˆ—å®Œæˆ');
                }, 600);
            }
            
            // æ’­æ”¾N003
            playN003() {
                this.updateCurrentVideo('N003');
                this.updateStatus('æ’­æ”¾N003');
                
                console.log('ğŸ¬ å¼€å§‹æ’­æ”¾N003ï¼šä¼˜åŒ–è§†è§‰æ•ˆæœ');
                
                const video = this.createVideo('é•œå¤´2/N003.mp4');
                
                // N003å¼€å§‹æ’­æ”¾æ—¶æ·»åŠ è½»å¾®çš„äº®åº¦æå‡æ•ˆæœï¼ˆå»æ‰è¿‡åº¦ç™½å…‰ï¼‰
                video.addEventListener('playing', () => {
                    console.log('âœ¨ N003å¼€å§‹æ’­æ”¾ï¼Œæ·»åŠ è½»å¾®äº®åº¦æå‡æ•ˆæœ');
                    this.createSubtleBrightnessEffect();
                }, { once: true });
                
                video.addEventListener('ended', () => {
                    console.log('âœ… N003æ’­æ”¾å®Œæ¯•ï¼Œé•œå¤´2å®Œæˆ');
                    this.sceneComplete();
                });
                
                this.setCurrentVideo(video);
            }
            
            // æ’­æ”¾ç™½å…‰çˆ†å‘éŸ³æ•ˆ
            playWhiteFlashSound() {
                if (!this.audioUnlocked) {
                    console.log('ğŸµ éŸ³é¢‘æœªè§£é”ï¼Œè·³è¿‡ç™½å…‰éŸ³æ•ˆ');
                    return;
                }
                
                console.log('âœ¨ æ’­æ”¾ç™½å…‰çˆ†å‘éŸ³æ•ˆ');
                
                // åˆ›å»ºç™½å…‰éŸ³æ•ˆï¼ˆä½¿ç”¨knifeéŸ³æ•ˆçš„é«˜éŸ³è°ƒç‰ˆæœ¬ï¼‰
                const flashAudio = new Audio('sounds/knife.mp3');
                flashAudio.volume = 0.6;
                flashAudio.playbackRate = 1.5; // æé«˜éŸ³è°ƒ
                
                flashAudio.play().catch(e => {
                    console.warn('ç™½å…‰éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
                });
                
                // æ·»åŠ è§†è§‰ç™½å…‰æ•ˆæœ
                this.createWhiteFlashEffect();
            }
            
            // åˆ›å»ºç™½å…‰è§†è§‰æ•ˆæœï¼ˆä¿ç•™åŸç‰ˆæœ¬ï¼Œä¾›å…¶ä»–åœ°æ–¹ä½¿ç”¨ï¼‰
            createWhiteFlashEffect() {
                console.log('âœ¨ åˆ›å»ºç™½å…‰è§†è§‰æ•ˆæœ');
                
                const flash = document.createElement('div');
                flash.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,255,255,0.8) 40%, rgba(255,255,255,0) 100%);
                    z-index: 9999;
                    opacity: 0;
                    pointer-events: none;
                    transition: opacity 0.1s ease-out;
                `;
                
                document.body.appendChild(flash);
                
                // ç¬é—´é—ªç°
                setTimeout(() => {
                    flash.style.opacity = '1';
                }, 10);
                
                // å¿«é€Ÿæ·¡å‡º
                setTimeout(() => {
                    flash.style.opacity = '0';
                    setTimeout(() => {
                        if (flash.parentNode) {
                            flash.remove();
                        }
                        console.log('âœ¨ ç™½å…‰æ•ˆæœå®Œæˆ');
                    }, 200);
                }, 150);
            }

            // åˆ›å»ºè½»å¾®äº®åº¦æå‡æ•ˆæœï¼ˆæ›¿ä»£è¿‡åº¦ç™½å…‰ï¼‰
            createSubtleBrightnessEffect() {
                console.log('âœ¨ åˆ›å»ºè½»å¾®äº®åº¦æå‡æ•ˆæœï¼ˆä¸é®æŒ¡N003ç”»é¢ï¼‰');
                
                const brightness = document.createElement('div');
                brightness.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(255, 255, 255, 0);
                    z-index: 999;
                    opacity: 0;
                    pointer-events: none;
                    transition: all 0.3s ease-out;
                    mix-blend-mode: screen;
                `;
                
                document.body.appendChild(brightness);
                
                // è½»å¾®æå‡äº®åº¦
                setTimeout(() => {
                    brightness.style.background = 'rgba(255, 255, 255, 0.1)';
                    brightness.style.opacity = '1';
                }, 50);
                
                // å¿«é€Ÿæ¢å¤æ­£å¸¸
                setTimeout(() => {
                    brightness.style.background = 'rgba(255, 255, 255, 0)';
                    brightness.style.opacity = '0';
                }, 200);
                
                // æ¸…ç†å…ƒç´ 
                setTimeout(() => {
                    if (brightness.parentNode) {
                        brightness.remove();
                    }
                    console.log('âœ¨ è½»å¾®äº®åº¦æå‡æ•ˆæœå®Œæˆ');
                }, 500);
            }
            
            // åˆ›å»ºè§†é¢‘å…ƒç´ 
            createVideo(src) {
                const video = document.createElement('video');
                video.className = 'scene2-video';
                // ä¸è¦é™éŸ³è§†é¢‘ï¼Œè®©è§†é¢‘è‡ªå¸¦éŸ³æ•ˆæ’­æ”¾
                video.muted = false;
                video.volume = 1.0;
                video.autoplay = true;
                video.playsInline = true;
                video.preload = 'auto';
                
                // æ·»åŠ æ’­æ”¾çŠ¶æ€è·Ÿè¸ª
                video._hasStartedPlaying = false;
                video._loadAttempted = false;
                video._errorCount = 0;
                
                video.addEventListener('error', (e) => {
                    video._errorCount++;
                    console.error(`âŒ è§†é¢‘é”™è¯¯äº‹ä»¶ #${video._errorCount}: ${src}`, e);
                    console.error(`âŒ é”™è¯¯è¯¦æƒ…:`, e.target.error);
                    console.error(`âŒ å½“å‰è§†é¢‘src:`, video.src);
                    console.error(`âŒ è§†é¢‘readyState:`, video.readyState);
                    console.error(`âŒ è§†é¢‘networkState:`, video.networkState);
                    
                    // å¦‚æœè§†é¢‘å·²ç»å¼€å§‹æ’­æ”¾ï¼Œå¿½ç•¥é”™è¯¯äº‹ä»¶ï¼ˆå¯èƒ½æ˜¯æ’­æ”¾ç»“æŸåçš„ç¼–ç é”™è¯¯ï¼‰
                    if (video._hasStartedPlaying) {
                        console.log('âš ï¸ è§†é¢‘å·²ç»å¼€å§‹æ’­æ”¾ï¼Œå¿½ç•¥é”™è¯¯äº‹ä»¶');
                        return;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ç©ºsrcé”™è¯¯
                    if (e.target.error && e.target.error.code === 4) {
                        console.warn('âŒ æ£€æµ‹åˆ°ç©ºsrcé”™è¯¯ï¼Œå¯èƒ½æ˜¯srcè¢«æ„å¤–æ¸…ç©º');
                        if (!video.src && src) {
                            console.log('ğŸ”§ å°è¯•é‡æ–°è®¾ç½®src:', src);
                            video.src = src;
                            return;
                        }
                    }
                    
                    // é˜²æ­¢å¤šæ¬¡é”™è¯¯å¤„ç†
                    if (video._errorCount > 1) {
                        console.log(`âš ï¸ è§†é¢‘é”™è¯¯æ¬¡æ•°è¿‡å¤š (${video._errorCount})ï¼Œè·³è¿‡å¤„ç†`);
                        return;
                    }
                    
                    // ç»™è§†é¢‘ä¸€äº›æ—¶é—´åŠ è½½ï¼Œå†å†³å®šæ˜¯å¦fallback
                    setTimeout(() => {
                        if (!video._hasStartedPlaying && video.readyState === 0) {
                            console.warn('ğŸš¨ è§†é¢‘ç¡®å®æ— æ³•æ’­æ”¾ï¼Œæ‰§è¡Œfallback');
                            
                            if (src.includes('N001')) {
                                console.log('ğŸ”„ N001ç¡®å®åŠ è½½å¤±è´¥ï¼Œè‡ªåŠ¨è·³è½¬åˆ°N002');
                                this.playN002();
                            } else if (src.includes('N002')) {
                                console.log('âŒ N002ç¡®å®åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯');
                                this.showVideoError('N002è§†é¢‘åŠ è½½å¤±è´¥');
                            } else if (src.includes('N003')) {
                                console.log('ğŸ”„ N003ç¡®å®åŠ è½½å¤±è´¥ï¼Œç›´æ¥å®Œæˆé•œå¤´2');
                                this.sceneComplete();
                            }
                        }
                    }, 2000);
                });
                
                video.addEventListener('loadeddata', () => {
                    console.log(`âœ… è§†é¢‘æ•°æ®åŠ è½½å®Œæˆ: ${src}`);
                    console.log(`â° è§†é¢‘æ—¶é•¿: ${video.duration} ç§’`);
                    // æ‰‹åŠ¨å°è¯•æ’­æ”¾ä»¥ç¡®ä¿æ’­æ”¾æˆåŠŸ
                    video.play().then(() => {
                        console.log(`â–¶ï¸ è§†é¢‘æ’­æ”¾æˆåŠŸ: ${src}`);
                    }).catch(e => {
                        console.warn(`âš ï¸ è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥: ${src}`, e);
                        // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’
                        this.waitForUserInteraction(video);
                    });
                });
                
                // ç›‘å¬playingäº‹ä»¶ï¼Œæ ‡è®°è§†é¢‘å·²å¼€å§‹æ’­æ”¾
                video.addEventListener('playing', () => {
                    if (!video._hasStartedPlaying) {
                        video._hasStartedPlaying = true;
                        console.log(`ğŸ¬ ${src} å¼€å§‹æ’­æ”¾ï¼Œæ ‡è®°æ’­æ”¾çŠ¶æ€`);
                        
                        // N001æ’­æ”¾æ ‡è®°ï¼ˆä¸å†æ˜¾ç¤ºè°ƒè¯•æŒ‡ç¤ºå™¨ï¼‰
                        if (src.includes('N001')) {
                            console.log('ğŸ¬ N001å¼€å§‹æ’­æ”¾ï¼Œç”¨æˆ·åº”è¯¥èƒ½çœ‹åˆ°è§†é¢‘å†…å®¹');
                        }
                    }
                });
                
                // è®¾ç½®srcåœ¨æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ä¹‹åï¼Œé¿å…è¿‡æ—©è§¦å‘é”™è¯¯äº‹ä»¶
                console.log(`ğŸ¬ è®¾ç½®è§†é¢‘src: ${src}`);
                video.src = src;
                video._loadAttempted = true;
                
                return video;
            }
            
            // ç­‰å¾…ç”¨æˆ·äº¤äº’åæ’­æ”¾è§†é¢‘
            waitForUserInteraction(video) {
                console.log('ğŸ–±ï¸ ç­‰å¾…ç”¨æˆ·äº¤äº’æ¥æ’­æ”¾è§†é¢‘');
                const playOnClick = () => {
                    video.play().then(() => {
                        console.log('âœ… ç”¨æˆ·äº¤äº’åè§†é¢‘æ’­æ”¾æˆåŠŸ');
                        document.removeEventListener('click', playOnClick);
                    }).catch(e => {
                        console.error('âŒ ç”¨æˆ·äº¤äº’åè§†é¢‘æ’­æ”¾ä»ç„¶å¤±è´¥:', e);
                    });
                };
                document.addEventListener('click', playOnClick);
            }
            
            // è®¾ç½®å½“å‰è§†é¢‘
            setCurrentVideo(video) {
                // æ¸…ç†ä¹‹å‰çš„è§†é¢‘
                if (this.currentVideo && this.currentVideo !== video) {
                    console.log('ğŸ§¹ æ¸…ç†ä¹‹å‰çš„è§†é¢‘');
                    this.currentVideo.pause();
                    // ä½¿ç”¨removeAttributeè€Œä¸æ˜¯è®¾ç½®ç©ºå­—ç¬¦ä¸²ï¼Œé¿å…srcå˜æˆé¡µé¢URL
                    this.currentVideo.removeAttribute('src');
                    this.currentVideo.load(); // é‡ç½®è§†é¢‘çŠ¶æ€
                    if (this.currentVideo.parentNode) {
                        this.currentVideo.remove();
                    }
                }
                
                // æ¸…ç†è§†é¢‘å®¹å™¨ä¸­çš„æ‰€æœ‰ç°æœ‰è§†é¢‘ï¼ˆé™¤äº†å½“å‰è¦è®¾ç½®çš„è§†é¢‘ï¼‰
                const existingVideos = this.videoContainer.querySelectorAll('video');
                existingVideos.forEach(v => {
                    if (v !== video) {
                        console.log('ğŸ§¹ æ¸…ç†å®¹å™¨ä¸­çš„ç°æœ‰è§†é¢‘');
                        v.pause();
                        // ä½¿ç”¨removeAttributeè€Œä¸æ˜¯è®¾ç½®ç©ºå­—ç¬¦ä¸²
                        v.removeAttribute('src');
                        v.load(); // é‡ç½®è§†é¢‘çŠ¶æ€
                        v.remove();
                    }
                });
                
                // è®¾ç½®æ–°è§†é¢‘
                if (!video.parentNode) {
                    this.videoContainer.appendChild(video);
                }
                this.currentVideo = video;
                
                console.log(`âœ… å½“å‰è§†é¢‘å·²è®¾ç½®: ${video.src}`);
            }
            
            // æ’­æ”¾S02002éŸ³æ•ˆ
            playS02002() {
                if (this.s02002Audio) return; // é˜²æ­¢é‡å¤æ’­æ”¾
                
                // æ£€æŸ¥æ˜¯å¦åœ¨iframeä¸­ä¸”å½“å‰é•œå¤´ä¸æ˜¯é•œå¤´2
                const isInIframe = window.parent !== window;
                if (isInIframe && !this.isCurrentlyActiveScene()) {
                    console.log('ğŸµ é•œå¤´2å½“å‰éæ´»è·ƒçŠ¶æ€ï¼Œè·³è¿‡S02002éŸ³æ•ˆæ’­æ”¾');
                    return;
                }
                
                if (!this.audioUnlocked) {
                    console.log('ğŸµ éŸ³é¢‘æœªè§£é”ï¼Œå°†S02002éŸ³æ•ˆåŠ å…¥å¾…å¤„ç†é˜Ÿåˆ—');
                    this.pendingAudioActions.push(() => this.playS02002());
                    return;
                }
                
                console.log('ğŸ”Š æ’­æ”¾S02002éŸ³æ•ˆ');
                this.s02002Audio = new Audio('é•œå¤´2/S02002.MP3');
                this.s02002Audio.volume = 0.8;
                this.s02002Audio.play().catch(e => {
                    console.warn('S02002éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
                });
            }
            
            // å¼€å§‹é›·å£°å¾ªç¯
            startThunder() {
                if (this.thunderAudio) return; // é˜²æ­¢é‡å¤æ’­æ”¾
                
                // æ£€æŸ¥æ˜¯å¦åœ¨iframeä¸­ä¸”å½“å‰é•œå¤´ä¸æ˜¯é•œå¤´2
                const isInIframe = window.parent !== window;
                if (isInIframe && !this.isCurrentlyActiveScene()) {
                    console.log('ğŸµ é•œå¤´2å½“å‰éæ´»è·ƒçŠ¶æ€ï¼Œè·³è¿‡é›·å£°æ’­æ”¾');
                    return;
                }
                
                if (!this.audioUnlocked) {
                    console.log('ğŸµ éŸ³é¢‘æœªè§£é”ï¼Œå°†é›·å£°åŠ å…¥å¾…å¤„ç†é˜Ÿåˆ—');
                    this.pendingAudioActions.push(() => this.startThunder());
                    return;
                }
                
                console.log('â›ˆï¸ å¼€å§‹é›·å£°å¾ªç¯');
                this.thunderAudio = new Audio('sounds/Rain.MP3');
                this.thunderAudio.volume = 0.3;
                this.thunderAudio.loop = true;
                this.thunderAudio.preload = 'auto';
                
                // å…ˆå°è¯•åŠ è½½ï¼Œå†æ’­æ”¾
                this.thunderAudio.addEventListener('canplaythrough', () => {
                    console.log('â›ˆï¸ é›·å£°éŸ³é¢‘å·²åŠ è½½ï¼Œå¼€å§‹æ’­æ”¾');
                    this.thunderAudio.play().catch(e => {
                        console.warn('é›·å£°æ’­æ”¾å¤±è´¥:', e);
                    });
                }, { once: true });
                
                this.thunderAudio.addEventListener('error', (e) => {
                    console.error('â›ˆï¸ é›·å£°éŸ³é¢‘åŠ è½½å¤±è´¥:', e);
                });
                
                // ç«‹å³åŠ è½½
                this.thunderAudio.load();
            }
            
            // åœæ­¢é›·å£°
            stopThunder() {
                if (this.thunderAudio) {
                    this.thunderAudio.pause();
                    this.thunderAudio.removeAttribute('src');
                    this.thunderAudio.load();
                    this.thunderAudio = null;
                    console.log('â›ˆï¸ é›·å£°å·²åœæ­¢');
                }
            }
            
            // æ˜¾ç¤ºæ¿€æ´»æŒ‰é’®
            showActivateButton() {
                this.isWaitingForClicks = true;
                this.clickCount = 0;
                this.updateClickCount();
                this.updateStatus('ç­‰å¾…ç‚¹å‡»æ¿€æ´»');
                
                const button = document.createElement('div');
                button.className = 'activate-button';
                button.id = 'activate-btn';
                
                button.innerHTML = `
                    <div class="button-text">
                        è¿ç»­ç‚¹å‡»<br>æ¿€æ´»ç‰ä½©<br>
                        <span id="click-counter" style="font-size: 12px; opacity: 0.8;">
                            (${this.clickCount}/${this.requiredClicks})
                        </span>
                    </div>
                `;
                
                button.addEventListener('click', () => {
                    this.handleActivateClick();
                });
                
                this.uiContainer.appendChild(button);
                
                setTimeout(() => {
                    button.style.opacity = '1';
                }, 100);
                
                // æ·»åŠ å¤‡ç”¨äº¤äº’ï¼šç‚¹å‡»è§†é¢‘åŒºåŸŸä¹Ÿèƒ½æ¿€æ´»
                this.addVideoClickHandler();
                console.log('ğŸ¯ æ¿€æ´»æŒ‰é’®å·²æ˜¾ç¤ºï¼Œä¹Ÿå¯ç›´æ¥ç‚¹å‡»è§†é¢‘åŒºåŸŸæ¿€æ´»');
            }
            
            // æ·»åŠ è§†é¢‘ç‚¹å‡»å¤„ç†å™¨ï¼ˆå¤‡ç”¨äº¤äº’ï¼‰
            addVideoClickHandler() {
                if (this.currentVideo && !this.currentVideo.dataset.clickHandlerAdded) {
                    this.currentVideo.addEventListener('click', () => {
                        if (this.isWaitingForClicks) {
                            console.log('ğŸ–±ï¸ ç”¨æˆ·ç‚¹å‡»è§†é¢‘åŒºåŸŸæ¿€æ´»');
                            this.handleActivateClick();
                        }
                    });
                    this.currentVideo.dataset.clickHandlerAdded = 'true';
                }
                
                // ä¹Ÿç»™è§†é¢‘å®¹å™¨æ·»åŠ ç‚¹å‡»å¤„ç†
                if (!this.videoContainer.dataset.clickHandlerAdded) {
                    this.videoContainer.addEventListener('click', () => {
                        if (this.isWaitingForClicks) {
                            console.log('ğŸ–±ï¸ ç”¨æˆ·ç‚¹å‡»è§†é¢‘å®¹å™¨æ¿€æ´»');
                            this.handleActivateClick();
                        }
                    });
                    this.videoContainer.dataset.clickHandlerAdded = 'true';
                }
            }
            
            // å¤„ç†æ¿€æ´»ç‚¹å‡»
            handleActivateClick() {
                this.clickCount++;
                console.log(`ğŸ–±ï¸ ç‰ä½©æ¿€æ´»ç‚¹å‡» ${this.clickCount}/${this.requiredClicks}`);
                
                this.updateClickCount();
                this.createClickEffect();
                this.createScreenShake(); // æ·»åŠ å±å¹•æŒ¯åŠ¨æ•ˆæœ
                
                if (this.clickCount >= this.requiredClicks) {
                    console.log('âœ… è¾¾åˆ°æ‰€éœ€ç‚¹å‡»æ¬¡æ•°ï¼Œæ¿€æ´»ç‰ä½©ï¼');
                    this.activateJade();
                } else {
                    this.flashButton();
                }
            }
            
            // åˆ›å»ºå±å¹•æŒ¯åŠ¨æ•ˆæœ - æƒŠå“ç‰ˆ
            createScreenShake() {
                console.log('ğŸŒ€ åˆ›å»ºæƒŠå“å¼å±å¹•æŒ¯åŠ¨æ•ˆæœ');
                
                // å¯¹è§†é¢‘å®¹å™¨è¿›è¡ŒæŒ¯åŠ¨ï¼Œé¿å…å½±å“UIæŒ‰é’®ä½ç½®
                const videoContainer = this.videoContainer;
                
                // æƒŠå“å¼æŒ¯åŠ¨åŠ¨ç”»ï¼šå…ˆè“„åŠ›åçˆ†å‘
                const shakeAnimation = [
                    // è“„åŠ›é˜¶æ®µ - è½»å¾®é¢¤æŠ–
                    { transform: 'translate(0, 0)' },
                    { transform: 'translate(-1px, -1px)' },
                    { transform: 'translate(1px, 1px)' },
                    { transform: 'translate(-1px, 1px)' },
                    // çˆ†å‘é˜¶æ®µ - å‰§çƒˆéœ‡åŠ¨
                    { transform: 'translate(-20px, -16px)' },
                    { transform: 'translate(20px, 16px)' },
                    { transform: 'translate(-18px, 14px)' },
                    { transform: 'translate(18px, -14px)' },
                    { transform: 'translate(-16px, -12px)' },
                    { transform: 'translate(16px, 12px)' },
                    { transform: 'translate(-14px, 10px)' },
                    { transform: 'translate(14px, -10px)' },
                    // å¼ºéœ‡ä½™æ³¢
                    { transform: 'translate(-10px, -8px)' },
                    { transform: 'translate(10px, 8px)' },
                    { transform: 'translate(-8px, 6px)' },
                    { transform: 'translate(8px, -6px)' },
                    { transform: 'translate(-6px, -4px)' },
                    { transform: 'translate(6px, 4px)' },
                    { transform: 'translate(-3px, 2px)' },
                    { transform: 'translate(3px, -2px)' },
                    { transform: 'translate(0, 0)' }
                ];
                
                // æ‰§è¡ŒæƒŠå“å¼æŒ¯åŠ¨åŠ¨ç”»
                videoContainer.animate(shakeAnimation, {
                    duration: 800, // å¢åŠ åˆ°800msè®©æ•ˆæœæ›´æ˜æ˜¾
                    easing: 'ease-out'
                });
                
                // æƒŠå“å¼è®¾å¤‡æŒ¯åŠ¨æ¨¡å¼
                if (navigator.vibrate) {
                    navigator.vibrate([50, 30, 200, 50, 200, 50, 100]); // è“„åŠ›â†’çˆ†å‘â†’ä½™éœ‡
                }
            }
            
            // åˆ›å»ºç‚¹å‡»ç‰¹æ•ˆ
            createClickEffect() {
                const button = document.getElementById('activate-btn');
                if (!button) return;
                
                const ripple = document.createElement('div');
                ripple.style.cssText = `
                    position: absolute;
                    width: 20px;
                    height: 20px;
                    background: rgba(255, 255, 255, 0.6);
                    border-radius: 50%;
                    transform: translate(-50%, -50%);
                    animation: clickRipple 0.6s ease-out forwards;
                    pointer-events: none;
                    top: 50%;
                    left: 50%;
                `;
                
                button.appendChild(ripple);
                
                setTimeout(() => {
                    if (ripple.parentNode) {
                        ripple.remove();
                    }
                }, 600);
                
                // æŒ‰é’®ç¼©æ”¾æ•ˆæœ
                button.style.transform = 'translate(-50%, -50%) scale(0.95)';
                setTimeout(() => {
                    button.style.transform = 'translate(-50%, -50%) scale(1)';
                }, 150);
            }
            
            // æŒ‰é’®é—ªçƒ
            flashButton() {
                const button = document.getElementById('activate-btn');
                if (!button) return;
                
                button.style.borderColor = 'rgba(255, 255, 100, 0.9)';
                button.style.boxShadow = '0 0 20px rgba(255, 255, 100, 0.5)';
                
                setTimeout(() => {
                    button.style.borderColor = 'rgba(255, 255, 255, 0.6)';
                    button.style.boxShadow = 'none';
                }, 300);
            }
            
            // æ¿€æ´»ç‰ä½©
            activateJade() {
                const button = document.getElementById('activate-btn');
                if (button) {
                    button.style.opacity = '0';
                    setTimeout(() => button.remove(), 300);
                }
                
                this.isWaitingForClicks = false;
                this.updateStatus('ç‰ä½©å·²æ¿€æ´»');
                
                // å¼€å§‹N002åˆ°N003çš„è½¬åœºç‰¹æ•ˆ
                setTimeout(() => {
                    this.transitionFromN002ToN003();
                }, 500);
            }
            
            // åœºæ™¯å®Œæˆ
            sceneComplete() {
                this.stopThunder();
                this.updateStatus('åœºæ™¯å®Œæˆ');
                
                // ç›´æ¥è·³è½¬åˆ°é•œå¤´3ï¼Œä¸æ˜¾ç¤ºç»§ç»­æŒ‰é’®
                console.log('ğŸ¬ é•œå¤´2å®Œæˆï¼Œç›´æ¥è·³è½¬åˆ°é•œå¤´3');
                this.continueToScene3();
            }
            
            // æ˜¾ç¤ºç»§ç»­æŒ‰é’®
            showContinueButton() {
                const continueButton = document.createElement('div');
                continueButton.className = 'continue-button';
                continueButton.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 40px;
                    border-radius: 20px;
                    border: 2px solid #ffcc00;
                    text-align: center;
                    font-size: 18px;
                    z-index: 999999;
                    cursor: pointer;
                    opacity: 0;
                    transition: all 0.5s ease;
                `;
                
                continueButton.innerHTML = `
                    <h2 style="margin-bottom: 20px; color: #ffcc00;">ğŸ¬ é•œå¤´2å®Œæˆ</h2>
                    <p style="margin-bottom: 20px;">ç‰ä½©è§‰é†’ä½“éªŒç»“æŸ</p>
                    <div style="
                        padding: 15px 30px;
                        background: linear-gradient(45deg, #ffcc00, #ff9900);
                        color: #000;
                        border-radius: 10px;
                        font-weight: bold;
                        font-size: 16px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">
                        ç‚¹å‡»ç»§ç»­ â†’ é•œå¤´3ï¼šæ—¶ç©ºç©¿è¶Š
                    </div>
                `;
                
                // æ·»åŠ æ‚¬åœæ•ˆæœ
                const buttonDiv = continueButton.querySelector('div');
                buttonDiv.addEventListener('mouseenter', () => {
                    buttonDiv.style.background = 'linear-gradient(45deg, #ff9900, #ffcc00)';
                    buttonDiv.style.transform = 'scale(1.05)';
                });
                
                buttonDiv.addEventListener('mouseleave', () => {
                    buttonDiv.style.background = 'linear-gradient(45deg, #ffcc00, #ff9900)';
                    buttonDiv.style.transform = 'scale(1)';
                });
                
                // ç‚¹å‡»äº‹ä»¶
                continueButton.addEventListener('click', () => {
                    this.continueToScene3();
                });
                
                this.uiContainer.appendChild(continueButton);
                
                // æ·¡å…¥æ˜¾ç¤º
                setTimeout(() => {
                    continueButton.style.opacity = '1';
                }, 100);
            }
            
            // ç»§ç»­åˆ°é•œå¤´3
            continueToScene3() {
                console.log('ğŸ¬ é•œå¤´2è‡ªåŠ¨å®Œæˆï¼Œç›´æ¥è·³è½¬åˆ°é•œå¤´3');
                
                // ç›´æ¥é€šçŸ¥æ•…äº‹ç®¡ç†å™¨é•œå¤´2å®Œæˆï¼Œä¸æ˜¾ç¤ºä¸­é—´ç•Œé¢
                    this.notifyScene2Complete();
            }
            
            // æ˜¾ç¤ºé•œå¤´3è½¬åœºæç¤º
            showToBeContined() {
                const message = document.createElement('div');
                message.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #000 0%, #333 100%);
                    color: white;
                    padding: 60px;
                    border-radius: 30px;
                    border: 3px solid #ffcc00;
                    text-align: center;
                    font-size: 24px;
                    z-index: 999999;
                    opacity: 0;
                    transition: all 1s ease;
                    box-shadow: 0 0 30px rgba(255, 204, 0, 0.5);
                `;
                
                message.innerHTML = `
                    <h1 style="margin-bottom: 30px; color: #ffcc00; font-size: 36px; text-shadow: 0 0 10px rgba(255, 204, 0, 0.8);">
                        ğŸ¬ é•œå¤´2å®Œæˆ
                    </h1>
                    <p style="margin-bottom: 20px; font-size: 28px; color: #fff;">
                        æ­£åœ¨è½¬åœºåˆ°é•œå¤´3...
                    </p>
                    <p style="font-size: 16px; color: #ccc; opacity: 0.8;">
                        æ—¶ç©ºç©¿è¶Šå³å°†å¼€å§‹
                    </p>
                `;
                
                this.uiContainer.appendChild(message);
                
                // æ·¡å…¥æ˜¾ç¤º
                setTimeout(() => {
                    message.style.opacity = '1';
                }, 100);
                
                // 2ç§’åæ·¡å‡ºï¼ˆåŠ å¿«è½¬åœºé€Ÿåº¦ï¼‰
                setTimeout(() => {
                    message.style.opacity = '0';
                    setTimeout(() => {
                        if (message.parentNode) {
                            message.remove();
                        }
                    }, 500);
                }, 2000);
            }
            
            // é€šçŸ¥é•œå¤´2å®Œæˆ
            notifyScene2Complete() {
                console.log('ğŸ“¡ é•œå¤´2å®Œæˆï¼Œå‘é€ä¿¡å·ç»™æ•…äº‹ç®¡ç†å™¨');
                
                // å¦‚æœåœ¨iframeä¸­ï¼Œå‘é€æ¶ˆæ¯ç»™çˆ¶çª—å£
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'scene2-complete',
                        timestamp: Date.now()
                    }, '*');
                    console.log('ğŸ“¡ å·²å‘é€é•œå¤´2å®Œæˆä¿¡å·');
                }
            }
            
            // é‡ç½®
            reset() {
                if (this.currentVideo) {
                    this.currentVideo.pause();
                    this.currentVideo.removeAttribute('src');
                    this.currentVideo.load();
                    this.currentVideo = null;
                }
                
                this.stopThunder();
                
                if (this.s02002Audio) {
                    this.s02002Audio.pause();
                    this.s02002Audio.src = '';
                    this.s02002Audio = null;
                }
                
                this.videoContainer.innerHTML = '';
                this.uiContainer.innerHTML = '';
                
                this.clickCount = 0;
                this.isWaitingForClicks = false;
                
                this.updateClickCount();
                this.updateCurrentVideo('æ— ');
                this.updateStatus('å·²é‡ç½®');
                
                console.log('ğŸ”„ åœºæ™¯å·²é‡ç½®');
            }
            
            // æ›´æ–°UIæ˜¾ç¤º
            updateClickCount() {
                document.getElementById('click-count').textContent = this.clickCount;
                const counter = document.getElementById('click-counter');
                if (counter) {
                    counter.textContent = `(${this.clickCount}/${this.requiredClicks})`;
                }
            }
            
            updateCurrentVideo(video) {
                document.getElementById('current-video').textContent = video;
            }
            
            updateStatus(status) {
                document.getElementById('status').textContent = status;
            }
        }
        
        // å…¨å±€å®ä¾‹
        let scene2;
        
        // åˆå§‹åŒ–é€»è¾‘
        function initializeScene2() {
            scene2 = new SimpleScene2();
            
            // æ£€æµ‹æ˜¯å¦åœ¨iframeä¸­è¿è¡Œ
            const isInIframe = window.parent !== window;
            
            if (isInIframe) {
                console.log('ğŸ“± æ£€æµ‹åˆ°iframeç¯å¢ƒï¼Œå¯ç”¨æ•…äº‹æ¨¡å¼');
                // åœ¨iframeä¸­è¿è¡Œï¼Œéšè—æ§åˆ¶é¢æ¿å¹¶è‡ªåŠ¨å¯åŠ¨
                const controls = document.querySelector('.controls');
                if (controls) {
                    controls.style.display = 'none';
                }
                
                // å»¶è¿Ÿå¯åŠ¨ï¼Œç¡®ä¿iframeå®Œå…¨åŠ è½½å’ŒéŸ³é¢‘è§£é”
                setTimeout(() => {
                    console.log('ğŸ¬ æ•…äº‹æ¨¡å¼ï¼šè®¾ç½®é•œå¤´2ï¼Œä½†ä¸ç«‹å³å¯åŠ¨');
                    
                    // è®¾ç½®ç›‘å¬å™¨æ£€æŸ¥é•œå¤´æ¿€æ´»çŠ¶æ€
                    scene2.setupActivationMonitor();
                    
                    console.log('ğŸ¬ ç­‰å¾…é•œå¤´2çœŸæ­£æ¿€æ´»æ—¶å†å¯åŠ¨æ’­æ”¾');
                    // ä¸å†è‡ªåŠ¨å¯åŠ¨ï¼Œç­‰å¾…é•œå¤´æ¿€æ´»äº‹ä»¶
                    
                    // é¢å¤–çš„å®‰å…¨æœºåˆ¶ï¼š15ç§’åå¦‚æœè¿˜æ²¡æœ‰æ¿€æ´»æŒ‰é’®ï¼Œå¼ºåˆ¶æ˜¾ç¤º
                    setTimeout(() => {
                        if (!scene2.isWaitingForClicks && scene2.currentVideo && 
                            scene2.currentVideo.src.includes('N002')) {
                            console.log('ğŸš¨ å¼ºåˆ¶æ˜¾ç¤ºæ¿€æ´»æŒ‰é’®ï¼ˆå®‰å…¨æœºåˆ¶ï¼‰');
                            scene2.showActivateButton();
                        }
                    }, 15000);
                }, 1000);
            } else {
                console.log('ğŸ§ª æ£€æµ‹åˆ°ç‹¬ç«‹ç¯å¢ƒï¼Œå¯ç”¨æµ‹è¯•æ¨¡å¼');
                console.log('ğŸ§ª æµ‹è¯•æ¨¡å¼ï¼šç­‰å¾…æ‰‹åŠ¨å¯åŠ¨');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ¬ é•œå¤´2é¡µé¢å·²åŠ è½½');
            initializeScene2();
        });
        
        // æ§åˆ¶å‡½æ•°
        function startScene2() {
            if (scene2) {
                scene2.start();
            }
        }
        
        function testN001() {
            if (scene2) scene2.playN001();
        }
        
        function testN002() {
            if (scene2) scene2.playN002();
        }
        
        function testN003() {
            if (scene2) scene2.playN003();
        }
        
        function playThunder() {
            if (scene2) scene2.startThunder();
        }
        
        function stopThunder() {
            if (scene2) scene2.stopThunder();
        }
        
        function testThunderOnly() {
            console.log('ğŸ§ª ç‹¬ç«‹æµ‹è¯•é›·å£°');
            const testAudio = new Audio('sounds/Rain.MP3');
            testAudio.volume = 0.3;
            testAudio.loop = true;
            
            testAudio.addEventListener('canplaythrough', () => {
                console.log('âœ… é›·å£°éŸ³é¢‘åŠ è½½æˆåŠŸï¼Œå¼€å§‹æ’­æ”¾');
                testAudio.play().then(() => {
                    console.log('âœ… é›·å£°æ’­æ”¾æˆåŠŸ');
                    
                    // 5ç§’åè‡ªåŠ¨åœæ­¢
                    setTimeout(() => {
                        testAudio.pause();
                        testAudio.src = '';
                        console.log('â¹ï¸ æµ‹è¯•é›·å£°å·²åœæ­¢');
                    }, 5000);
                }).catch(e => {
                    console.error('âŒ é›·å£°æ’­æ”¾å¤±è´¥:', e);
                });
            });
            
            testAudio.addEventListener('error', (e) => {
                console.error('âŒ é›·å£°éŸ³é¢‘åŠ è½½å¤±è´¥:', e);
                console.error('âŒ æ£€æŸ¥æ–‡ä»¶è·¯å¾„: sounds/Rain.MP3');
            });
            
            testAudio.load();
        }
        
        function showButton() {
            if (scene2) scene2.showActivateButton();
        }
        
        function resetAll() {
            if (scene2) scene2.reset();
        }
        
        function triggerCompletion() {
            console.log('ğŸš€ æ‰‹åŠ¨è§¦å‘é•œå¤´2å®Œæˆ');
            if (scene2) {
                scene2.continueToScene3();
            }
        }
        
        // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„åœæ­¢éŸ³é¢‘æŒ‡ä»¤
        window.addEventListener('message', (event) => {
            if (event.data.type === 'stop-all-audio') {
                console.log('ğŸ”‡ é•œå¤´2æ”¶åˆ°åœæ­¢éŸ³é¢‘æŒ‡ä»¤');
                if (scene2) {
                    // åœæ­¢é›·å£°éŸ³é¢‘
                    scene2.stopThunder();
                    
                    // åœæ­¢S02002éŸ³æ•ˆ
                    if (scene2.s02002Audio) {
                        scene2.s02002Audio.pause();
                        scene2.s02002Audio.src = '';
                        scene2.s02002Audio = null;
                    }
                    
                    console.log('ğŸ”‡ é•œå¤´2æ‰€æœ‰éŸ³é¢‘å·²åœæ­¢');
                }
            }
        });
        
        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case '1': startScene2(); break;
                case '2': testN001(); break;
                case '3': testN002(); break;
                case '4': testN003(); break;
                case '5': playThunder(); break;
                case '6': showButton(); break;
                case '7': stopThunder(); break;
                case '8': testThunderOnly(); break;
                case '9': triggerCompletion(); break; // æ·»åŠ å¿«æ·é”®è§¦å‘å®Œæˆ
                case 'r': case 'R': resetAll(); break;
            }
        });
        
        console.log('ğŸ§ª ç®€åŒ–é•œå¤´2æµ‹è¯•å·²å°±ç»ª');
        console.log('ğŸ® å¿«æ·é”®: 1=å¼€å§‹, 2-4=è§†é¢‘, 5=é›·å£°, 6=æŒ‰é’®, 7=åœæ­¢é›·å£°, 8=æµ‹è¯•é›·å£°, R=é‡ç½®');
        console.log('ğŸ”„ ä¿®æ”¹ç‰ˆæœ¬: è‡ªåŠ¨è·³è½¬åˆ°é•œå¤´3ï¼Œä¸æ˜¾ç¤ºä¸­é—´ç•Œé¢ - æ›´æ–°æ—¶é—´ï¼š' + new Date().toLocaleString());
    </script>
    <script src="scripts/keyboardToggle.js"></script>
</body>
</html> 